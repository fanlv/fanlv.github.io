<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>网络安全基础（二）：数字证书</title><meta name="description" content="行万里路，读万卷书"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?" + '2c076421eb9f21a0a143f8ee9c4ab171';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><meta name="referrer" content="no-referrer"><link rel="icon" href="/null"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="一、前言在当今数字化时代，安全性和信任是任何在线交易和通信的基石。无论是访问一个安全的网站、发送一封加密邮件，还是下载一个可信的软件，数字证书都在背后默默地发挥着至关重要的作用。数字证书作为公钥基础设施（PKI）的核心组件，通过验证身份和加密数据，确保了互联网和其他网络环境中的安全性和完整性。
数字证书不仅仅是一个简单的加密工具，它们代表了一种信任机制，是确保数据传输和身份验证的关键。随着网络威胁的不断演变和复杂化，理解和正确使用数字证书变得比以往任何时候都更加重要。
二、数字证书标准：X.509
 ISO、IEC、ITU——国际三大标准化组织
ITU（International Telecommunication Union）：负责信息和通信技术（ICT）领域的国际标准化和协调，包括无线电通信、电信网络、.."><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Ryo's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">网络安全基础（二）：数字证书</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%E6%A0%87%E5%87%86%EF%BC%9AX-509"><span class="toc-text">二、数字证书标准：X.509</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81X-509-%E8%AF%81%E4%B9%A6%E5%86%85%E5%AE%B9"><span class="toc-text">2.1、X.509 证书内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1%E3%80%81%E4%B8%BB%E8%A6%81%E5%AD%97%E6%AE%B5"><span class="toc-text">2.1.1、主要字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2%E3%80%81%E8%AF%81%E4%B9%A6%E6%92%A4%E9%94%80%E5%88%97%E8%A1%A8"><span class="toc-text">2.1.2、证书撤销列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3%E3%80%81%E8%AE%A4%E8%AF%81%E6%A1%86%E6%9E%B6"><span class="toc-text">2.1.3、认证框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4%E3%80%81%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E8%AF%81%E4%B9%A6%E5%86%85%E5%AE%B9"><span class="toc-text">2.1.4、如何读取证书内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%EF%BC%9A%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-text">三、数字证书：文件格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E3%80%81%E8%AF%81%E4%B9%A6%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">3.1、证书格式的详细信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E3%80%81%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2"><span class="toc-text">3.2、格式转换</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%88%86%E7%B1%BB"><span class="toc-text">四、数字证书：常用分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81SSL-TLS-%E8%AF%81%E4%B9%A6%E5%88%86%E7%B1%BB"><span class="toc-text">4.1、SSL&#x2F;TLS 证书分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E3%80%81%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%86-DV%E3%80%81OV%E3%80%81EV"><span class="toc-text">4.2、如何区分 DV、OV、EV</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3%E3%80%81SSL-TLS-%E8%AF%81%E4%B9%A6%E5%9F%9F%E5%90%8D"><span class="toc-text">4.3、SSL&#x2F;TLS 证书域名</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1%E3%80%81%E5%9F%9F%E5%90%8D%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="toc-text">4.3.1、域名信息存储位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2%E3%80%81%E5%9F%9F%E5%90%8D%E4%BF%A1%E6%81%AF%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%97%B6%E6%9C%BA"><span class="toc-text">4.3.2、域名信息的校验时机</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%8F%91%E5%92%8C%E9%AA%8C%E7%AD%BE"><span class="toc-text">五、证书签发和验签</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E3%80%81%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%8F%91"><span class="toc-text">5.1、证书签发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2%E3%80%81%E8%AF%81%E4%B9%A6%E9%93%BE"><span class="toc-text">5.2、证书链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%81%E4%B9%A6%E9%93%BE%EF%BC%9F"><span class="toc-text">5.2.1、什么是证书链？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2%E3%80%81%E8%AF%81%E4%B9%A6%E9%93%BE%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">5.2.2、证书链的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3%E3%80%81%E8%AF%81%E4%B9%A6%E9%93%BE%E7%9A%84%E9%AA%8C%E8%AF%81%E8%BF%87%E7%A8%8B"><span class="toc-text">5.2.3、证书链的验证过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3%E3%80%81-%E4%BA%A4%E5%8F%89%E8%AF%81%E4%B9%A6"><span class="toc-text">5.3、 交叉证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4%E3%80%81%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%E6%B5%8B%E8%AF%95"><span class="toc-text">5.4、证书验证测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%A6%82%E4%BD%95%E7%94%B3%E8%AF%B7%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6"><span class="toc-text">六、如何申请数字证书</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">七、参考资料</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Security"><i class="tag post-item-tag">Security</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">网络安全基础（二）：数字证书</h1><time class="has-text-grey" datetime="2024-07-28T02:08:00.000Z">2024-07-28</time><article class="mt-2 post-content"><h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>在当今数字化时代，安全性和信任是任何在线交易和通信的基石。无论是访问一个安全的网站、发送一封加密邮件，还是下载一个可信的软件，数字证书都在背后默默地发挥着至关重要的作用。数字证书作为公钥基础设施（<code>PKI</code>）的核心组件，通过验证身份和加密数据，确保了互联网和其他网络环境中的安全性和完整性。</p>
<p>数字证书不仅仅是一个简单的加密工具，它们代表了一种信任机制，是确保数据传输和身份验证的关键。随着网络威胁的不断演变和复杂化，理解和正确使用数字证书变得比以往任何时候都更加重要。</p>
<h1 id="二、数字证书标准：X-509"><a href="#二、数字证书标准：X-509" class="headerlink" title="二、数字证书标准：X.509"></a>二、数字证书标准：X.509</h1><blockquote>
<p> <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/529019683">ISO、IEC、ITU——国际三大标准化组织</a></p>
<p>ITU（International Telecommunication Union）：负责信息和通信技术（ICT）领域的国际标准化和协调，包括无线电通信、电信网络、互联网技术和多媒体技术。 （ITU-T G.992.1：ADSL 标准、 ITU-R BT.2020：超高清电视（UHDTV）标准、ITU-T H.264：视频压缩标准、ITU-T G.711：音频压缩标准）</p>
<p>ISO（International Organization for Standardization）：负责制定和发布广泛领域的国际标准，包括质量管理、环境管理、信息安全等。</p>
<p>IEC（International Electrotechnical Commission）：负责制定和发布电工电子技术领域的国际标准，包括电气设备、电子元件、可再生能源等。</p>
<p>除了 ISO、IEC 和 ITU 这三个国际标准化组织外，IETF、IEEE、W3C 和 ANSI 也是重要的国际标准化组织。</p>
</blockquote>
<p>数字证书和<code>X.509</code>之间的关系可以总结为：<code>X.509</code>是<code>ITU-T</code>制定的证书标准，它定义了数字证书的格式和内容。大多数现代数字证书都是基于<code>X.509</code>标准的。<code>X.509</code>证书已应用在包括<code>TLS/SSL</code>在内的众多网络协议里，同时它也用在很多非在线应用场景里，比如电子签名服务。<code>X.509</code>证书里含有公钥、身份信息（比如网络主机名，组织的名称或个体名称等）和签名信息（可以是证书签发机构<code>CA</code>的签名，也可以是自签名）。</p>
<p><code>X.509</code>还附带了证书吊销列表和用于从最终对证书进行签名的证书签发机构直到最终可信点为止的证书合法性验证算法。<code>X.509</code>是<code>ITU-T</code>标准化部门基于他们之前的<code>ASN.1</code>定义的一套证书标准。</p>
<h2 id="2-1、X-509-证书内容"><a href="#2-1、X-509-证书内容" class="headerlink" title="2.1、X.509 证书内容"></a>2.1、X.509 证书内容</h2><p>证书信息主要分为三类：</p>
<ul>
<li>被颁发者信息：颁发的域名、关联子域以及所颁给的个人、企业、组织信息等等</li>
<li>证书机构信息：证书颁发机构名称、数字签名等等</li>
<li>证书信息：证书的版本号、序列号、签名算法、签发日期、到期日期、公钥等等</li>
</ul>
<h3 id="2-1-1、主要字段"><a href="#2-1-1、主要字段" class="headerlink" title="2.1.1、主要字段"></a>2.1.1、主要字段</h3><ol>
<li><p><strong>版本号（Version）</strong>：指定证书的版本，当前常用的是版本<code>3</code>。</p>
</li>
<li><p><strong>序列号（Serial Number）</strong>：由证书颁发机构分配的唯一编号，用于唯一标识证书。</p>
</li>
<li><p><strong>签名算法标识符（Signature Algorithm Identifier）</strong>：指定用于签名证书的算法，如<code>SHA-256 with RSA</code>。</p>
</li>
<li><p><strong>发行者（Issuer）</strong>：证书颁发机构的名称，通常包括组织名、国家等信息。</p>
</li>
<li><p><strong>有效期（Validity Period）</strong>：包含证书的起始日期（<code>Not Before</code>）和终止日期（<code>Not After</code>）。</p>
</li>
<li><p><strong>主体（Subject）</strong>：证书持有者的名称，通常包括个人或组织名、部门、国家等信息。</p>
</li>
<li><p><strong>主体公钥信息（Subject Public Key Info）</strong>：包含主体的公钥及其算法信息。</p>
</li>
<li><p><strong>扩展字段（Extensions）</strong>：版本<code>3</code>证书中引入的可选字段，用于添加额外的信息，如密钥使用、证书策略等。</p>
</li>
<li><p><strong>签名值（Signature Value）</strong>：证书颁发机构对证书内容的数字签名，用于验证证书的完整性和真实性。</p>
</li>
</ol>
<p><strong>证书的结构示例：</strong></p>
<pre><code class="plaintext">Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            01:23:45:67:89:ab:cd:ef
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=Example CA, O=Example Organization, C=US
        Validity
            Not Before: Jan  1 00:00:00 2023 GMT
            Not After : Jan  1 00:00:00 2024 GMT
        Subject: CN=www.example.com, O=Example Organization, C=US
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:ab:cd:ef:...
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: 
                Digital Signature, Key Encipherment
            X509v3 Basic Constraints: 
                CA:FALSE
    Signature Algorithm: sha256WithRSAEncryption
         ab:cd:ef:...
</code></pre>
<h3 id="2-1-2、证书撤销列表"><a href="#2-1-2、证书撤销列表" class="headerlink" title="2.1.2、证书撤销列表"></a>2.1.2、证书撤销列表</h3><p>证书撤销列表（<code>Certificate Revocation List, CRL</code>）是由证书颁发机构（<code>CA</code>）发布的一个列表，包含所有已被撤销的证书的序列号。<code>CRL</code>用于检查证书的吊销状态，确保证书的有效性。</p>
<p><strong>CRL 的主要字段：</strong></p>
<ol>
<li><p><strong>版本号（Version）</strong>：指定<code>CRL</code>的版本，当前常用的是版本<code>2</code>。</p>
</li>
<li><p><strong>签名算法标识符（Signature Algorithm Identifier）</strong>：指定用于签名<code>CRL</code>的算法，如<code>SHA-256 with RSA</code>。</p>
</li>
<li><p><strong>发行者（Issuer）</strong>： 证书颁发机构的名称。</p>
</li>
<li><p><strong>这个更新（This Update）</strong>：<code>CRL</code>发布的时间。</p>
</li>
<li><p><strong>下次更新（Next Update）</strong>：下次发布<code>CRL</code>的预期时间。</p>
</li>
<li><p><strong>已撤销证书列表（Revoked Certificates）</strong>：包含所有被撤销证书的序列号和撤销时间。</p>
</li>
<li><p><strong>扩展字段（Extensions）</strong>：可选字段，用于添加额外的信息。</p>
</li>
<li><p><strong>签名值（Signature Value）</strong>：证书颁发机构对<code>CRL</code>内容的数字签名。</p>
</li>
</ol>
<p><strong>CRL 的结构示例：</strong></p>
<pre><code class="plaintext">Certificate Revocation List (CRL):
    Data:
        Version: 2 (0x1)
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=Example CA, O=Example Organization, C=US
        This Update: Jan  1 00:00:00 2023 GMT
        Next Update: Jan  1 00:00:00 2024 GMT
        Revoked Certificates:
            Serial Number: 01:23:45:67:89:ab:cd:ef
                Revocation Date: Jan  1 00:00:00 2023 GMT
            Serial Number: 10:20:30:40:50:60:70:80
                Revocation Date: Feb  1 00:00:00 2023 GMT
    Signature Algorithm: sha256WithRSAEncryption
         ab:cd:ef:...
</code></pre>
<h3 id="2-1-3、认证框架"><a href="#2-1-3、认证框架" class="headerlink" title="2.1.3、认证框架"></a>2.1.3、认证框架</h3><p><code>X.509</code>还定义了一个认证框架（<code>Authentication Framework</code>），用于在公钥基础设施（<code>PKI</code>）中实现实体身份的认证和信任管理。这个框架包括：</p>
<ol>
<li><p><strong>证书颁发机构（CA）</strong>：负责签发和管理证书，确保证书的真实性和完整性。</p>
</li>
<li><p><strong>注册机构（RA）</strong>：负责验证申请者的身份，并向<code>CA</code>提交签名请求。</p>
</li>
<li><p><strong>证书持有者（Certificate Holder）</strong>：持有<code>X.509</code>证书的实体，使用证书进行身份验证和加密通信。</p>
</li>
<li><p><strong>依赖方（Relying Party）</strong>：依赖证书进行身份验证和加密通信的实体。</p>
</li>
</ol>
<h3 id="2-1-4、如何读取证书内容"><a href="#2-1-4、如何读取证书内容" class="headerlink" title="2.1.4、如何读取证书内容"></a>2.1.4、如何读取证书内容</h3><p><code>openssl</code> 读取证书内容</p>
<pre><code>openssl x509 -in baidu.com.pem -text -noout

openssl x509 -inform der -in baidu.com.der -text -noout


查看证书的特定部分：

openssl x509 -in baidu.com.pem -noout -subject

openssl x509 -in baidu.com.pem -noout -issuer

openssl x509 -in baidu.com.pem -noout -fingerprint

查看 PEM 格式的 CRL：

openssl crl -in baidu.com.pem -text -noout

查看私钥内容：
openssl rsa -in privatekey.pem -check -noout
</code></pre>
<p><code>Golang</code>读取证书信息<code>Demo</code>：</p>
<pre><code>import (
    "crypto/ecdsa"
    "crypto/rsa"
    "crypto/x509"
    "fmt"
    "io/ioutil"
    "log"
)

func main() {
    // 读取PEM格式的证书文件
    certPEM, err := ioutil.ReadFile("./baidu.com.pem")
    if err != nil {
        log.Fatalf("无法读取文件: %v\n", err)
    }
    // 解码PEM块
    block, _ := pem.Decode(certPEM)
    if block == nil {
        log.Fatalf("无法解码PEM块\n")
    }

    // 解析X.509证书
    cert, err := x509.ParseCertificate(block.Bytes)
    if err != nil {
        log.Fatalf("无法解析证书: %v\n", err)
    }

    // 打印证书详细信息
    fmt.Printf("证书颁发者:\n\t组织: %v\n\t组织单位: %v\n\t国家: %v\n\t省份: %v\n\t城市: %v\n\t通用名称: %s\n",
        cert.Issuer.Organization, cert.Issuer.OrganizationalUnit, cert.Issuer.Country, cert.Issuer.Province, cert.Issuer.Locality, cert.Issuer.CommonName)
    fmt.Printf("证书主题:\n\t组织: %v\n\t组织单位: %v\n\t国家: %v\n\t省份: %v\n\t城市: %v\n\t通用名称: %s\n",
        cert.Subject.Organization, cert.Subject.OrganizationalUnit, cert.Subject.Country, cert.Subject.Province, cert.Subject.Locality, cert.Subject.CommonName)
    fmt.Printf("有效期自: %s\n", cert.NotBefore)
    fmt.Printf("有效期至: %s\n", cert.NotAfter)
    fmt.Printf("序列号: %s\n", cert.SerialNumber.String())
    fmt.Printf("公钥算法: %s\n", cert.PublicKeyAlgorithm.String())
    fmt.Printf("签名算法: %s\n", cert.SignatureAlgorithm.String())
    fmt.Printf("签名: %s\n", base64.StdEncoding.EncodeToString(cert.Signature))
    fmt.Printf("版本: %d\n", cert.Version)

    // 打印扩展信息
    fmt.Println("扩展信息:")
    for _, ext := range cert.Extensions {
        fmt.Printf("\tID: %s\n\t关键扩展: %v\n\t值 (hex): %x\n", ext.Id.String(), ext.Critical, ext.Value)
    }

    // 打印公钥信息
    switch pub := cert.PublicKey.(type) {
    case *rsa.PublicKey:
        fmt.Printf("RSA公钥位数: %d\n", pub.Size()*8)
        fmt.Printf("RSA指数: %d\n", pub.E)
        fmt.Printf("RSA模数: %x\n", pub.N)
    case *ecdsa.PublicKey:
        fmt.Printf("ECDSA曲线: %s\n", pub.Curve.Params().Name)
        fmt.Printf("ECDSA公钥 X: %x\n", pub.X)
        fmt.Printf("ECDSA公钥 Y: %x\n", pub.Y)
    default:
        fmt.Println("未知公钥算法")
    }

    // 打印证书使用
    fmt.Println("扩展密钥用途:")
    for _, ku := range cert.ExtKeyUsage {
        fmt.Printf("\t%v\n", ku)
    }

    fmt.Println("基本约束:")
    fmt.Printf("\t是否CA: %v\n", cert.IsCA)
    fmt.Printf("\t最大路径长度: %d\n", cert.MaxPathLen)

}
</code></pre>
<h1 id="三、数字证书：文件格式"><a href="#三、数字证书：文件格式" class="headerlink" title="三、数字证书：文件格式"></a>三、数字证书：文件格式</h1><p><img src="https://upload-images.jianshu.io/upload_images/12321605-808ee2b2631a37cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>证书有多种格式的原因主要与不同应用场景、系统兼容性、存储和传输需求有关。每种格式都有其特定的用途和优点，以下是一些关键因素，解释为什么需要这么多不同的证书格式：</p>
<p><strong>系统兼容性</strong></p>
<p>不同的操作系统和应用程序对证书格式的支持不同。例如：</p>
<ul>
<li><strong>PEM</strong> 格式广泛用于<code>Unix/Linux</code>系统和开源软件，如<code>Apache</code>、<code>Nginx</code>和<code>OpenSSL</code>。</li>
<li><strong>DER</strong> 格式通常用于<code>Windows</code>系统，因为它是二进制编码格式，更适合<code>Windows</code>的文件处理方式。</li>
<li><strong>JKS</strong> 格式专用于<code>Java</code>应用程序，因为它是<code>Java KeyStore</code>的标准格式。</li>
</ul>
<p><strong>数据类型和用途</strong></p>
<p>不同的证书格式可以包含不同类型的数据，如公钥、私钥、证书链等。例如：</p>
<ul>
<li><strong>PEM</strong> 和 <strong>DER</strong> 格式可以存储公钥、私钥和证书链。</li>
<li><strong>PKCS#12</strong> 格式可以存储证书、公钥和私钥，适合导出和导入完整的证书链和密钥对。</li>
<li><strong>PKCS#7</strong> 格式主要用于存储证书链，不包含私钥，适合传输多个证书。</li>
</ul>
<p><strong>安全性和效率</strong></p>
<p>不同的编码方式和文件结构在安全性和效率上有所不同。例如：</p>
<ul>
<li><strong>DER</strong> 格式是二进制编码，更紧凑，适合高效存储和传输，但不易阅读。</li>
<li><strong>PEM</strong> 格式是<code>Base64</code>编码，易于阅读和编辑，适合手动配置和调试。</li>
</ul>
<p><strong>标准和协议要求</strong></p>
<p>不同的标准和协议对证书格式有特定要求。例如：</p>
<ul>
<li><strong>SSL/TLS</strong> 协议广泛使用<code>PEM</code>和<code>DER</code>格式的证书。</li>
<li><strong>S/MIME</strong> 协议用于电子邮件加密和签名，通常使用<code>PKCS#7</code>格式。</li>
<li><strong>Java 应用程序</strong> 使用<code>JKS</code>格式的密钥库来管理证书和密钥。</li>
</ul>
<p><strong>应用场景</strong></p>
<p>不同的应用场景对证书格式有不同的需求。例如：</p>
<ul>
<li><strong>Web 服务器</strong> 需要使用<code>PEM</code>或<code>DER</code>格式的证书来配置<code>SSL/TLS</code>。</li>
<li><strong>电子邮件客户端</strong> 需要使用<code>PKCS#7</code>格式的证书来加密和签名电子邮件。</li>
<li><strong>SSH 客户端</strong> 需要使用<code>PPK</code>格式的私钥来进行无密码登录。</li>
</ul>
<h2 id="3-1、证书格式的详细信息"><a href="#3-1、证书格式的详细信息" class="headerlink" title="3.1、证书格式的详细信息"></a>3.1、证书格式的详细信息</h2><p>以下是常见证书格式的详细信息，包括扩展名、描述和特点：</p>
<table>
<thead>
<tr>
<th>文件格式</th>
<th>扩展名</th>
<th>描述</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>PEM</strong> （Privacy-Enhanced Mail）</td>
<td><code>.pem</code>, <code>.crt</code>, <code>.cer</code>, <code>.key</code></td>
<td>基于 Base64 编码的格式，用于存储 X.509 证书、公钥、私钥和证书链</td>
<td>- Base64 编码<br>- 以“—–BEGIN CERTIFICATE—–”和“—–END CERTIFICATE—–”包围<br>- 易于阅读和编辑<br></td>
</tr>
<tr>
<td><strong>DER</strong> （Distinguished Encoding Rules）</td>
<td><code>.der</code>, <code>.cer</code></td>
<td>二进制编码格式，用于存储 X.509 证书</td>
<td>- 二进制编码<br>- 更紧凑，不易阅读<br></td>
</tr>
<tr>
<td><strong>PKCS#7</strong> / <strong>P7B</strong> （Public Key Cryptography Standards #7）</td>
<td><code>.p7b</code>, <code>.p7c</code></td>
<td>用于描述加密和签名数据的格式，可以包含多个证书和证书链</td>
<td>- Base64 编码或二进制编码<br>- 以“—–BEGIN PKCS7—–”和“—–END PKCS7—–”包围（Base64 编码）<br>- 不包含私钥<br></td>
</tr>
<tr>
<td><strong>PKCS#12</strong> / <strong>PFX</strong> （Public Key Cryptography Standards #12）</td>
<td><code>.p12</code>, <code>.pfx</code></td>
<td>用于存储证书、公钥和私钥的格式，通常用于导出和导入证书</td>
<td>- 二进制编码<br>- 包含证书、公钥和私钥<br></td>
</tr>
<tr>
<td><strong>JKS</strong> （Java KeyStore）</td>
<td><code>.jks</code></td>
<td>Java 应用程序使用的密钥库格式，用于存储证书和私钥</td>
<td>- 二进制编码<br>- 专用于 Java 应用程序<br>- 包含证书和私钥</td>
</tr>
<tr>
<td><strong>PPK</strong> （PuTTY Private Key）</td>
<td><code>.ppk</code></td>
<td>PuTTY SSH 客户端使用的私钥文件格式</td>
<td>- Base64 编码<br>- 专用于 PuTTY SSH 客户端<br>- 包含私钥</td>
</tr>
<tr>
<td><strong>SPC</strong> （Software Publisher Certificate）</td>
<td><code>.spc</code></td>
<td>用于代码签名的证书文件</td>
<td>- 二进制编码<br>- 包含证书<br>- 常用于 Windows 系统的代码签名</td>
</tr>
<tr>
<td><strong>P7M</strong> （PKCS#7 MIME Message）</td>
<td><code>.p7m</code></td>
<td>用于存储签名和加密的电子邮件消息</td>
<td>- Base64 编码或二进制编码<br>- 以“—–BEGIN PKCS7—–”和“—–END PKCS7—–”包围（Base64 编码）<br>- 包含签名和加密消息</td>
</tr>
<tr>
<td><strong>CSR</strong> （Certificate Signing Request）</td>
<td><code>.csr</code></td>
<td>包含公钥和身份信息的证书签名请求文件</td>
<td>- Base64 编码<br>- 以“—–BEGIN CERTIFICATE REQUEST—–”和“—–END CERTIFICATE REQUEST—–”包围<br>- 用于请求证书签名</td>
</tr>
<tr>
<td><strong>CRT</strong> （Certificate）</td>
<td><code>.crt</code>, <code>.cer</code></td>
<td>用于存储证书，可以是 PEM 或 DER 编码</td>
<td>- Base64 编码或二进制编码<br>- 以“—–BEGIN CERTIFICATE—–”和“—–END CERTIFICATE—–”包围（Base64 编码）<br>- 用于存储证书</td>
</tr>
<tr>
<td><strong>KEY</strong> （Private Key）</td>
<td><code>.key</code></td>
<td>用于存储私钥，可以是 PEM 或 DER 编码</td>
<td>- Base64 编码或二进制编码<br>- 以“—–BEGIN PRIVATE KEY—–”和“—–END PRIVATE KEY—–”包围（Base64 编码）<br>- 用于存储私钥</td>
</tr>
</tbody></table>
<h2 id="3-2、格式转换"><a href="#3-2、格式转换" class="headerlink" title="3.2、格式转换"></a>3.2、格式转换</h2><pre><code>// 将 DER 格式的证书转换为 PEM 格式：
openssl x509 -inform der -in certificate.der -out certificate.pem

// 将 PEM 格式的证书转换为 DER 格式：
openssl x509 -outform der -in certificate.pem -out certificate.der

// PKCS#12 (PFX) to PEM
openssl pkcs12 -in certificate.pfx -out certificate.pem -nodes

// PEM to PKCS#12 (PFX)
openssl pkcs12 -export -out certificate.pfx -inkey privatekey.pem -in certificate.pem -certfile ca-chain.pem

// 将 CSR (证书签名请求) 从 PEM 转换为 DER
openssl req -outform der -in request.csr -out request.der

// 将 DER 转换为 PEM
openssl req -inform der -in request.der -out request.csr -outform pem

// 将私钥从 PEM 转换为 DER
openssl rsa -in privatekey.pem -outform der -out privatekey.der

// 从 PEM 格式的证书和私钥中生成新的 PEM 格式文件
cat certificate.pem privatekey.pem &gt; combined.pem

// 将 RSA 私钥转换为 PKCS#8 格式
openssl pkcs8 -topk8 -inform PEM -outform PEM -in privatekey.pem -out privatekey-pkcs8.pem -nocrypt
</code></pre>
<h1 id="四、数字证书：常用分类"><a href="#四、数字证书：常用分类" class="headerlink" title="四、数字证书：常用分类"></a>四、数字证书：常用分类</h1><p>数字证书有多种类别，每种类别都有其特定的用途和应用场景：</p>
<table>
<thead>
<tr>
<th>证书类别</th>
<th>应用场景</th>
<th>子类别</th>
<th>主要用途和区别</th>
</tr>
</thead>
<tbody><tr>
<td><strong>SSL/TLS 证书</strong></td>
<td>网站安全、电子商务、在线服务</td>
<td>- 域名验证（DV）证书<br>- 组织验证（OV）证书<br>- 扩展验证（EV）证书</td>
<td>- DV：仅验证域名所有权，颁发速度快<br>- OV：验证域名和组织身份<br>- EV：严格验证，包括法律地位，浏览器地址栏显示绿色</td>
</tr>
<tr>
<td><strong>代码签名证书</strong></td>
<td>软件发布、驱动程序签名</td>
<td>- 标准代码签名证书<br>- 驱动程序签名证书</td>
<td>- 标准代码签名：用于常规软件<br>- 驱动程序签名：用于 Windows 驱动程序</td>
</tr>
<tr>
<td><strong>客户端证书</strong></td>
<td>企业内部网络、VPN、安全电子邮件</td>
<td>- 个人证书<br>- 设备证书</td>
<td>- 个人证书：验证个人用户身份<br>- 设备证书：验证设备身份</td>
</tr>
<tr>
<td><strong>S/MIME 证书</strong></td>
<td>电子邮件通信、企业通信</td>
<td>- 个人 S/MIME 证书<br>- 企业 S/MIME 证书</td>
<td>- 个人 S/MIME：用于个人电子邮件<br>- 企业 S/MIME：用于企业电子邮件</td>
</tr>
<tr>
<td><strong>根证书和中间证书</strong></td>
<td>构建证书链、证书颁发</td>
<td>- 根证书<br>- 中间证书</td>
<td>- 根证书：顶端证书，用于签发中间证书<br>- 中间证书：用于签发终端证书，构建信任链</td>
</tr>
<tr>
<td><strong>自签名证书</strong></td>
<td>测试环境、内部应用</td>
<td>- 测试证书<br>- 内部应用证书</td>
<td>- 测试证书：用于开发和测试<br>- 内部应用证书：用于内部网络和应用</td>
</tr>
<tr>
<td><strong>文档签名证书</strong></td>
<td>合同签署、报告签署</td>
<td>- PDF 签名证书<br>- Microsoft Office 签名证书</td>
<td>- PDF 签名：用于签署 PDF 文档<br>- Office 签名：用于签署 Office 文档</td>
</tr>
<tr>
<td><strong>时间戳证书</strong></td>
<td>法律文件、软件发布</td>
<td>- 标准时间戳证书<br>- 合规时间戳证书</td>
<td>- 标准时间戳：用于一般时间戳需求<br>- 合规时间戳：符合法律和行业标准</td>
</tr>
</tbody></table>
<h2 id="4-1、SSL-TLS-证书分类"><a href="#4-1、SSL-TLS-证书分类" class="headerlink" title="4.1、SSL/TLS 证书分类"></a>4.1、SSL/TLS 证书分类</h2><ol>
<li><p><strong>域名验证（DV）证书</strong>：域名验证（<code>DV</code>）证书是最基本的<code>SSL/TLS</code>证书类型。它们仅验证申请者对域名的所有权，不涉及组织身份的验证。<code>DV</code>证书一般用于个人网站/测试使用，<code>DV</code>证书签发速度快、无需人工审核，确保域名验证信息正确的情况下<code>1-15</code>分钟就能签发。<code>DV</code>证书无法为特殊域名/公网IP签发证书（例如：<code>edu</code>、<code>.gov</code>、<code>.org</code>、<code>.jp</code>（国家缩写）等后缀的域名）。<code>DV</code>证书无法将多个域名合并到一张证书内。</p>
<ul>
<li><strong>验证级别</strong>：低</li>
<li><strong>颁发速度</strong>：快，通常几分钟到几小时</li>
<li><strong>适用场景</strong>：个人网站、小型企业网站</li>
<li><strong>成本</strong>：通常较低</li>
</ul>
</li>
<li><p><strong>组织验证（OV）证书</strong>：组织验证（<code>OV</code>）证书不仅验证域名的所有权，还验证申请者的组织身份。<code>CA</code>会对申请者的组织信息进行审核。<code>OV</code>证书是企业<code>SSL</code>证书的首选，通过企业认证确保代表企业<code>SSL</code>证书的真实性，拒绝网站风险。<code>OV</code>证书支持特殊域名的签发，例如<code>gov</code>、<code>edu</code>、<code>.gov</code>、<code>.org</code>、<code>.jp</code>（国家缩写）等。<code>OV</code>证书支持证书合并，多张证书（域名）合并签发。</p>
<ul>
<li><strong>验证级别</strong>：中</li>
<li><strong>颁发速度</strong>：中等，通常几天</li>
<li><strong>适用场景</strong>：中型企业网站、组织网站</li>
<li><strong>成本</strong>：中等</li>
</ul>
</li>
<li><p><strong>扩展验证（EV）证书</strong>：扩展验证（<code>EV</code>）证书是最高级别的<code>SSL/TLS</code>证书。它们进行严格的验证，包括域名所有权、组织身份和法律地位。浏览器地址栏会显示绿色，并显示公司名称。</p>
<ul>
<li><strong>验证级别</strong>：高</li>
<li><strong>颁发速度</strong>：慢，通常几天到几周</li>
<li><strong>适用场景</strong>：大型企业网站、金融机构、电子商务网站</li>
<li><strong>成本</strong>：较高</li>
</ul>
</li>
<li><p><strong>通配符（Wildcard）证书</strong>：通配符（<code>Wildcard</code>）证书可以保护一个域名及其所有子域名。它们通常用于需要保护多个子域名的网站。</p>
<ul>
<li><strong>验证级别</strong>：根据是<code>DV</code>还是<code>OV/EV</code>证书而定</li>
<li><strong>颁发速度</strong>：根据是<code>DV</code>还是<code>OV/EV</code>证书而定</li>
<li><strong>适用场景</strong>：需要保护多个子域名的网站</li>
<li><strong>成本</strong>：通常较高</li>
</ul>
</li>
<li><p><strong>多域名（SAN/UCC）证书</strong>，多域名证书（也称为<code>SAN</code>或<code>UCC</code>证书）可以保护多个不同的域名。这种证书通常用于需要保护多个域名的网站或服务。</p>
<ul>
<li><strong>验证级别</strong>：根据是<code>DV</code>还是<code>OV/EV</code>证书而定</li>
<li><strong>颁发速度</strong>：根据是<code>DV</code>还是<code>OV/EV</code>证书而定</li>
<li><strong>适用场景</strong>：需要保护多个域名的网站或服务</li>
<li><strong>成本</strong>：通常较高</li>
</ul>
</li>
<li><p><strong>自签名证书</strong>：自签名证书是由组织或个人自己生成和签发的<code>SSL/TLS</code>证书，不依赖于外部证书颁发机构<code>（CA）</code>。它们通常用于内部测试和开发环境。</p>
<ul>
<li><strong>验证级别</strong>：无外部验证</li>
<li><strong>颁发速度</strong>：即时</li>
<li><strong>适用场景</strong>：测试环境、内部应用</li>
<li><strong>成本</strong>：免费，但不被外部信任</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>证书类别</th>
<th>描述</th>
<th>验证级别</th>
<th>颁发速度</th>
<th>适用场景</th>
<th>成本</th>
</tr>
</thead>
<tbody><tr>
<td><strong>域名验证（DV）证书</strong></td>
<td>仅验证域名所有权，不涉及组织身份验证</td>
<td>低</td>
<td>快</td>
<td>个人网站、小型企业网站</td>
<td>低</td>
</tr>
<tr>
<td><strong>组织验证（OV）证书</strong></td>
<td>验证域名所有权和组织身份</td>
<td>中</td>
<td>中等</td>
<td>中型企业网站、组织网站</td>
<td>中等</td>
</tr>
<tr>
<td><strong>扩展验证（EV）证书</strong></td>
<td>严格验证域名所有权、组织身份和法律地位，浏览器地址栏显示绿色</td>
<td>高</td>
<td>慢</td>
<td>大型企业网站、金融机构、电子商务网站</td>
<td>高</td>
</tr>
<tr>
<td><strong>通配符（Wildcard）证书</strong></td>
<td>保护一个域名及其所有子域名</td>
<td>根据验证级别而定</td>
<td>根据验证级别而定</td>
<td>需要保护多个子域名的网站</td>
<td>较高</td>
</tr>
<tr>
<td><strong>多域名（SAN/UCC）证书</strong></td>
<td>保护多个不同的域名</td>
<td>根据验证级别而定</td>
<td>根据验证级别而定</td>
<td>需要保护多个域名的网站或服务</td>
<td>较高</td>
</tr>
<tr>
<td><strong>自签名证书</strong></td>
<td>由组织或个人自己生成和签发，不依赖外部 CA</td>
<td>无外部验证</td>
<td>即时</td>
<td>测试环境、内部应用</td>
<td>免费，但不被外部信任</td>
</tr>
</tbody></table>
<h2 id="4-2、如何区分-DV、OV、EV"><a href="#4-2、如何区分-DV、OV、EV" class="headerlink" title="4.2、如何区分 DV、OV、EV"></a>4.2、如何区分 DV、OV、EV</h2><p>域名验证（<code>DV</code>）证书：仅验证域名所有权，通常在“主题”字段中只包含域名信息，<strong>不包含公司或组织信息</strong>。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-727edad570a8d55d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>组织验证（<code>OV</code>）证书：验证域名所有权和组织身份，在“主题”字段中<strong>包含公司或组织信息</strong>。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-3ef23f5708cc3a96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>组织验证（<code>EV</code>）证书：进行严格的验证，包括域名所有权、组织身份和法律地位。在“主题”字段中包含详细的公司或组织信息。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-4f47c07911f06250.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="4-3、SSL-TLS-证书域名"><a href="#4-3、SSL-TLS-证书域名" class="headerlink" title="4.3、SSL/TLS 证书域名"></a>4.3、SSL/TLS 证书域名</h2><p>在<code>SSL/TLS</code>证书中，域名信息存储在证书的特定字段中，这些字段包括<code>Common Name (CN)</code>和<code>Subject Alternative Name (SAN)</code>。域名信息在证书颁发时由证书颁发机构<code>（CA）</code>进行验证，并在客户端（如浏览器）访问网站时进行校验。</p>
<h3 id="4-3-1、域名信息存储位置"><a href="#4-3-1、域名信息存储位置" class="headerlink" title="4.3.1、域名信息存储位置"></a>4.3.1、域名信息存储位置</h3><ol>
<li><code>Common Name (CN)</code><ul>
<li><strong>描述</strong>：<code>Common Name</code>字段通常包含主域名，例如 <code>baidu.com</code>。</li>
<li><strong>使用情况</strong>：早期的 <code>SSL/TLS</code> 证书主要使用<code>CN</code>字段存储域名信息，但现代证书更倾向于使用<code>SAN</code>字段。</li>
</ul>
</li>
<li><code>Subject Alternative Name (SAN)</code><ul>
<li><strong>描述</strong>：<code>Subject Alternative Name</code>字段可以包含多个域名和子域名，是现代<code>SSL/TLS</code>证书中存储域名信息的主要位置。</li>
<li><strong>使用情况</strong>：<code>SAN</code>字段允许一个证书保护多个域名和子域名，例如 <code>baidu.com</code>、<code>www.baidu.cn</code> 。</li>
</ul>
</li>
</ol>
<p>以下是一个包含域名信息的<code>SSL/TLS</code>证书示例：</p>
<pre><code class="plaintext">➜  Desktop openssl x509 -in baidu.pem -text -noout
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            4e:40:03:a6:5e:b6:81:f8:7f:4b:d8:eb
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=BE, O=GlobalSign nv-sa, CN=GlobalSign RSA OV SSL CA 2018
        Validity
            Not Before: Jul  8 01:41:02 2024 GMT
            Not After : Aug  9 01:41:01 2025 GMT
        Subject: C=CN, ST=beijing, L=beijing, O=Beijing Baidu Netcom Science Technology Co., Ltd, CN=baidu.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                ....
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Basic Constraints: critical
                CA:FALSE
            Authority Information Access:
                CA Issuers - URI:http://secure.globalsign.com/cacert/gsrsaovsslca2018.crt
                OCSP - URI:http://ocsp.globalsign.com/gsrsaovsslca2018
            X509v3 Certificate Policies:
                Policy: 1.3.6.1.4.1.4146.1.20
                  CPS: https://www.globalsign.com/repository/
                Policy: 2.23.140.1.2.2
            X509v3 CRL Distribution Points:
                Full Name:
                  URI:http://crl.globalsign.com/gsrsaovsslca2018.crl
            X509v3 Subject Alternative Name:
                DNS:baidu.com, DNS:baifubao.com, DNS:www.baidu.cn, DNS:www.baidu.com.cn, DNS:mct.y.nuomi.com, DNS:apollo.auto, DNS:dwz.cn, DNS:*.baidu.com, DNS:*.baifubao.com, DNS:*.baidustatic.com, DNS:*.bdstatic.com, DNS:*.bdimg.com, DNS:*.hao123.com, DNS:*.nuomi.com, DNS:*.chuanke.com, DNS:*.trustgo.com, DNS:*.bce.baidu.com, DNS:*.eyun.baidu.com, DNS:*.map.baidu.com, DNS:*.mbd.baidu.com, DNS:*.fanyi.baidu.com, DNS:*.baidubce.com, DNS:*.mipcdn.com, DNS:*.news.baidu.com, DNS:*.baidupcs.com, DNS:*.aipage.com, DNS:*.aipage.cn, DNS:*.bcehost.com, DNS:*.safe.baidu.com, DNS:*.im.baidu.com, DNS:*.baiducontent.com, DNS:*.dlnel.com, DNS:*.dlnel.org, DNS:*.dueros.baidu.com, DNS:*.su.baidu.com, DNS:*.91.com, DNS:*.hao123.baidu.com, DNS:*.apollo.auto, DNS:*.xueshu.baidu.com, DNS:*.bj.baidubce.com, DNS:*.gz.baidubce.com, DNS:*.smartapps.cn, DNS:*.bdtjrcv.com, DNS:*.hao222.com, DNS:*.haokan.com, DNS:*.pae.baidu.com, DNS:*.vd.bdstatic.com, DNS:*.cloud.baidu.com, DNS:click.hm.baidu.com, DNS:log.hm.baidu.com, DNS:cm.pos.baidu.com, DNS:wn.pos.baidu.com, DNS:update.pan.baidu.com
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Authority Key Identifier:
                F8:EF:7F:F2:CD:78:67:A8:DE:6F:8F:24:8D:88:F1:87:03:02:B3:EB
            X509v3 Subject Key Identifier:
                AD:CA:00:54:CA:D8:E5:94:B6:8F:83:DA:27:80:28:4E:59:24:3B:18
            CT Precertificate SCTs:
                ....
</code></pre>
<h3 id="4-3-2、域名信息的校验时机"><a href="#4-3-2、域名信息的校验时机" class="headerlink" title="4.3.2、域名信息的校验时机"></a>4.3.2、域名信息的校验时机</h3><ol>
<li><p>证书颁发时：证书颁发机构（<code>CA</code>）在颁发<code>SSL/TLS</code>证书之前会进行域名验证，以确保申请者对域名的所有权。验证方法包括：</p>
<ul>
<li><strong>DNS 验证</strong>：<code>CA</code>要求申请者在域名的<code>DNS</code>记录中添加特定的<code>TXT</code>记录，以证明对域名的控制权。</li>
<li><strong>文件验证</strong>：<code>CA</code>要求申请者在域名对应的网站根目录中上传一个特定文件，以证明对域名的控制权。</li>
<li><strong>电子邮件验证</strong>：<code>CA</code>向域名注册信息中的电子邮件地址发送验证邮件，申请者需要点击邮件中的验证链接。</li>
</ul>
</li>
<li><p>客户端访问时：当客户端（如浏览器）访问一个使用<code>SSL/TLS</code>的网站时，会进行以下校验：</p>
<ul>
<li><strong>证书链验证</strong>：客户端验证证书链的完整性，确保证书是由受信任的<code>CA</code>颁发的。</li>
<li><strong>域名匹配验证</strong>：客户端检查证书中的域名信息（<code>CN</code>和<code>SAN</code>字段）是否与用户访问的域名匹配。如果不匹配，浏览器会显示安全警告。</li>
</ul>
</li>
</ol>
<h1 id="五、证书签发和验签"><a href="#五、证书签发和验签" class="headerlink" title="五、证书签发和验签"></a>五、证书签发和验签</h1><p><img src="https://upload-images.jianshu.io/upload_images/12321605-ea7389e66c7afcbb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="5-1、证书签发"><a href="#5-1、证书签发" class="headerlink" title="5.1、证书签发"></a>5.1、证书签发</h2><p><img src="https://upload-images.jianshu.io/upload_images/12321605-321e6892863c7d58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="5-2、证书链"><a href="#5-2、证书链" class="headerlink" title="5.2、证书链"></a>5.2、证书链</h2><h3 id="5-2-1、什么是证书链？"><a href="#5-2-1、什么是证书链？" class="headerlink" title="5.2.1、什么是证书链？"></a>5.2.1、什么是证书链？</h3><p>证书链（<code>Certificate Chain</code>），也称为证书路径，是指一系列相互信任的证书组成的链条，从最终用户的证书（也称为终端证书或叶证书）开始，经过一个或多个中间证书，最终到达根证书（<code>Root Certificate</code>）。每个证书都由上一级证书颁发机构（<code>CA</code>）签名，形成一条信任链。</p>
<p><strong>证书链的组成部分：</strong></p>
<ol>
<li><p><strong>终端证书（End-Entity Certificate）</strong>：</p>
<ul>
<li>这是实际用于服务器或客户端的证书，例如网站的<code>SSL/TLS</code>证书。</li>
<li>由中间证书或根证书签发。</li>
</ul>
</li>
<li><p><strong>中间证书（Intermediate Certificate）</strong>：</p>
<ul>
<li>由根证书或另一个中间证书签发，用于签发终端证书。</li>
<li>中间证书可以有多个层级，形成中间证书链。</li>
</ul>
</li>
<li><p><strong>根证书（Root Certificate）</strong>：</p>
<ul>
<li>位于证书链的顶端，由受信任的根证书颁发机构（<code>CA</code>）签发。</li>
<li>根证书是自签名的，并且预先安装在操作系统和浏览器中，作为信任的根源。</li>
</ul>
</li>
</ol>
<h3 id="5-2-2、证书链的作用"><a href="#5-2-2、证书链的作用" class="headerlink" title="5.2.2、证书链的作用"></a>5.2.2、证书链的作用</h3><ol>
<li><p><strong>建立信任关系</strong>：证书链通过逐级验证，从终端证书到根证书，建立起一个信任关系。客户端（如浏览器）通过验证整个证书链，确保终端证书是由受信任的<code>CA</code>签发的。</p>
</li>
<li><p><strong>简化证书管理</strong>：使用中间证书可以简化证书管理和部署。根证书通常长期有效，而中间证书和终端证书可以更频繁地更新，以提高安全性。</p>
</li>
<li><p><strong>增强安全性</strong>：证书链通过多级验证机制，增加了攻击者伪造证书的难度。即使某个中间证书被泄露，也可以通过吊销该证书来保护整个信任链。</p>
</li>
<li><p><strong>便于证书撤销</strong>：如果某个中间证书或终端证书被发现存在安全问题，可以通过证书撤销列表（<code>CRL</code>）或在线证书状态协议（<code>OCSP</code>）吊销该证书，确保整个信任链的安全性。</p>
</li>
</ol>
<h3 id="5-2-3、证书链的验证过程"><a href="#5-2-3、证书链的验证过程" class="headerlink" title="5.2.3、证书链的验证过程"></a>5.2.3、证书链的验证过程</h3><ol>
<li><p><strong>用户访问网站</strong>：用户在浏览器中输入网址并访问网站，服务器返回 SSL/TLS 证书和中间证书。</p>
</li>
<li><p><strong>浏览器接收证书链</strong>：浏览器接收终端证书和中间证书，并开始验证证书链。</p>
</li>
<li><p><strong>验证证书链</strong>：浏览器从终端证书开始，逐级验证每个证书的签名，直到到达根证书。浏览器检查每个证书的有效期、签名和吊销状态。</p>
</li>
<li><p><strong>根证书验证</strong>：浏览器检查根证书是否在其预先安装的受信任根证书列表中。如果是，则信任该证书链。</p>
</li>
<li><p><strong>建立安全连接</strong>：如果证书链验证通过，浏览器与服务器之间建立安全的<code>SSL/TLS</code>连接。</p>
</li>
</ol>
<p>以下是一个典型的证书链示例：</p>
<pre><code class="plaintext">Root Certificate (Root CA)
    |
    v
Intermediate Certificate (Intermediate CA)
    |
    v
End-Entity Certificate (www.example.com)
</code></pre>
<h2 id="5-3、-交叉证书"><a href="#5-3、-交叉证书" class="headerlink" title="5.3、 交叉证书"></a>5.3、 交叉证书</h2><p>交叉证书（<code>Cross-Certificate</code>）是一种数字证书，它用于建立两个不同证书颁发机构（<code>CA</code>）之间的信任关系。通常在涉及多个信任域或<code>CA</code>之间的互操作性时会用到交叉证书。交叉证书使两个不同的<code>PKI</code>（<code>Public Key Infrastructure</code>）体系能够互相信任彼此的证书，从而扩展信任链的范围。</p>
<p><strong>交叉证书的应用场景：</strong></p>
<ol>
<li><strong>跨组织信任</strong>： 当两个不同的组织或企业希望互相验证对方的用户或设备时，可能会使用交叉证书来建立相互信任的关系。</li>
<li><strong>过渡期间的信任延续</strong>： 当组织从一个<code>CA</code>迁移到另一个<code>CA</code>时，可以使用交叉证书确保新旧<code>CA</code>之间的互操作性和信任过渡。</li>
<li><strong>多路径验证</strong>： 某些大型组织可能会同时依赖多个<code>CA</code>进行证书签发，交叉证书可以使不同的<code>CA</code>信任链互相验证，确保系统兼容性。</li>
</ol>
<p><strong>交叉证书的工作原理：</strong></p>
<ol>
<li><p><strong>准备证书和密钥</strong>：</p>
<ul>
<li>确保你有两个 <code>CA</code>：<code>CA1</code> 和 <code>CA2</code>。</li>
<li><code>CA1</code> 的私钥和公钥证书。</li>
<li><code>CA2</code> 的私钥和公钥证书。</li>
</ul>
</li>
<li><p><strong>生成证书签名请求（CSR）</strong>：</p>
<ul>
<li>使用<code>CA2</code>的私钥生成一个证书签名请求（<code>CSR</code>）。<code>CSR</code>包含<code>CA2</code>的公钥和一些身份信息。</li>
</ul>
</li>
<li><p><strong>使用 CA1 签名 CA2 的 CSR</strong>：</p>
<ul>
<li>使用<code>CA1</code>的私钥对<code>CA2</code>的<code>CSR</code>进行签名。这一步骤会生成一个新的证书，该证书由<code>CA1</code>签发，并包含<code>CA2</code>的公钥。</li>
</ul>
</li>
<li><p><strong>生成交叉证书</strong>：</p>
<ul>
<li>生成的证书即为交叉证书，它表明<code>CA1</code>信任<code>CA2</code>，并将<code>CA2</code>的公钥包含在其中。</li>
</ul>
</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-e28dc2a6eddc590a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ_1722091218807.png"></p>
<h2 id="5-4、证书验证测试"><a href="#5-4、证书验证测试" class="headerlink" title="5.4、证书验证测试"></a>5.4、证书验证测试</h2><p>我们用<code>Chrome</code>浏览器打开<code>baidu.com</code>，然后如下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-8abb1ec7493f5c9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ_1722056409592.png"></p>
<p>我们可以分别导出中间证书（<code>GlobalSignRSAOVSSLCA2018.pem</code>）和网站证书（<code>baidu.com.pem</code>），同时可以看到根证书（<code>GlobalSign</code>）的序列号是<code>04:00:00:00:00:01:21:58:53:08:A2</code>。</p>
<p>打开<code>Mac</code>系统的<code>KeyChain Access</code>，找到根证书（<code>GlobalSign.pem</code>）导出用于代码测试证书：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-b23df2e3bb8a77f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ_1722056893671.png"></p>
<p>证书校验验证代码如下：</p>
<pre><code>func main() {
    rootCertPath := "./GlobalSign4.pem"
    middleCertPath := "./GlobalSignRSAOVSSLCA2018.pem"
    certPath := "./baidu.com.pem"

    err := verifyCertificate(certPath, middleCertPath, rootCertPath)
    if err != nil {
        log.Fatalf("Certificate verification failed: %v", err)
    }

    fmt.Println("Certificate verification succeeded.")
}

func verifyCertificate(certPath, middleCertPath, rootCertPath string) error {
    roots, err := loadRootCert(rootCertPath)
    if err != nil {
        return err
    }

    intermediates, err := loadRootCert(middleCertPath)
    if err != nil {
        return err
    }

    cert, err := loadCertificate(certPath)
    if err != nil {
        return err
    }

    opts := x509.VerifyOptions{
        Roots:         roots, // 根证书
        Intermediates: intermediates, // 中间证书
    }

    chain1, err := cert.Verify(opts)
    println(chain1)
    return err
}

func loadRootCert(path string) (*x509.CertPool, error) {
    rootPEM, err := ioutil.ReadFile(path)
    if err != nil {
        return nil, fmt.Errorf("failed to read root CA file: %v", err)
    }

    roots := x509.NewCertPool()
    if !roots.AppendCertsFromPEM(rootPEM) {
        return nil, fmt.Errorf("failed to add root CA to pool")
    }

    return roots, nil
}

func loadCertificate(path string) (*x509.Certificate, error) {
    certPEM, err := ioutil.ReadFile(path)
    if err != nil {
        return nil, fmt.Errorf("failed to read certificate file: %v", err)
    }

    block, _ := pem.Decode(certPEM)
    if block == nil || block.Type != "CERTIFICATE" {
        return nil, fmt.Errorf("failed to decode PEM block containing certificate")
    }

    cert, err := x509.ParseCertificate(block.Bytes)
    if err != nil {
        return nil, fmt.Errorf("failed to parse certificate: %v", err)
    }

    return cert, nil
}
</code></pre>
<h1 id="六、如何申请数字证书"><a href="#六、如何申请数字证书" class="headerlink" title="六、如何申请数字证书"></a>六、如何申请数字证书</h1><p><strong>阿里云证书申请：</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-e4302a8c9979bb7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ_1722080736834.png"></p>
<p><strong>acme.sh 免费证书申请：</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.exsvc.cn/article/acme-sh-ssl-install.html">使用 ACME.SH 申请证书</a></p>
<pre><code>export Ali_Key="abcd"
export Ali_Secret="xxxxxxxxxx"
# RSA 证书
acme.sh --issue --dns dns_ali -d fanlv.fun -d fanlv.fun  -d "*.fanlv.fun"  --debug

# 更新证书
$HOME/.acme.sh/acme.sh --renew -d fanlv.fun --force


# 安装证书
$HOME/.acme.sh/acme.sh  --install-cert -d fanlv.fun  -d "*.fanlv.fun"  \
--cert-file      $GOPATH/src/xx/cert.pem  \
--key-file       $GOPATH/src/xx/key.pem
</code></pre>
<h1 id="七、参考资料"><a href="#七、参考资料" class="headerlink" title="七、参考资料"></a>七、参考资料</h1><p><a target="_blank" rel="noopener" href="https://hijiangtao.github.io/2022/11/16/Dig-Out-All-Secrets-Behind-TLS-Certificate-One/">网络安全科普：奇妙的 SSL/TLS 证书</a></p>
<p><a target="_blank" rel="noopener" href="https://scotthelme.co.uk/cross-signing-alternate-trust-paths-how-they-work/">Cross-Signing and Alternate Trust Paths; How They Work</a></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em></section><article class="mt-6 comment-container"><script async repo="fanlv/blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/fanlv"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com/fanlvlgh"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Ryo 2025</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p class="is-flex is-justify-content-center"><a title="备案号：鄂ICP备2022016224号-2" target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">备案号：鄂ICP备2022016224号-2 &nbsp;</a></p></div><div><span>博学之，审问之，慎思之，明辨之，笃行之</span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>