<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>ã€ŠHello Rustã€‹</title><meta name="description" content="è¡Œä¸‡é‡Œè·¯ï¼Œè¯»ä¸‡å·ä¹¦"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?" + '2c076421eb9f21a0a143f8ee9c4ab171';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><meta name="referrer" content="no-referrer"><link rel="icon" href="/null"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="æ‘˜å½•äº Rust ç¨‹åºè®¾è®¡è¯­è¨€ ä¸­æ–‡ç‰ˆ
é›¶ã€Why Rust
Rust æ˜¯ä¸€ç§ä»¤äººå…´å¥‹çš„æ–°ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå¯ä»¥è®©æ¯ä¸ªäººç¼–å†™å¯é ä¸”é«˜æ•ˆçš„è½¯ä»¶ã€‚
å®ƒå¯ä»¥ç”¨æ¥æ›¿æ¢C/C++ï¼ŒRustå’Œä»–ä»¬å…·æœ‰åŒæ ·çš„æ€§èƒ½ï¼Œä½†æ˜¯å¾ˆå¤šå¸¸è§çš„bugåœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥è¢«æ¶ˆç­ã€‚
Rustæ˜¯ä¸€ç§é€šç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯ä»–æ›´å–„äºä»¥ä¸‹åœºæ™¯ï¼š
éœ€è¦è¿è¡Œæ—¶çš„é€Ÿåº¦
éœ€è¦å†…å­˜å®‰å…¨
æ›´å¥½çš„åˆ©ç”¨å¤šå¤„ç†å™¨


Rustå®‰å…¨ã€æ— éœ€GCã€æ˜“äºç»´æŠ¤ã€è°ƒè¯•ã€ä»£ç å®‰å…¨é«˜æ•ˆã€‚
Rustä¼˜ç‚¹ï¼Œæ€§èƒ½ã€å®‰å…¨ã€æ— æ‰€ç•æƒ§çš„å¹¶å‘ã€‚
Rustç‰¹åˆ«æ“…é•¿çš„é¢†åŸŸ
é«˜æ€§èƒ½çš„ Web Service
WebAssembly 
å‘½ä»¤è¡Œå·¥å…·
ç½‘ç»œç¼–ç¨‹
åµŒå…¥å¼è®¾å¤‡
ç³»ç»Ÿç¼–ç¨‹


Googleï¼šæ–°æ“ä½œç³»ç»ŸFuschiaï¼Œå…¶ä¸­Rustä»£ç é‡å¤§çº¦å 30%
Amazonï¼šåŸºäºLinuxå¼€å‘çš„ç›´æ¥å¯ä»¥åœ¨è£¸æœºã€è™šæ‹Ÿæœºä¸Šè¿è¡Œå®¹.."><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Ryo's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ã€ŠHello Rustã€‹</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%B6%E3%80%81Why-Rust"><span class="toc-text">é›¶ã€Why Rust</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83"><span class="toc-text">ä¸€ã€ç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-text">1.1 å®‰è£…é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-text">åŸºæœ¬å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%8C%9C%E6%95%B0%E5%AD%97"><span class="toc-text">äºŒã€çŒœæ•°å­—</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%80%9A%E7%94%A8%E6%80%A7%E5%8F%98%E6%88%90%E6%A6%82%E5%BF%B5"><span class="toc-text">ä¸‰ã€é€šç”¨æ€§å˜æˆæ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%AF%E5%8F%98%E6%80%A7"><span class="toc-text">3.1 å˜é‡å’Œå¯å˜æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">3.2 æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%87%BD%E6%95%B0"><span class="toc-text">3.3 å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-text">3.4 æ§åˆ¶æµ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%AE%A4%E8%AF%86%E6%89%80%E6%9C%89%E6%9D%83"><span class="toc-text">å››ã€è®¤è¯†æ‰€æœ‰æƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%89%80%E6%9C%89%E6%9D%83"><span class="toc-text">4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%BC%95%E7%94%A8%E4%B8%8E%E5%80%9F%E7%94%A8"><span class="toc-text">4.2 å¼•ç”¨ä¸å€Ÿç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%88%87%E7%89%87-Slice-%E7%B1%BB%E5%9E%8B"><span class="toc-text">4.3 åˆ‡ç‰‡ Slice ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81Struct"><span class="toc-text">äº”ã€Struct</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%AE%9A%E4%B9%89%E5%92%8C%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">5.1 å®šä¹‰å’Œä¸¾ä¾‹è¯´æ˜ç»“æ„ä½“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%96%B9%E6%B3%95%E8%AF%AD%E6%B3%95"><span class="toc-text">5.2 æ–¹æ³•è¯­æ³•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-text">å…­ã€æšä¸¾å’Œæ¨¡å¼åŒ¹é…</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE%E3%80%81Option"><span class="toc-text">6.1 å®šä¹‰æšä¸¾ã€Option</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-match-if-%E6%8E%A7%E5%88%B6%E6%B5%81%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">6.2 match&#x2F;if æ§åˆ¶æµè¿ç®—ç¬¦</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BD%BF%E7%94%A8%E5%8C%85%E3%80%81Crate%E5%92%8C%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86%E4%B8%8D%E6%96%AD%E5%A2%9E%E9%95%BF%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-text">ä¸ƒã€ä½¿ç”¨åŒ…ã€Crateå’Œæ¨¡å—ç®¡ç†ä¸æ–­å¢é•¿çš„é¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Packages-%E5%92%8C-crate"><span class="toc-text">7.1 Packages å’Œ crate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%E6%9D%A5%E6%8E%A7%E5%88%B6%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E7%A7%81%E6%9C%89%E6%80%A7"><span class="toc-text">7.2 å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E8%B7%AF%E5%BE%84%E7%94%A8%E4%BA%8E%E5%BC%95%E7%94%A8%E6%A8%A1%E5%9D%97%E6%A0%91%E4%B8%AD%E7%9A%84%E9%A1%B9"><span class="toc-text">7.3 è·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E4%BD%BF%E7%94%A8-use-%E5%85%B3%E9%94%AE%E5%AD%97%E5%B0%86%E5%90%8D%E7%A7%B0%E5%BC%95%E5%85%A5%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text">7.4 ä½¿ç”¨ use å…³é”®å­—å°†åç§°å¼•å…¥ä½œç”¨åŸŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E5%B0%86%E6%A8%A1%E5%9D%97%E5%88%86%E5%89%B2%E8%BF%9B%E4%B8%8D%E5%90%8C%E6%96%87%E4%BB%B6"><span class="toc-text">7.5 å°†æ¨¡å—åˆ†å‰²è¿›ä¸åŒæ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB-%E5%B8%B8%E8%A7%81%E9%9B%86%E5%90%88"><span class="toc-text">å…« å¸¸è§é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-vector"><span class="toc-text">8.1 vector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">8.2 å­—ç¬¦ä¸²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%93%88%E5%B8%8C-map-%E5%82%A8%E5%AD%98%E9%94%AE%E5%80%BC%E5%AF%B9"><span class="toc-text">8.3 å“ˆå¸Œ map å‚¨å­˜é”®å€¼å¯¹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">ä¹ã€é”™è¯¯å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-panic-%E4%B8%8E%E4%B8%8D%E5%8F%AF%E6%81%A2%E5%A4%8D%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-text">9.1 panic! ä¸ä¸å¯æ¢å¤çš„é”™è¯¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Result-%E4%B8%8E%E5%8F%AF%E6%81%A2%E5%A4%8D%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-text">9.2 Result ä¸å¯æ¢å¤çš„é”™è¯¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E4%BD%BF%E7%94%A8-panic-%E8%BF%98%E6%98%AF%E4%B8%8D%E7%94%A8-panic"><span class="toc-text">9.3 ä½¿ç”¨ panic! è¿˜æ˜¯ä¸ç”¨ panic!</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%B3%9B%E5%9E%8B%E3%80%81trait-%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">åã€æ³›å‹ã€trait å’Œç”Ÿå‘½å‘¨æœŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E6%B3%9B%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">10.1 æ³›å‹æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-trait%EF%BC%9A%E5%AE%9A%E4%B9%89%E5%85%B1%E4%BA%AB%E7%9A%84%E8%A1%8C%E4%B8%BA"><span class="toc-text">10.2 traitï¼šå®šä¹‰å…±äº«çš„è¡Œä¸º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%B8%8E%E5%BC%95%E7%94%A8%E6%9C%89%E6%95%88%E6%80%A7"><span class="toc-text">10.3 ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨æœ‰æ•ˆæ€§</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E7%BC%96%E5%86%99%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-text">åäºŒã€ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95"><span class="toc-text">12.1 å¦‚ä½•ç¼–å†™æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E6%8E%A7%E5%88%B6%E6%B5%8B%E8%AF%95%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C"><span class="toc-text">11.2 æ§åˆ¶æµ‹è¯•å¦‚ä½•è¿è¡Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E6%B5%8B%E8%AF%95%E7%9A%84%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84"><span class="toc-text">11.3 æµ‹è¯•çš„ç»„ç»‡ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E4%B8%80%E4%B8%AA-I-O-%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-text">åäºŒã€ä¸€ä¸ª I&#x2F;O é¡¹ç›®ï¼šæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81Rust-%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E8%AF%AD%E8%A8%80%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E9%97%AD%E5%8C%85"><span class="toc-text">åä¸‰ã€Rust ä¸­çš„å‡½æ•°å¼è¯­è¨€åŠŸèƒ½ï¼šè¿­ä»£å™¨ä¸é—­åŒ…</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E9%97%AD%E5%8C%85%EF%BC%9A%E5%8F%AF%E4%BB%A5%E6%8D%95%E8%8E%B7%E5%85%B6%E7%8E%AF%E5%A2%83%E7%9A%84%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="toc-text">13.1 é—­åŒ…ï¼šå¯ä»¥æ•è·å…¶ç¯å¢ƒçš„åŒ¿åå‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E4%BD%BF%E7%94%A8%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%A4%84%E7%90%86%E5%85%83%E7%B4%A0%E5%BA%8F%E5%88%97"><span class="toc-text">13.2 ä½¿ç”¨è¿­ä»£å™¨å¤„ç†å…ƒç´ åºåˆ—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94%EF%BC%9A%E5%BE%AA%E7%8E%AF-VS-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">13.3 æ€§èƒ½å¯¹æ¯”ï¼šå¾ªç¯ VS è¿­ä»£å™¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81Cargo-%E5%92%8C-Crates-io"><span class="toc-text">åå››ã€Cargo å’Œ Crates.io</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-text">åäº”ã€æ™ºèƒ½æŒ‡é’ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-1-%E4%BD%BF%E7%94%A8-Box-%E6%8C%87%E5%90%91%E5%A0%86%E4%B8%8A%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">15.1 ä½¿ç”¨ Box æŒ‡å‘å †ä¸Šçš„æ•°æ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-2-%E9%80%9A%E8%BF%87-Deref-trait-%E5%B0%86%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%BD%93%E4%BD%9C%E5%B8%B8%E8%A7%84%E5%BC%95%E7%94%A8%E5%A4%84%E7%90%86"><span class="toc-text">15.2 é€šè¿‡ Deref trait å°†æ™ºèƒ½æŒ‡é’ˆå½“ä½œå¸¸è§„å¼•ç”¨å¤„ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-3-%E4%BD%BF%E7%94%A8-Drop-Trait-%E8%BF%90%E8%A1%8C%E6%B8%85%E7%90%86%E4%BB%A3%E7%A0%81"><span class="toc-text">15.3. ä½¿ç”¨ Drop Trait è¿è¡Œæ¸…ç†ä»£ç </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-4-Rc-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-text">15.4 Rc å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-5-RefCell-%E5%92%8C%E5%86%85%E9%83%A8%E5%8F%AF%E5%8F%98%E6%80%A7%E6%A8%A1%E5%BC%8F"><span class="toc-text">15.5 RefCell å’Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-6-%E5%BC%95%E7%94%A8%E5%BE%AA%E7%8E%AF%E4%B8%8E%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F"><span class="toc-text">15.6 å¼•ç”¨å¾ªç¯ä¸å†…å­˜æ³„æ¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81%E6%97%A0%E7%95%8F%E5%B9%B6%E5%8F%91"><span class="toc-text">åå…­ã€æ— ç•å¹¶å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#16-1-%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E5%90%8C%E4%B8%80%E6%97%B6%E9%97%B4%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-text">16.1. ä½¿ç”¨çº¿ç¨‹åŒä¸€æ—¶é—´è¿è¡Œä»£ç </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-2-%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E5%9C%A8%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-text">16.2. ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨çº¿ç¨‹é—´é€šä¿¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-3-%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E5%B9%B6%E5%8F%91-Lock"><span class="toc-text">16.3. å…±äº«çŠ¶æ€å¹¶å‘ Lock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-4-%E4%BD%BF%E7%94%A8Sync-%E4%B8%8E-Send-Trait-%E7%9A%84%E5%8F%AF%E6%89%A9%E5%B1%95%E5%B9%B6%E5%8F%91"><span class="toc-text">16.4. ä½¿ç”¨Sync ä¸ Send Trait çš„å¯æ‰©å±•å¹¶å‘</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%83%E3%80%81-Rust-%E7%9A%84%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E7%89%B9%E6%80%A7"><span class="toc-text">åä¸ƒã€ Rust çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ç‰¹æ€§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%85%AB%E3%80%81%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-text">åå…«ã€æ¨¡å¼åŒ¹é…</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B9%9D%E3%80%81%E9%AB%98%E7%BA%A7%E7%89%B9%E5%BE%81"><span class="toc-text">åä¹ã€é«˜çº§ç‰¹å¾</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#19-1-unsafe-Rust"><span class="toc-text">19.1 unsafe Rust</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-2-%E9%AB%98%E7%BA%A7-trait"><span class="toc-text">19.2. é«˜çº§ trait</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-3-%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B"><span class="toc-text">19.3. é«˜çº§ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-4-%E9%AB%98%E7%BA%A7%E5%87%BD%E6%95%B0%E4%B8%8E%E9%97%AD%E5%8C%85"><span class="toc-text">19.4. é«˜çº§å‡½æ•°ä¸é—­åŒ…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-5-%E5%AE%8F"><span class="toc-text">19.5. å®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E5%8D%81%E3%80%81%E6%9C%80%E5%90%8E%E7%9A%84%E9%A1%B9%E7%9B%AE-%E6%9E%84%E5%BB%BA%E5%A4%9A%E7%BA%BF%E7%A8%8B-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">äºŒåã€æœ€åçš„é¡¹ç›®: æ„å»ºå¤šçº¿ç¨‹ Web æœåŠ¡å™¨</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Rust"><i class="tag post-item-tag">Rust</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">ã€ŠHello Rustã€‹</h1><time class="has-text-grey" datetime="2023-02-18T02:08:08.000Z">2023-02-18</time><article class="mt-2 post-content"><p>æ‘˜å½•äº <a target="_blank" rel="noopener" href="https://www.rustwiki.org.cn/zh-CN/book/title-page.html">Rust ç¨‹åºè®¾è®¡è¯­è¨€ ä¸­æ–‡ç‰ˆ</a></p>
<h1 id="é›¶ã€Why-Rust"><a href="#é›¶ã€Why-Rust" class="headerlink" title="é›¶ã€Why Rust"></a>é›¶ã€Why Rust</h1><ul>
<li><code>Rust</code> æ˜¯ä¸€ç§ä»¤äººå…´å¥‹çš„æ–°ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå¯ä»¥è®©æ¯ä¸ªäººç¼–å†™å¯é ä¸”é«˜æ•ˆçš„è½¯ä»¶ã€‚</li>
<li>å®ƒå¯ä»¥ç”¨æ¥æ›¿æ¢<code>C/C++</code>ï¼Œ<code>Rust</code>å’Œä»–ä»¬å…·æœ‰åŒæ ·çš„æ€§èƒ½ï¼Œä½†æ˜¯å¾ˆå¤šå¸¸è§çš„<code>bug</code>åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥è¢«æ¶ˆç­ã€‚</li>
<li><code>Rust</code>æ˜¯ä¸€ç§é€šç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯ä»–æ›´å–„äºä»¥ä¸‹åœºæ™¯ï¼š<ul>
<li>éœ€è¦è¿è¡Œæ—¶çš„é€Ÿåº¦</li>
<li>éœ€è¦å†…å­˜å®‰å…¨</li>
<li>æ›´å¥½çš„åˆ©ç”¨å¤šå¤„ç†å™¨</li>
</ul>
</li>
<li><code>Rust</code>å®‰å…¨ã€æ— éœ€<code>GC</code>ã€æ˜“äºç»´æŠ¤ã€è°ƒè¯•ã€ä»£ç å®‰å…¨é«˜æ•ˆã€‚</li>
<li><code>Rust</code>ä¼˜ç‚¹ï¼Œæ€§èƒ½ã€å®‰å…¨ã€æ— æ‰€ç•æƒ§çš„å¹¶å‘ã€‚</li>
<li><code>Rust</code>ç‰¹åˆ«æ“…é•¿çš„é¢†åŸŸ<ul>
<li>é«˜æ€§èƒ½çš„ <code>Web Service</code></li>
<li><code>WebAssembly</code> </li>
<li>å‘½ä»¤è¡Œå·¥å…·</li>
<li>ç½‘ç»œç¼–ç¨‹</li>
<li>åµŒå…¥å¼è®¾å¤‡</li>
<li>ç³»ç»Ÿç¼–ç¨‹</li>
</ul>
</li>
<li><code>Google</code>ï¼šæ–°æ“ä½œç³»ç»Ÿ<code>Fuschia</code>ï¼Œå…¶ä¸­<code>Rust</code>ä»£ç é‡å¤§çº¦å <code>30%</code></li>
<li><code>Amazon</code>ï¼šåŸºäº<code>Linux</code>å¼€å‘çš„ç›´æ¥å¯ä»¥åœ¨è£¸æœºã€è™šæ‹Ÿæœºä¸Šè¿è¡Œå®¹å™¨çš„æ“ä½œç³»ç»Ÿ</li>
<li><code>System76</code>ï¼šçº¯<code>Rust</code>å¼€å‘äº†ä¸‹ä¸€ä»£å®‰å…¨æ“ä½œç³»ç»Ÿ<code>Redox</code></li>
<li>èš‚èšé‡‘æœï¼šåº“æ“ä½œç³»ç»Ÿ<code>Occlum</code></li>
<li>å¾®è½¯ï¼šæ­£åœ¨ç”¨<code>Rust</code>é‡å†™<code>Windows</code>ç³»ç»Ÿä¸­çš„ä¸€äº›ä½çº§ç»„ä»¶ã€‚ <code>WINRT/Rust</code>é¡¹ç›®</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.oschina.net/news/221174/linux-6-1-released">Linux 6.1 æ­£å¼å‘å¸ƒï¼Œå¸¦æœ‰ MGLRUã€åˆå§‹ Rust æ”¯æŒ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.infoq.cn/article/uyhdleo68ycy5jntwxkv">2022 å¹´ï¼ŒRust å°†æˆä¸º Linux å†…æ ¸ç¬¬äºŒå®˜æ–¹è¯­è¨€ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.infoq.cn/article/UpEHUe43yhWZaictYG0u">è°·æ­Œå®£å¸ƒæ”¯æŒä½¿ç”¨ Rust å¼€å‘ Chromium</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/557831914">ä¸ºä»€ä¹ˆRustè¿ç»­ä¸‰å¹´æˆä¸ºæœ€å—æ¬¢è¿çš„è¯­è¨€ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.infoq.cn/article/oma1qjcgtbdhq34sb2hh">è°·æ­Œå®£å¸ƒAndroid å¼€æºé¡¹ç›®ï¼ˆAOSPï¼‰ç°åœ¨æ”¯æŒRust ç¼–ç¨‹è¯­è¨€æ¥å¼€å‘OS</a></p>
<h1 id="ä¸€ã€ç¯å¢ƒ"><a href="#ä¸€ã€ç¯å¢ƒ" class="headerlink" title="ä¸€ã€ç¯å¢ƒ"></a>ä¸€ã€ç¯å¢ƒ</h1><h2 id="1-1-å®‰è£…é…ç½®"><a href="#1-1-å®‰è£…é…ç½®" class="headerlink" title="1.1 å®‰è£…é…ç½®"></a>1.1 å®‰è£…é…ç½®</h2><p>ä¸€èˆ¬å¤§å®¶éƒ½æ˜¯ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://rustup.rs/">rustup</a> è¿›è¡Œ <code>Rust</code> å·¥å…·é“¾çš„å®‰è£…å’Œç®¡ç†ï¼Œåªéœ€è¦æ ¹æ®å®˜æ–¹ç½‘ç«™ä¸Šçš„è¯´æ˜å…ˆå®‰è£… <code>rustup</code> å³å¯~</p>
<pre><code># å¯ä»¥å…ˆæ‰§è¡Œè¿™ä¸¤è¡Œï¼Œrsproxy æ˜¯æˆ‘ä»¬ç»´æŠ¤çš„é•œåƒï¼Œå¯ä»¥åŠ é€Ÿä¸‹è½½
$ export RUSTUP_DIST_SERVER="https://rsproxy.cn"
$ export RUSTUP_UPDATE_ROOT="https://rsproxy.cn/rustup"

# æˆ–è€…æŠŠè¿™ä¸¤è¡ŒåŠ å…¥åˆ°ä½ çš„ ~/.zshrc æˆ–è€… ~/.profile æ–‡ä»¶ä¸­ï¼Œå¹¶ source ä¸€æ¬¡
$ echo 'export RUSTUP_DIST_SERVER="https://rsproxy.cn"' &gt;&gt; ~/.zshrc
$ echo 'export RUSTUP_UPDATE_ROOT="https://rsproxy.cn/rustup"' &gt;&gt; ~/.zshrc
$ source ~/.zshrc

# æ‰§è¡Œå®‰è£…å‘½ä»¤
$ curl --proto '=https' --tlsv1.2 -sSf https://rsproxy.cn/rustup-init.sh | sh
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ <code>cargo</code> ä½¿ç”¨çš„æºï¼š</p>
<pre><code>$ mkdir -p ~/.cargo
$ vim ~/.cargo/config
</code></pre>
<p>è¾“å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜é€€å‡ºï¼š</p>
<pre><code># åŠ é€Ÿä¸‹è½½
[source.crates-io]
replace-with = 'rsproxy'

[source.rsproxy]
registry = "https://rsproxy.cn/crates.io-index"

[registries.rsproxy]
index = "https://rsproxy.cn/crates.io-index"

# å…¬å¸å†… Registry
[source.crates-byted]
registry = "https://code.byted.org/rust-lang/crates.byted.org-index"

[registries.crates-byted]
index = "https://code.byted.org/rust-lang/crates.byted.org-index"

[net]
git-fetch-with-cli = true
</code></pre>
<h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><pre><code>$ rustup update
$ rustup self uninstall
$ rustc main.rs

$ cargo --version
$ cargo new hello_cargo
$ cargo new add-one --lib
$ cd hello_cargo
$ cargo build
$ cargo run
$ cargo check

å¯ä»¥ä½¿ç”¨ cargo build æ„å»ºé¡¹ç›®ã€‚
å¯ä»¥ä½¿ç”¨ cargo run ä¸€æ­¥æ„å»ºå¹¶è¿è¡Œé¡¹ç›®ã€‚
å¯ä»¥ä½¿ç”¨ cargo check æ„å»ºé¡¹ç›®è€Œæ— éœ€ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶æ¥æ£€æŸ¥é”™è¯¯ã€‚
æœ‰åˆ«äºå°†æ„å»ºç»“æœæ”¾åœ¨ä¸æºç ç›¸åŒçš„ç›®å½•ï¼ŒCargo ä¼šå°†å…¶æ”¾åˆ° target/debug ç›®å½•ã€‚
</code></pre>
<h1 id="äºŒã€çŒœæ•°å­—"><a href="#äºŒã€çŒœæ•°å­—" class="headerlink" title="äºŒã€çŒœæ•°å­—"></a>äºŒã€çŒœæ•°å­—</h1><pre><code>#![allow(unused)]

use std::{io, process};
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    let mut guess = 0;
    let secret_number = rand::thread_rng().gen_range(1..101);

    loop {
        let mut input_str = String::new();
        println!("Please input a number : ");

        io::stdin()
            .read_line(&amp;mut input_str)
            .expect("failed read line");

        println!("your input str is {}", input_str);

        let input_str = input_str.trim();

        match input_str.parse() {
            Ok(t) =&gt; {
                guess = t;
            }
            Err(e) =&gt; {
                println!(
                    "\"{}\" is not a number! err = {}, Please re-input again.",
                    input_str, e
                );
                guess = 0;
                continue
            }
        }

        match guess.cmp(&amp;secret_number) {
            Ordering::Less =&gt; println!("Too small!"),
            Ordering::Greater =&gt; println!("Too big!"),
            Ordering::Equal =&gt; {
                println!("You win!");
                break
            },
        }

    }

    // let guess: u32 = input_str.parse().expect("Not a number!");
    println!("you input number is {} , bye.", guess);
}
</code></pre>
<h1 id="ä¸‰ã€é€šç”¨æ€§å˜æˆæ¦‚å¿µ"><a href="#ä¸‰ã€é€šç”¨æ€§å˜æˆæ¦‚å¿µ" class="headerlink" title="ä¸‰ã€é€šç”¨æ€§å˜æˆæ¦‚å¿µ"></a>ä¸‰ã€é€šç”¨æ€§å˜æˆæ¦‚å¿µ</h1><h2 id="3-1-å˜é‡å’Œå¯å˜æ€§"><a href="#3-1-å˜é‡å’Œå¯å˜æ€§" class="headerlink" title="3.1 å˜é‡å’Œå¯å˜æ€§"></a>3.1 å˜é‡å’Œå¯å˜æ€§</h2><p>å˜é‡å’Œå¸¸é‡ Demo</p>
<pre><code>fn main() {
    println!("Hello, world!");

    let x = 5; // let mut x = 5;
    println!("The value of x is: {}", x);
    x = 6; //  æ˜¯ä¸å¯å˜å˜é‡ è¿™é‡Œä¼šæŠ¥é”™ï¼Œcannot assign twice to immutable variable
    println!("The value of x is: {}", x);


    // å¸¸é‡ï¼Œ å‘½åè§„èŒƒ å¤§å†™å­—æ¯åŠ ä¸‹åˆ’çº¿
    const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;

    // é®è”½/éšè—ï¼ˆShadowingï¼‰
    let x = x + 1;
    {
        let x = x * 2;
        println!("The value of x in the inner scope is: {}", x);
    }
    println!("The value of x is: {}", x);

    let spaces = "   "; // å­—ç¬¦ä¸²åˆ‡ç‰‡
    let spaces = spaces.len(); // usize ç±»å‹ arch
    println!("The value of spaces is: {}", spaces);

}
</code></pre>
<h2 id="3-2-æ•°æ®ç±»å‹"><a href="#3-2-æ•°æ®ç±»å‹" class="headerlink" title="3.2 æ•°æ®ç±»å‹"></a>3.2 æ•°æ®ç±»å‹</h2><p><code>Rust</code> çš„æ¯ä¸ªå€¼éƒ½æœ‰ç¡®åˆ‡çš„æ•°æ®ç±»å‹ï¼ˆ<code>data type</code>ï¼‰ï¼Œ<code>Rust</code> æ˜¯ä¸€ç§é™æ€ç±»å‹ï¼ˆ<code>statically typed</code>ï¼‰çš„è¯­è¨€ã€‚</p>
<pre><code>let guess: u32 = "42".parse().expect("Not a number!");
let guess:_ = "42".parse().expect("Not a number!"); // ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¼šæŠ¥é”™
</code></pre>
<p><strong>æ ‡é‡ç±»å‹</strong>ï¼šä¸€ä¸ªæ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼</p>
<p><code>Rust</code> æœ‰å››ä¸ªä¸»è¦çš„æ ‡é‡ç±»å‹ï¼š<code>æ•´æ•°ç±»å‹</code>ã€<code>æµ®ç‚¹ç±»å‹</code>ã€<code>å¸ƒå°”ç±»å‹</code>ã€<code>å­—ç¬¦ç±»å‹</code></p>
<p>æ— ç¬¦å·ç±»å‹<code>u</code>å¼€å¤´ï¼Œæœ‰ç¬¦å·ç±»å‹<code>i</code>å¼€å¤´ï¼Œ<code>i8</code>ã€<code>i16</code>ã€<code>i32</code>ã€<code>i64</code>ã€<code>i128</code>ã€<code>isize</code></p>
<table>
<thead>
<tr>
<th>æ•°å­—å­—é¢é‡</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>åè¿›åˆ¶</td>
<td><code>98_222</code></td>
</tr>
<tr>
<td>åå…­è¿›åˆ¶</td>
<td><code>0xff</code></td>
</tr>
<tr>
<td>å…«è¿›åˆ¶</td>
<td><code>0o77</code></td>
</tr>
<tr>
<td>äºŒè¿›åˆ¶</td>
<td><code>0b1111_0000</code></td>
</tr>
<tr>
<td>å­—èŠ‚ (ä»…é™äº <code>u8</code>)</td>
<td><code>b'A'</code></td>
</tr>
</tbody></table>
<pre><code>fn main() {
    let x = 2.0; // f64
    let y: f32 = 3.0; // f32

    // æ•°å­—è¿ç®—
    // addition
    let sum = 5 + 10;
    // subtraction
    let difference = 95.5 - 4.3;
    // multiplication
    let product = 4 * 30;
    // division
    let quotient = 56.7 / 32.2;
    let floored = 2 / 3; // Results in 0
    // remainder
    let remainder = 43 % 5;

    // å¸ƒå°”ç±»å‹
    let t = true;
    let f: bool = false; // with explicit type annotation

    // å­—ç¬¦ç±»å‹
    let c = 'z';
    let z = 'â„¤';
    let heart_eyed_cat = 'ğŸ˜»';
}
</code></pre>
<p>å¤åˆç±»å‹ï¼ˆ<code>compound type</code>ï¼‰å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚<code>Rust</code> æœ‰ä¸¤ç§åŸºæœ¬çš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆ<code>tuple</code>ï¼‰å’Œæ•°ç»„ï¼ˆ<code>array</code>ï¼‰ã€‚</p>
<pre><code>fn main() {
    let x: (i32, f64, u8) = (500, 6.4, 1); // å…ƒç»„
    let five_hundred = x.0; // ç‚¹æ ‡è®°æ³•è®¿é—®
    let six_point_four = x.1;
    let one = x.2;
    
    // æ•°ç»„é•¿åº¦ä¸å˜ï¼Œvector é•¿åº¦å¯å˜
    let a = [1, 2, 3, 4, 5]; // æ•°ç»„
    let first = a[0];
   let second = a[1];
   
   a[99] // index out of bound
   // RUST_BACKTRACE = 1
}
</code></pre>
<h2 id="3-3-å‡½æ•°"><a href="#3-3-å‡½æ•°" class="headerlink" title="3.3 å‡½æ•°"></a>3.3 å‡½æ•°</h2><p><code>parameters</code>è¡¨ç¤ºå½¢å‚ï¼Œ<code>arguments</code>è¡¨ç¤ºå®å‚ã€‚</p>
<pre><code>fn another_function() { // snake case å‘½åè§„èŒƒ
    println!("Another function.");
}

fn print_labeled_measurement(value: i32, unit_label: char) {
    println!("The measurement is: {}{}", value, unit_label);
}

fn five() -&gt; i32 {
    5 // è¡¨ç¤ºè¿”å› 5 ï¼ˆå¯ä»¥ä¸éœ€è¦ returnï¼‰
}

fn plus_one(x: i32) -&gt; i32 {
    x + 1
    // x + 1; // è¿™ä¸ªè¡¨ç¤ºè¿”å›ä¸€ä¸ªç©ºçš„å…ƒç»„ "()"
}
</code></pre>
<h2 id="3-4-æ§åˆ¶æµ"><a href="#3-4-æ§åˆ¶æµ" class="headerlink" title="3.4 æ§åˆ¶æµ"></a>3.4 æ§åˆ¶æµ</h2><pre><code>fn main() {
    let number = 6;

    if number % 4 == 0 {
        println!("number is divisible by 4");
    } else if number % 3 == 0 {
        println!("number is divisible by 3");
    } else if number % 2 == 0 {
        println!("number is divisible by 2");
    } else {
        println!("number is not divisible by 4, 3, or 2");
    }
    
   let condition = true;
  let number = if condition { 5 } else { 6 };

    println!("The value of number is: {}", number);

    // rust æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œå¿…é¡»åœ¨ç¼–è¯‘æ—¶å€™ç¡®å˜é‡ç±»å‹
  let number = if condition { 5 } else { "six" }; // ä¼šæŠ¥é”™ï¼Œç±»å‹ä¸ä¸€è‡´
  
     let mut count = 0;
    'counting_up: loop {
        println!("count = {}", count);
        let mut remaining = 10;

        loop {
            println!("remaining = {}", remaining);
            if remaining == 9 {
                break;
            }
            if count == 2 {
                break 'counting_up;
            }
            remaining -= 1;
        }

        count += 1;
    }


    let mut counter = 0;

    let result = loop { // ä»å¾ªç¯è¿”å›
        counter += 1;

        if counter == 10 {
            break counter * 2;
        }
    };


    // while
    let mut number = 3;

    while number != 0 {
        println!("{}!", number);

        number -= 1;
    }


    // for
    let a = [10, 20, 30, 40, 50];

    for element in a { 
        println!("the value is: {}", element);
    }
    
     for number in (1..4).rev() {
        println!("{}!", number);
    }

}
</code></pre>
<h1 id="å››ã€è®¤è¯†æ‰€æœ‰æƒ"><a href="#å››ã€è®¤è¯†æ‰€æœ‰æƒ" class="headerlink" title="å››ã€è®¤è¯†æ‰€æœ‰æƒ"></a>å››ã€è®¤è¯†æ‰€æœ‰æƒ</h1><p>æ‰€æœ‰æƒï¼ˆç³»ç»Ÿï¼‰æ˜¯ <code>Rust</code> æœ€ä¸ºä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼Œå®ƒè®© <code>Rust</code> æ— éœ€åƒåœ¾å›æ”¶å™¨ï¼ˆ<code>garbage collector</code>ï¼‰å³å¯ä¿è¯å†…å­˜å®‰å…¨ã€‚å› æ­¤ï¼Œç†è§£ <code>Rust</code> ä¸­æ‰€æœ‰æƒçš„è¿ä½œæ–¹å¼éå¸¸é‡è¦ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ‰€æœ‰æƒä»¥åŠç›¸å…³åŠŸèƒ½ï¼šå€Ÿç”¨ã€<code>slice</code> ä»¥åŠ <code>Rust</code> å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜æ”¾æ•°æ®ã€‚</p>
<h2 id="4-1-ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ"><a href="#4-1-ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ"></a>4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ</h2><ul>
<li><code>Rust</code>çš„æ ¸å¿ƒç‰¹æ€§å°±æ˜¯æ‰€æœ‰æƒ</li>
<li>æ‰€æœ‰ç¨‹åºåœ¨è¿è¡Œæ—¶éƒ½å¿…é¡»ç®¡ç†ä»–ä»¬ä½¿ç”¨çš„è®¡ç®—æœºå†…å­˜çš„æ–¹å¼<ul>
<li>æœ‰äº›è¯­è¨€æœ‰åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒä»¬ä¼šä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜</li>
<li>åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œç¨‹åºå‘˜å¿…é¡»æ˜¾ç¤ºçš„åˆ†é…å’Œé‡Šæ”¾å†…å­˜</li>
</ul>
</li>
<li><code>Rust</code> é‡‡ç”¨äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼š<ul>
<li>å†…å­˜æ˜¯é€šè¿‡ä¸€ä¸ªæ‰€æœ‰æƒç³»ç»Ÿæ¥ç®¡ç†çš„ï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ£€æµ‹çš„è§„åˆ™ </li>
</ul>
</li>
</ul>
<p><code>Stack Vs Heap</code></p>
<ul>
<li><code>Stack</code> æŒ‰å€¼çš„æ¥å—é¡ºåºæ¥å­˜å‚¨ï¼ŒæŒ‰ç›¸åçš„é¡ºåºå°†ä»–ä»¬ç§»é™¤ï¼ˆåè¿›å…ˆå‡ºï¼Œ<code>LIFO</code>ï¼‰<ul>
<li>æ‰€æœ‰å­˜åœ¨åœ¨<code>Stack</code>ä¸Šçš„æ•°æ®æˆ–è¿è¡Œæ—¶å¤§å°å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æ•°æ®å¿…é¡»å­˜æ”¾åœ¨<code>heap</code>ä¸Šã€‚</li>
<li>æŒ‡é’ˆæ˜¯å·²çŸ¥å›ºå®šçš„å¤§å°ï¼Œå¯ä»¥æŠŠæŒ‡é’ˆå­˜åœ¨<code>Stack</code>ä¸Šã€‚</li>
</ul>
</li>
<li><code>Heap</code>å†…å­˜ç»„ç»‡æ€§å·®ä¸€äº›<ul>
<li>å½“ä½ æŠŠæ•°æ®æ”¾åœ¨<code>heap</code>æ—¶ï¼Œä½ ä¼šè¯·æ±‚ä¸€å®šæ•°æ®é‡çš„ç©ºé—´</li>
<li>æ“ä½œç³»ç»Ÿåœ¨<code>heap</code>é‡Œæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´ï¼Œæ ‡è®°ä¸ºåœ¨ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç©ºé—´çš„åœ°å€ã€‚</li>
<li>è¿™ä¸ªè¿‡ç¨‹å«åšåœ¨<code>heap</code>ä¸Šè¿›è¡Œåˆ†é…ï¼Œæœ‰æ—¶å€™ä»…ä»…æˆä¸ºâ€œåˆ†é…â€</li>
</ul>
</li>
</ul>
<p><strong>æ‰€æœ‰æƒè§„åˆ™</strong></p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰€æœ‰æƒçš„è§„åˆ™ã€‚å½“æˆ‘ä»¬é€šè¿‡ä¸¾ä¾‹è¯´æ˜æ—¶ï¼Œè¯·è°¨è®°è¿™äº›è§„åˆ™ï¼š</p>
<ul>
<li>Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºå…¶ <strong>æ‰€æœ‰è€…</strong>ï¼ˆ<em>owner</em>ï¼‰çš„å˜é‡ã€‚</li>
<li>å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚</li>
<li>å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚</li>
</ul>
<p>ç¤ºä¾‹</p>
<pre><code>fn main() {    
    let mut s = String::from("hello");
    s.push_str(", world!"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼
    println!("{}", s); // å°†æ‰“å° `hello, world!`


    let x = 5;
    let y = x; // ç¼–è¯‘çš„æ—¶å€™å°±ç¡®å®šäº†å¤§å°ï¼Œåœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œä¼šè‡ªåŠ¨å¤åˆ¶ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ‰€æœ‰æƒè½¬ç§»çš„é—®é¢˜ã€‚
    println!("x = {}, y = {}", x, y);


    // æ•°æ®ç±»å‹
    let s1 = String::from("hello");
    let s2 = s1; // ï¼ï¼ï¼ï¼ ã€s1 value moved hereã€‘
    println!("The value of s1 is: {}", s1); // ä¼šæŠ¥é”™ value borrowed here after move
    println!("The value of s2 is: {}", s2);

    let s1 = String::from("hello");
    let s2 = s1.clone(); // æ·±æ‹·è´

    println!("s1 = {}, s2 = {}", s1, s2);
    
    let s1 = "abc"; // å­—ç¬¦ä¸²å­—é¢é‡
    let s2 = s1 + "cdf"; // æŠ¥é”™ cannot add `&amp;str` to `&amp;str`
    let s2 = s1.to_owned() + "cdf"; // String + &amp;str
    println!("s1 = {} , s2 = {}", s1, s2); // æŠ¥é”™ cannot be used to concatenate two `&amp;str` strings

}

#[cfg(not(no_global_oom_handling))]
#[stable(feature = "rust1", since = "1.0.0")]
impl Add&lt;&amp;str&gt; for String {
    type Output = String;

    #[inline]
    fn add(mut self, other: &amp;str) -&gt; String {
        self.push_str(other);
        self
    }
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-f5e60955a21de9cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><code>Rust</code> æœ‰ä¸€ä¸ªå«åš <code>Copy trait</code> çš„ç‰¹æ®Šæ ‡æ³¨ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·çš„å­˜å‚¨åœ¨æ ˆä¸Šçš„ç±»å‹ä¸Šã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† <code>Copy trait</code>ï¼Œé‚£ä¹ˆä¸€ä¸ªæ—§çš„å˜é‡åœ¨å°†å…¶èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ã€‚<code>Rust</code> ä¸å…è®¸è‡ªèº«æˆ–å…¶ä»»ä½•éƒ¨åˆ†å®ç°äº† <code>Drop trait </code>çš„ç±»å‹ä½¿ç”¨ <code>Copy trait</code>ã€‚å¦‚æœæˆ‘ä»¬å¯¹å…¶å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶éœ€è¦ç‰¹æ®Šå¤„ç†çš„ç±»å‹ä½¿ç”¨ <code>Copy</code> æ ‡æ³¨ï¼Œå°†ä¼šå‡ºç°ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚è¦å­¦ä¹ å¦‚ä½•ä¸ºä½ çš„ç±»å‹æ·»åŠ  <code>Copy</code> æ ‡æ³¨ä»¥å®ç°è¯¥ <code>trait</code>ã€‚</p>
<p>ä»»ä½•ä¸€ç»„ç®€å•æ ‡é‡å€¼çš„ç»„åˆéƒ½å¯ä»¥å®ç° <code>Copy</code>ï¼Œä»»ä½•ä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹éƒ½å¯ä»¥å®ç° <code>Copy</code> ã€‚å¦‚ä¸‹æ˜¯ä¸€äº› <code>Copy</code> çš„ç±»å‹ï¼š</p>
<ul>
<li>æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ <code>u32</code>ã€‚</li>
<li>å¸ƒå°”ç±»å‹ï¼Œ<code>bool</code>ï¼Œå®ƒçš„å€¼æ˜¯ <code>true</code> å’Œ <code>false</code>ã€‚</li>
<li>æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ <code>f64</code>ã€‚</li>
<li>å­—ç¬¦ç±»å‹ï¼Œ<code>char</code>ã€‚</li>
<li>å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½å®ç° <code>Copy</code> çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ<code>(i32, i32)</code> å®ç°äº† <code>Copy</code>ï¼Œä½† <code>(i32, String) </code>å°±æ²¡æœ‰ã€‚</li>
</ul>
<p><strong>æ‰€æœ‰æƒä¸å‡½æ•°</strong></p>
<pre><code>fn main() {
  let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ
  takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                  // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

  let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ
  makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                  // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x
} // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
  println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
  println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
</code></pre>
<p><strong>è¿”å›å€¼ä¸ä½œç”¨åŸŸ</strong></p>
<pre><code>fn main() {
  let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                      // ç§»ç»™ s1
  let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ
  let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                      // takes_and_gives_back ä¸­,
                                      // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3
} // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

fn gives_ownership() -&gt; String {           // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™
                                           // è°ƒç”¨å®ƒçš„å‡½æ•°
  let some_string = String::from("yours"); // some_string è¿›å…¥ä½œç”¨åŸŸ
  some_string                              // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}

// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
fn takes_and_gives_back(a_string: String) -&gt; String { // a_string è¿›å…¥ä½œç”¨åŸŸ
  a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}
</code></pre>
<h2 id="4-2-å¼•ç”¨ä¸å€Ÿç”¨"><a href="#4-2-å¼•ç”¨ä¸å€Ÿç”¨" class="headerlink" title="4.2 å¼•ç”¨ä¸å€Ÿç”¨"></a>4.2 å¼•ç”¨ä¸å€Ÿç”¨</h2><p>æˆ‘ä»¬æŠŠ<code>å¼•ç”¨</code>ä½œä¸ºå‡½æ•°çš„<code>å‚æ•°</code>ï¼Œè¿™ä¸ªè¡Œä¸ºå«åš<code>å€Ÿç”¨</code></p>
<pre><code>fn main() {
    let s1 = String::from("hello");
    let len = calculate_length(&amp;s1);
    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &amp;String) -&gt; usize { // s æ˜¯å¯¹ String çš„å¼•ç”¨
    s.push_str(", world"); // æŠ¥é”™ `s` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable
    s.len()
} // è¿™é‡Œï¼Œs ç¦»å¼€äº†ä½œç”¨åŸŸã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰å¼•ç”¨å€¼çš„æ‰€æœ‰æƒï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ
</code></pre>
<p>å¯å˜å¼•ç”¨</p>
<pre><code>fn main() {
    let mut s = String::from("hello");

    change(&amp;mut s);
    let mut s = String::from("hello");
    let r1 = &amp;mut s;
    let r2 = &amp;mut s; // æŠ¥é”™ï¼Œcannot borrow `s` as mutable more than once at a timeï¼Œå¯ä»¥é˜²æ­¢ Data Race

    println!("{}, {}", r1, r2);
    
    let mut s = String::from("hello");

     // ä¸å¯ä»¥åŒæ—¶æŠŠå˜é‡å€Ÿç”¨ç»™ â€œä¸å¯å˜å¼•ç”¨â€å’Œâ€œå¯å˜å¼•ç”¨â€
    let r1 = &amp;s; // æ²¡é—®é¢˜ 
    let r2 = &amp;s; // æ²¡é—®é¢˜
    let r3 = &amp;mut s; // å¤§é—®é¢˜

    println!("{}, {}, and {}", r1, r2, r3);


}

fn change(some_string: &amp;mut String) {
    some_string.push_str(", world");
}
</code></pre>
<p><strong>æ‚¬å‚å¼•ç”¨ï¼ˆDangling Referencesï¼‰</strong></p>
<p>åœ¨å…·æœ‰æŒ‡é’ˆçš„è¯­è¨€ä¸­ï¼Œå¾ˆå®¹æ˜“é€šè¿‡é‡Šæ”¾å†…å­˜æ—¶ä¿ç•™æŒ‡å‘å®ƒçš„æŒ‡é’ˆè€Œé”™è¯¯åœ°ç”Ÿæˆä¸€ä¸ª æ‚¬å‚æŒ‡é’ˆï¼ˆ<code>dangling pointer</code>ï¼‰ï¼Œæ‰€è°“æ‚¬å‚æŒ‡é’ˆæ˜¯å…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½å·²ç»è¢«åˆ†é…ç»™å…¶å®ƒæŒæœ‰è€…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ <code>Rust</code> ä¸­ç¼–è¯‘å™¨ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ æ‹¥æœ‰ä¸€äº›æ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å…¶å¼•ç”¨ä¹‹å‰ç¦»å¼€ä½œç”¨åŸŸã€‚</p>
<pre><code>fn main() {
    let reference_to_nothing = dangle();
}

fn dangle() -&gt; &amp;String {
    let s = String::from("hello");

    &amp;s // æŠ¥é”™ missing lifetime specifier
}
</code></pre>
<h2 id="4-3-åˆ‡ç‰‡-Slice-ç±»å‹"><a href="#4-3-åˆ‡ç‰‡-Slice-ç±»å‹" class="headerlink" title="4.3 åˆ‡ç‰‡ Slice ç±»å‹"></a>4.3 åˆ‡ç‰‡ Slice ç±»å‹</h2><p>å¦ä¸€ä¸ªæ²¡æœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹æ˜¯ <code>slice</code>ã€‚<code>slice</code> å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚</p>
<pre><code>fn main() {
    let mut s = String::from("hello world");
    let word = first_word(&amp;s); // word çš„å€¼ä¸º 5
    s.clear(); // è¿™æ¸…ç©ºäº†å­—ç¬¦ä¸²ï¼Œä½¿å…¶ç­‰äº ""

    // word åœ¨æ­¤å¤„çš„å€¼ä»ç„¶æ˜¯ 5ï¼Œ
    // ä½†æ˜¯æ²¡æœ‰æ›´å¤šçš„å­—ç¬¦ä¸²è®©æˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°åº”ç”¨æ•°å€¼ 5ã€‚word çš„å€¼ç°åœ¨å®Œå…¨æ— æ•ˆï¼
}


fn first_word(s: &amp;String) -&gt; usize {
    let bytes = s.as_bytes();
    for (i, &amp;item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }

    s.len()
}

   let s = String::from("hello world");
    let hello = &amp;s[0..5];
    let world = &amp;s[6..11];
    
    let s = String::from("hello");
    let len = s.len();        
    let slice = &amp;s[0..len];
    let slice = &amp;s[..];
</code></pre>
<p>è¿”å›ç¬¬ä¸€ä¸ªå•è¯çš„ <code>Demo</code></p>
<pre><code>fn main() {
    let mut s = String::from("hello world");
    let word = first_word(&amp;s); // immutable borrow occurs here
    // s.clear(); // error! cannot borrow `s` as mutable because it is also borrowed as immutable

    println!("the first word is: {}", word);
}


fn first_word(s: &amp;str) -&gt; &amp;str {
    let bytes = s.as_bytes();
    for (i, &amp;item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &amp;s[0..i];
        }
    }
    &amp;s[..]
}
</code></pre>
<h1 id="äº”ã€Struct"><a href="#äº”ã€Struct" class="headerlink" title="äº”ã€Struct"></a>äº”ã€Struct</h1><h2 id="5-1-å®šä¹‰å’Œä¸¾ä¾‹è¯´æ˜ç»“æ„ä½“"><a href="#5-1-å®šä¹‰å’Œä¸¾ä¾‹è¯´æ˜ç»“æ„ä½“" class="headerlink" title="5.1 å®šä¹‰å’Œä¸¾ä¾‹è¯´æ˜ç»“æ„ä½“"></a>5.1 å®šä¹‰å’Œä¸¾ä¾‹è¯´æ˜ç»“æ„ä½“</h2><pre><code>#[derive(Debug)]
struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}

fn build_user(email: String, username: String) -&gt; User {
    User {
        email,
        username,
        active: true,
        sign_in_count: 1,
    }
}

fn main() {
    let user1 = build_user(String::from("another@example.com"), String::from("someusername123"));

    let user2 = User {
        email: String::from("another@example.com"),
        ..user1
    };
    
     println!("rect1 is {:?}", user2);

}
</code></pre>
<h2 id="5-2-æ–¹æ³•è¯­æ³•"><a href="#5-2-æ–¹æ³•è¯­æ³•" class="headerlink" title="5.2 æ–¹æ³•è¯­æ³•"></a>5.2 æ–¹æ³•è¯­æ³•</h2><pre><code>#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&amp;self) -&gt; u32 {
        self.width * self.height
    }
}

impl Rectangle {
    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
        self.width &gt; other.width &amp;&amp; self.height &gt; other.height
    }
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };
    let rect2 = Rectangle {
        width: 10,
        height: 40,
    };
    let rect3 = Rectangle {
        width: 60,
        height: 45,
    };

    println!("Can rect1 hold rect2? {}", rect1.can_hold(&amp;rect2));
    println!("Can rect1 hold rect3? {}", rect1.can_hold(&amp;rect3));
}
</code></pre>
<h1 id="å…­ã€æšä¸¾å’Œæ¨¡å¼åŒ¹é…"><a href="#å…­ã€æšä¸¾å’Œæ¨¡å¼åŒ¹é…" class="headerlink" title="å…­ã€æšä¸¾å’Œæ¨¡å¼åŒ¹é…"></a>å…­ã€æšä¸¾å’Œæ¨¡å¼åŒ¹é…</h1><h2 id="6-1-å®šä¹‰æšä¸¾ã€Option"><a href="#6-1-å®šä¹‰æšä¸¾ã€Option" class="headerlink" title="6.1 å®šä¹‰æšä¸¾ã€Option"></a>6.1 å®šä¹‰æšä¸¾ã€Option</h2><pre><code>enum IpAddrKind {
    V4,
    V6,
}

struct IpAddr {
    kind: IpAddrKind,
    address: String,
}

fn main() {
    let home = IpAddr {
        kind: IpAddrKind::V4,
        address: String::from("127.0.0.1"),
    };

    let loopback = IpAddr {
        kind: IpAddrKind::V6,
        address: String::from("::1"),
    };
}
</code></pre>
<p><strong>Option æšä¸¾å’Œå…¶ç›¸å¯¹äºç©ºå€¼çš„ä¼˜åŠ¿</strong></p>
<p>ç¼–ç¨‹è¯­è¨€çš„è®¾è®¡ç»å¸¸è¦è€ƒè™‘åŒ…å«å“ªäº›åŠŸèƒ½ï¼Œä½†è€ƒè™‘æ’é™¤å“ªäº›åŠŸèƒ½ä¹Ÿå¾ˆé‡è¦ã€‚<code>Rust</code> å¹¶æ²¡æœ‰å¾ˆå¤šå…¶ä»–è¯­è¨€ä¸­æœ‰çš„ç©ºå€¼åŠŸèƒ½ã€‚ç©ºå€¼(<code>Null</code>)æ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒä»£è¡¨æ²¡æœ‰å€¼ã€‚åœ¨æœ‰ç©ºå€¼çš„è¯­è¨€ä¸­ï¼Œå˜é‡æ€»æ˜¯è¿™ä¸¤ç§çŠ¶æ€ä¹‹ä¸€ï¼šç©ºå€¼å’Œéç©ºå€¼ã€‚</p>
<p><code>Tony Hoare</code>ï¼Œ<code>null</code> çš„å‘æ˜è€…ï¼Œåœ¨ä»– <code>2009</code> å¹´çš„æ¼”è®² <code>Null References: The Billion Dollar Mistake</code> ä¸­æ›¾ç»è¯´åˆ°ï¼š</p>
<blockquote>
<p>æˆ‘ç§°ä¹‹ä¸ºæˆ‘åäº¿ç¾å…ƒçš„é”™è¯¯ã€‚å½“æ—¶ï¼Œæˆ‘åœ¨ä¸ºä¸€ä¸ªé¢å‘å¯¹è±¡è¯­è¨€è®¾è®¡ç¬¬ä¸€ä¸ªç»¼åˆæ€§çš„é¢å‘å¼•ç”¨çš„ç±»å‹ç³»ç»Ÿã€‚æˆ‘çš„ç›®æ ‡æ˜¯é€šè¿‡ç¼–è¯‘å™¨çš„è‡ªåŠ¨æ£€æŸ¥æ¥ä¿è¯æ‰€æœ‰å¼•ç”¨çš„ä½¿ç”¨éƒ½åº”è¯¥æ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ä¸è¿‡æˆ‘æœªèƒ½æŠµæŠ—ä½å¼•å…¥ä¸€ä¸ªç©ºå¼•ç”¨çš„è¯±æƒ‘ï¼Œä»…ä»…æ˜¯å› ä¸ºå®ƒæ˜¯è¿™ä¹ˆçš„å®¹æ˜“å®ç°ã€‚è¿™å¼•å‘äº†æ— æ•°é”™è¯¯ã€æ¼æ´å’Œç³»ç»Ÿå´©æºƒï¼Œåœ¨ä¹‹åçš„å››åå¤šå¹´ä¸­é€ æˆäº†æ•°åäº¿ç¾å…ƒçš„è‹¦ç—›å’Œä¼¤å®³ã€‚</p>
</blockquote>
<p><strong>ç©ºå€¼çš„é—®é¢˜åœ¨äºå½“ä½ å°è¯•åƒä¸€ä¸ªéç©ºå€¼é‚£æ ·ä½¿ç”¨ä¸€ä¸ªç©ºå€¼</strong>ï¼Œä¼šå‡ºç°æŸç§å½¢å¼çš„é”™è¯¯ã€‚å› ä¸ºç©ºå’Œéç©ºçš„å±æ€§æ— å¤„ä¸åœ¨ï¼Œéå¸¸å®¹æ˜“å‡ºç°è¿™ç±»é”™è¯¯ã€‚</p>
<p>é—®é¢˜ä¸åœ¨äºæ¦‚å¿µè€Œåœ¨äºå…·ä½“çš„å®ç°ã€‚ä¸ºæ­¤ï¼Œ<code>Rust</code> å¹¶æ²¡æœ‰ç©ºå€¼ï¼Œä¸è¿‡å®ƒç¡®å®æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥ç¼–ç å­˜åœ¨æˆ–ä¸å­˜åœ¨æ¦‚å¿µçš„æšä¸¾ã€‚è¿™ä¸ªæšä¸¾æ˜¯ <code>Option&lt;T&gt;</code>ï¼Œè€Œä¸”å®ƒå®šä¹‰äºæ ‡å‡†åº“ä¸­</p>
<pre><code>enum Option&lt;T&gt; {
    Some(T),
    None,
}


let some_number = Some(5);
let some_string = Some("a string");
let absent_number: Option&lt;i32&gt; = None;

let x: i8 = 5;
let y: Option&lt;i8&gt; = Some(5);
// no implementation for `i8 + std::option::Option&lt;i8&gt;`
let sum = x + y; // æŠ¥é”™ï¼Œthe trait bound `i8: std::ops::Add&lt;std::option::Option&lt;i8&gt;&gt;` is not satisfied
    
</code></pre>
<p><strong>Option<t> æ¯” Null å¥½åœ¨å“ªï¼Ÿ</t></strong></p>
<ul>
<li><code>Option&lt;T&gt;</code> å’Œ <code>T</code> æ˜¯ä¸åŒç±»å‹ï¼Œä¸å¯ä»¥æŠŠ <code>Option&lt;T&gt;</code> ç›´æ¥å½“æˆ <code>T</code></li>
<li>è‹¥æƒ³ä½¿ç”¨ <code>Option&lt;T&gt;</code> ä¸­çš„ <code>T</code>ï¼Œå¿…é¡»æŠŠä»–è½¬åŒ–<code>T</code>ã€‚</li>
</ul>
<h2 id="6-2-match-if-æ§åˆ¶æµè¿ç®—ç¬¦"><a href="#6-2-match-if-æ§åˆ¶æµè¿ç®—ç¬¦" class="headerlink" title="6.2 match/if æ§åˆ¶æµè¿ç®—ç¬¦"></a>6.2 match/if æ§åˆ¶æµè¿ç®—ç¬¦</h2><pre><code>fn main() {
    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
        match x {
            None =&gt; None,
            Some(i) =&gt; Some(i + 1),
            // _  =&gt; None, â€œ_â€ è¡¨ç¤ºdefault
        }
    }

    let five = Some(5);
    let six = plus_one(five);
    let none = plus_one(None);
}


let mut count = 0;
if let Coin::Quarter(state) = coin {
    println!("State quarter from {:?}!", state);
} else {
    count += 1;
}
</code></pre>
<h1 id="ä¸ƒã€ä½¿ç”¨åŒ…ã€Crateå’Œæ¨¡å—ç®¡ç†ä¸æ–­å¢é•¿çš„é¡¹ç›®"><a href="#ä¸ƒã€ä½¿ç”¨åŒ…ã€Crateå’Œæ¨¡å—ç®¡ç†ä¸æ–­å¢é•¿çš„é¡¹ç›®" class="headerlink" title="ä¸ƒã€ä½¿ç”¨åŒ…ã€Crateå’Œæ¨¡å—ç®¡ç†ä¸æ–­å¢é•¿çš„é¡¹ç›®"></a>ä¸ƒã€ä½¿ç”¨åŒ…ã€Crateå’Œæ¨¡å—ç®¡ç†ä¸æ–­å¢é•¿çš„é¡¹ç›®</h1><p><code>Rust</code> æœ‰è®¸å¤šåŠŸèƒ½å¯ä»¥è®©ä½ ç®¡ç†ä»£ç çš„ç»„ç»‡ï¼ŒåŒ…æ‹¬å“ªäº›å†…å®¹å¯ä»¥è¢«å…¬å¼€ï¼Œå“ªäº›å†…å®¹ä½œä¸ºç§æœ‰éƒ¨åˆ†ï¼Œä»¥åŠç¨‹åºæ¯ä¸ªä½œç”¨åŸŸä¸­çš„åå­—ã€‚è¿™äº›åŠŸèƒ½ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸º â€œæ¨¡å—ç³»ç»Ÿï¼ˆ<code>the module system</code>ï¼‰â€ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>åŒ…ï¼ˆ<code>Packages</code>ï¼‰ï¼š <code>Cargo</code> çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ æ„å»ºã€æµ‹è¯•å’Œåˆ†äº«<code>crate</code>ã€‚(æœ€é¡¶å±‚)</li>
<li><code>Crates</code> ï¼šä¸€ä¸ªæ¨¡å—çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå½¢æˆäº†åº“æˆ–äºŒè¿›åˆ¶é¡¹ç›®ã€‚</li>
<li>æ¨¡å—ï¼ˆ<code>Modules</code>ï¼‰å’Œ <code>use</code>ï¼š å…è®¸ä½ æ§åˆ¶ä½œç”¨åŸŸå’Œè·¯å¾„çš„ç§æœ‰æ€§ã€‚</li>
<li>è·¯å¾„ï¼ˆ<code>path</code>ï¼‰ï¼šä¸€ä¸ªå‘½åä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–æ¨¡å—ç­‰é¡¹çš„æ–¹å¼</li>
</ul>
<h2 id="7-1-Packages-å’Œ-crate"><a href="#7-1-Packages-å’Œ-crate" class="headerlink" title="7.1 Packages å’Œ crate"></a>7.1 Packages å’Œ crate</h2><p><code>Crate Root</code> ï¼š1. æ˜¯æºç æ–‡ä»¶ã€‚ 2. <code>Rust</code> ç¼–è¯‘å™¨ä»è¿™é‡Œå¼€å§‹ï¼Œç»„æˆä½ çš„ <code>Crate</code> çš„æ ¹ <code>Module</code></p>
<p>ä¸€ä¸ª<code>Package</code>ï¼š</p>
<ul>
<li>åŒ…å«ä¸€ä¸ª<code>Cargo.toml</code>, å®ƒæè¿°äº†å¦‚ä½•æ„å»ºè¿™äº› <code>Crates</code></li>
<li>åªèƒ½åŒ…å«<code>0-1</code>ä¸ª <code>library crate</code></li>
<li>å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ <code>binary crate</code></li>
<li>ä½†æ˜¯å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ª<code>crate</code>ï¼ˆ<code>library</code>æˆ–è€…<code>crate</code>ï¼‰</li>
</ul>
<p><code>cargo.toml Demo</code></p>
<pre><code>[package]
name = "async_io"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
[[bin]]
name = "main"
path = "src/main.rs"

[[bin]]
name = "echo-server"
path = "src/echo_server.rs"

[[bin]]
name = "echo-server-copy"
path = "src/echo_server_copy.rs"

[dependencies]
tokio = { version = "1", features = ["full"] }
mini-redis = "0.4"


cargo run --bin main
</code></pre>
<p><code>Cargo</code>çš„æƒ¯ä¾‹</p>
<p><code>src/main.rs</code>:</p>
<ul>
<li><code>binary crate</code> çš„<code>Crate root</code></li>
<li><code>crate</code> åä¸ <code>package</code> åç›¸åŒ</li>
</ul>
<p><code>src/lib.rs</code>:</p>
<ul>
<li><code>package</code> åŒ…å«ä¸€ä¸ª <code>library crate</code></li>
<li><code>library crate</code> çš„ <code>crate root</code></li>
<li><code>crate</code> åä¸ <code>package</code> åç›¸åŒ</li>
</ul>
<ul>
<li>ä¸€ä¸ª<code>Package</code>å¯ä»¥åŒæ—¶åŒ…å«<code>src/main.rs</code>å’Œ<code>src/lib.rs</code><ul>
<li>ä¸€ä¸ª <code>binary crate</code>ï¼Œä¸€ä¸ª<code>library crate</code></li>
<li>åç§°ä¸<code>package</code>åç›¸åŒ</li>
</ul>
</li>
<li>ä¸€ä¸ª <code>Package</code> å¯ä»¥æœ‰å¤šä¸ª<code>binary crate</code><ul>
<li>æ–‡ä»¶æ”¾åœ¨ <code>src/bin</code> </li>
<li>æ¯ä¸ªæ–‡ä»¶æ˜¯å•ç‹¬çš„<code>binary crate</code></li>
</ul>
</li>
</ul>
<h2 id="7-2-å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§"><a href="#7-2-å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§" class="headerlink" title="7.2 å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§"></a>7.2 å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§</h2><p>å®šä¹‰<code>Module</code>æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§</p>
<ul>
<li><code>Module</code><ul>
<li>åœ¨ä¸€ä¸ª<code>crate</code>å†…ï¼Œå°†ä»£ç è¿›è¡Œåˆ†ç»„ </li>
<li>å¢åŠ å¯è¯»æ€§ï¼Œæ˜“äºå¤ç”¨</li>
<li>æ§åˆ¶é¡¹ç›®ï¼ˆ<code>item</code>ï¼‰çš„ç§æœ‰æ€§ã€‚<code>public</code>ã€<code>private</code></li>
</ul>
</li>
<li>å»ºç«‹ <code>Module</code>ï¼š<ul>
<li><code>mod</code> å…³é”®å­—</li>
<li>å¯åµŒå¥—</li>
<li>å¯ä»¥åŒ…å«å…¶ä»–é¡¹ï¼ˆ<code>struct</code>ã€<code>enum</code>ã€å¸¸é‡ã€<code>trait</code>ã€å‡½æ•°ç­‰ï¼‰</li>
</ul>
</li>
</ul>
<p>demo</p>
<pre><code>mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
        fn seat_at_table() {}
    }

    mod serving {
        fn take_order() {}
        fn server_order() {}
        fn take_payment() {}
    }
}
</code></pre>
<h2 id="7-3-è·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹"><a href="#7-3-è·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹" class="headerlink" title="7.3 è·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹"></a>7.3 è·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹</h2><p>è·¯å¾„æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>ç»å¯¹è·¯å¾„ï¼ˆ<code>absolute path</code>ï¼‰ä» <code>crate</code> æ ¹éƒ¨å¼€å§‹ï¼Œä»¥ <code>crate</code> åæˆ–è€…å­—é¢é‡ <code>crate</code> å¼€å¤´ã€‚</li>
<li>ç›¸å¯¹è·¯å¾„ï¼ˆ<code>relative path</code>ï¼‰ä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä»¥ <code>self</code>ã€<code>super</code> æˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦å¼€å¤´ã€‚</li>
</ul>
<p>æ–‡ä»¶å: <code>src/lib.rs</code></p>
<pre><code>mod front_of_house {
    pub mod hosting { // è¿™é‡Œå¿…é¡»å®šä¹‰ä¸º pubï¼Œä¸ç„¶ä¸‹é¢è°ƒç”¨çš„æ—¶å€™ä¼šæŠ¥é”™
        fn add_to_waitlist() {}
    }
}

pub fn eat_at_restaurant() {
    // Absolute path
    crate::front_of_house::hosting::add_to_waitlist();

    // Relative path
    front_of_house::hosting::add_to_waitlist();
}
</code></pre>
<p><strong>ä½¿ç”¨ super èµ·å§‹çš„ç›¸å¯¹è·¯å¾„</strong></p>
<pre><code>fn serve_order() {}

mod back_of_house {
    fn fix_incorrect_order() {
        cook_order();
        super::serve_order();
    }

    fn cook_order() {}
}

    
</code></pre>
<h2 id="7-4-ä½¿ç”¨-use-å…³é”®å­—å°†åç§°å¼•å…¥ä½œç”¨åŸŸ"><a href="#7-4-ä½¿ç”¨-use-å…³é”®å­—å°†åç§°å¼•å…¥ä½œç”¨åŸŸ" class="headerlink" title="7.4 ä½¿ç”¨ use å…³é”®å­—å°†åç§°å¼•å…¥ä½œç”¨åŸŸ"></a>7.4 ä½¿ç”¨ use å…³é”®å­—å°†åç§°å¼•å…¥ä½œç”¨åŸŸ</h2><p>Demo</p>
<pre><code>// src/main.rs
    
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}

use front_of_house::hosting;
// use crate::front_of_house::hosting;


pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
    hosting::add_to_waitlist();
    hosting::add_to_waitlist();
}


use crate::front_of_house::hosting;
use crate::front_of_house::hosting::add_to_waitlist;
use std::collections::HashMap;
use std::io::Result as IoResult;
pub use crate::front_of_house::hosting; // ä½¿ç”¨ pub use é‡å¯¼å‡ºåç§°
use std::{cmp::Ordering, io};
use std::io;
use std::io::Write;
use std::io::{self, Write}; // è¿™ä¸€è¡Œä¾¿å°† std::io å’Œ std::io::Write åŒæ—¶å¼•å…¥ä½œç”¨åŸŸã€‚
use std::collections::*; // è¿™ä¸ª use è¯­å¥å°† std::collections ä¸­å®šä¹‰çš„æ‰€æœ‰å…¬æœ‰é¡¹å¼•å…¥å½“å‰ä½œç”¨åŸŸã€‚ä½¿ç”¨ glob è¿ç®—ç¬¦æ—¶è¯·å¤šåŠ å°å¿ƒï¼Glob ä¼šä½¿å¾—æˆ‘ä»¬éš¾ä»¥æ¨å¯¼ä½œç”¨åŸŸä¸­æœ‰ä»€ä¹ˆåç§°å’Œå®ƒä»¬æ˜¯åœ¨ä½•å¤„å®šä¹‰çš„ã€‚
</code></pre>
<h2 id="7-5-å°†æ¨¡å—åˆ†å‰²è¿›ä¸åŒæ–‡ä»¶"><a href="#7-5-å°†æ¨¡å—åˆ†å‰²è¿›ä¸åŒæ–‡ä»¶" class="headerlink" title="7.5 å°†æ¨¡å—åˆ†å‰²è¿›ä¸åŒæ–‡ä»¶"></a>7.5 å°†æ¨¡å—åˆ†å‰²è¿›ä¸åŒæ–‡ä»¶</h2><p>æ–‡ä»¶å: src/main.rs</p>
<pre><code>fn main() {
    println!("Hello, world!");
    eat_at_restaurant();
}


mod front_of_house; // å¯¹åº” src/front_of_house.rs

pub use crate::front_of_house::hosting;

pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
}
</code></pre>
<p>æ–‡ä»¶å: src/front_of_house.rs</p>
<pre><code>// pub mod hosting {
//     pub fn add_to_waitlist() {}
// }


pub mod hosting; // å¯¹åº” src/front_of_house/hosting.rs
// mod hosting;
</code></pre>
<p>æ–‡ä»¶å: src/front_of_house/hosting.rs</p>
<pre><code>pub fn add_to_waitlist() {
    println!("add_to_waitlist")
}
</code></pre>
<p><strong>æ‹†åˆ†æ–¹å¼ä¸€ï¼šæ‹†åˆ†æˆæ–‡ä»¶</strong></p>
<pre><code>- Cargo.toml
- src/
    - add.rs
    - main.rs

// src/add.rs
pub mod add_one {
    pub fn add_one (base: u32) -&gt; u32 {
        base + 1
    }
}

// src/main.rs
mod add;

fn main() {
    print!("{}", add::add_one::add_one(0));
}
</code></pre>
<p><strong>æ‹†åˆ†æ–¹å¼äºŒï¼šæ‹†åˆ†æˆæ–‡ä»¶å¤¹</strong></p>
<pre><code>- Cargo.toml
- src
    - add/
        - add_one.rs
        - mod.rs
    - main.rs


// src/add/add_one.rs
pub fn add_one (base: u32) -&gt; u32 {
  base + 1
}

// src/add/mod.rs
pub mod add_one;

// src/main.rs
mod add;

fn main() {
    print!("{}", add::add_one::add_one(0));
}
</code></pre>
<p><strong>æ‹†åˆ†æ–¹å¼ä¸‰ï¼šæ‹†åˆ†æˆæ–‡ä»¶åŠ æ–‡ä»¶å¤¹</strong></p>
<pre><code>- Cargo.toml
- src
    - add/
        - add_one.rs
    - add.rs
    - main.rs


// src/add/add_one.rs
pub fn add_one (base: u32) -&gt; u32 {
  base + 1
}

// src/add.rs
pub mod add_one;


// src/main.rs
mod add;

fn main() {
    print!("{}", add::add_one::add_one(0));
}
</code></pre>
<h1 id="å…«-å¸¸è§é›†åˆ"><a href="#å…«-å¸¸è§é›†åˆ" class="headerlink" title="å…« å¸¸è§é›†åˆ"></a>å…« å¸¸è§é›†åˆ</h1><p><code>Rust</code> æ ‡å‡†åº“ä¸­åŒ…å«ä¸€ç³»åˆ—è¢«ç§°ä¸º é›†åˆï¼ˆ<code>collections</code>ï¼‰çš„éå¸¸æœ‰ç”¨çš„æ•°æ®ç»“æ„ã€‚å¤§éƒ¨åˆ†å…¶ä»–æ•°æ®ç±»å‹éƒ½ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œä¸è¿‡é›†åˆå¯ä»¥åŒ…å«å¤šä¸ªå€¼ã€‚ä¸åŒäºå†…å»ºçš„æ•°ç»„å’Œå…ƒç»„ç±»å‹ï¼Œè¿™äº›é›†åˆæŒ‡å‘çš„æ•°æ®æ˜¯å‚¨å­˜åœ¨å †ä¸Šçš„ï¼Œè¿™æ„å‘³ç€æ•°æ®çš„æ•°é‡ä¸å¿…åœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥ï¼Œå¹¶ä¸”è¿˜å¯ä»¥éšç€ç¨‹åºçš„è¿è¡Œå¢é•¿æˆ–ç¼©å°ã€‚æ¯ç§é›†åˆéƒ½æœ‰ç€ä¸åŒåŠŸèƒ½å’Œæˆæœ¬ï¼Œè€Œæ ¹æ®å½“å‰æƒ…å†µé€‰æ‹©åˆé€‚çš„é›†åˆï¼Œè¿™æ˜¯ä¸€é¡¹åº”å½“é€æ¸æŒæ¡çš„æŠ€èƒ½ã€‚åœ¨è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬å°†è¯¦ç»†çš„äº†è§£ä¸‰ä¸ªåœ¨ Rust ç¨‹åºä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„é›†åˆï¼š</p>
<ul>
<li><code>vector</code> å…è®¸æˆ‘ä»¬ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªåœ°å‚¨å­˜ä¸€ç³»åˆ—æ•°é‡å¯å˜çš„å€¼</li>
<li>å­—ç¬¦ä¸²ï¼ˆ<code>string</code>ï¼‰æ˜¯å­—ç¬¦çš„é›†åˆã€‚æˆ‘ä»¬ä¹‹å‰è§è¿‡ <code>String</code> ç±»å‹ï¼Œä¸è¿‡åœ¨æœ¬ç« æˆ‘ä»¬å°†æ·±å…¥äº†è§£ã€‚</li>
<li>å“ˆå¸Œ <code>map</code>ï¼ˆ<code>hash map</code>ï¼‰å…è®¸æˆ‘ä»¬å°†å€¼ä¸ä¸€ä¸ªç‰¹å®šçš„é”®ï¼ˆ<code>key</code>ï¼‰ç›¸å…³è”ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš <code>map</code> çš„æ›´é€šç”¨çš„æ•°æ®ç»“æ„çš„ç‰¹å®šå®ç°ã€‚</li>
</ul>
<h2 id="8-1-vector"><a href="#8-1-vector" class="headerlink" title="8.1 vector"></a>8.1 vector</h2><p><code>vector</code> åŸºæœ¬æ“ä½œï¼š</p>
<pre><code>let v: Vec&lt;i32&gt; = Vec::new();
let v = vec![1, 2, 3];

let mut v = Vec::new();
v.push(5);
v.push(6);
v.push(7);
v.push(8);


let third: &amp;i32 = &amp;v[2];
println!("The third element is {}", third);

match v.get(2) {
    Some(third) =&gt; println!("The third element is {}", third),
    None =&gt; println!("There is no third element."),
}


let v = vec![1, 2, 3, 4, 5]; 

let does_not_exist = &amp;v[100];
let does_not_exist = v.get(100);

let v = vec![100, 32, 57];
for i in &amp;v {
    println!("{}", i);
}

// æˆ‘ä»¬ä¹Ÿå¯ä»¥éå†å¯å˜ vector çš„æ¯ä¸€ä¸ªå…ƒç´ çš„å¯å˜å¼•ç”¨ä»¥ä¾¿èƒ½æ”¹å˜ä»–ä»¬ã€‚ç¤ºä¾‹ 8-9 ä¸­çš„ for å¾ªç¯ä¼šç»™æ¯ä¸€ä¸ªå…ƒç´ åŠ  50ï¼š
let mut v = vec![100, 32, 57];
for i in &amp;mut v {
    *i += 50;
}

enum SpreadsheetCell {
    Int(i32),
    Float(f64),
    Text(String),
}

let row = vec![
    SpreadsheetCell::Int(3),
    SpreadsheetCell::Text(String::from("blue")),
    SpreadsheetCell::Float(10.12),
];
</code></pre>
<p><strong>åœ¨æ‹¥æœ‰ vector ä¸­é¡¹çš„å¼•ç”¨çš„åŒæ—¶å‘å…¶å¢åŠ ä¸€ä¸ªå…ƒç´ </strong></p>
<pre><code>// é˜²æ­¢åº•å±‚çš„ slice æ‰©å®¹ä»¥å ï¼Œfirst æŒ‡å‘çš„è€çš„å†…å­˜ä½ç½®å¯èƒ½ä¼šè¢«é‡Šæ”¾æˆ–è€…é‡æ–°åˆ†é…ã€‚
let mut v = vec![1, 2, 3, 4, 5];
let first = &amp;v[0]; // immutable borrow occurs here
v.push(6); // cannot borrow `v` as mutable because it is also borrowed as immutable
println!("The first element is: {}", first);
</code></pre>
<p>ä¸èƒ½è¿™ä¹ˆåšçš„åŸå› æ˜¯ç”±äº <code>vector</code> çš„å·¥ä½œæ–¹å¼ï¼šåœ¨ <code>vector</code> çš„ç»“å°¾å¢åŠ æ–°å…ƒç´ æ—¶ï¼Œåœ¨æ²¡æœ‰è¶³å¤Ÿç©ºé—´å°†æ‰€æœ‰æ‰€æœ‰å…ƒç´ ä¾æ¬¡ç›¸é‚»å­˜æ”¾çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šè¦æ±‚åˆ†é…æ–°å†…å­˜å¹¶å°†è€çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„ç©ºé—´ä¸­ã€‚è¿™æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨å°±æŒ‡å‘äº†è¢«é‡Šæ”¾çš„å†…å­˜ã€‚å€Ÿç”¨è§„åˆ™é˜»æ­¢ç¨‹åºé™·å…¥è¿™ç§çŠ¶å†µã€‚</p>
<h2 id="8-2-å­—ç¬¦ä¸²"><a href="#8-2-å­—ç¬¦ä¸²" class="headerlink" title="8.2 å­—ç¬¦ä¸²"></a>8.2 å­—ç¬¦ä¸²</h2><ul>
<li><code>Rust</code> çš„æ ¸å¿ƒè¯­è¨€å±‚é¢ï¼Œåªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼šå­—ç¬¦ä¸²åˆ‡ç‰‡ <code>str</code> æˆ–è€… <code>&amp;str</code></li>
<li>å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼šå¯¹å­˜å‚¨åœ¨å…¶ä»–åœ°æ–¹ã€<code>UTF-8</code>ç¼–ç çš„å­—ç¬¦ä¸²çš„å¼•ç”¨<ul>
<li>å­—ç¬¦ä¸²å­—é¢å€¼ï¼šå­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡</li>
</ul>
</li>
</ul>
<p><code>String</code>ç±»å‹ï¼š</p>
<ul>
<li>æ¥è‡ª<code>æ ‡å‡†åº“</code>è€Œä¸æ˜¯<code>æ ¸å¿ƒè¯­è¨€</code></li>
<li>å¯å¢é•¿ã€å¯ä¿®æ”¹ã€å¯æ‹¥æœ‰</li>
<li><code>UTF-8</code>ç¼–ç </li>
<li>ä¸æ”¯æŒç´¢å¼•è¯­æ³•è®¿é—®ã€‚// <code>str[0]</code><ul>
<li>ç´¢å¼•æ“ä½œåº”è¯¥æ¶ˆè€—ä¸€ä¸ªå¸¸é‡çš„æ—¶é—´<code>ï¼ˆO(1)ï¼‰</code></li>
<li>è€Œ <code>String</code> æ— æ³•ä¿è¯ï¼šéœ€è¦éå†æ‰€æœ‰å†…å®¹ï¼Œæ¥ç¡®å®šæœ‰å¤šå°‘ä¸ªåˆæ³•çš„å­—ç¬¦ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å­—ç¬¦ä¸²å­—é¢é‡ Go vs Rust</strong></p>
<pre><code>let data = "initial contents";
let s = data.to_string();
// è¯¥æ–¹æ³•ä¹Ÿå¯ç›´æ¥ç”¨äºå­—ç¬¦ä¸²å­—é¢é‡ï¼š
let s = "initial contents".to_string();

func main() {
    a := "hello world."
    //a := string([]byte("1234567890"))

    println("a = ", a, " &amp;a = ", &amp;a)
    bs := StringToBytes(a)

    println(string(bs))

    bs[0] = 'c' // panic
    println(string(bs))
}

func StringToBytes(s string) []byte {
    return *(*[]byte)(unsafe.Pointer(
        &amp;struct {
            string
            Cap int
        }{s, len(s)},
    ))
}
</code></pre>
<p><strong>ç´¢å¼•å­—ç¬¦ä¸² GO vs Rust</strong></p>
<p>è¿™å¼•èµ·äº†å…³äº <code>UTF-8</code> çš„å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šä» <code>Rust</code> çš„è§’åº¦æ¥è®²ï¼Œäº‹å®ä¸Šæœ‰ä¸‰ç§ç›¸å…³æ–¹å¼å¯ä»¥ç†è§£å­—ç¬¦ä¸²ï¼šå­—èŠ‚ã€å’Œå­—å½¢ç°‡ï¼ˆæœ€æ¥è¿‘äººä»¬çœ¼ä¸­ å­—æ¯ çš„æ¦‚å¿µï¼‰ã€‚</p>
<p>å­—ç¬¦ä¸²ï¼š <code>"à¤¨à¤®à¤¸à¥à¤¤à¥‡"</code></p>
<ul>
<li>å­—èŠ‚ <code>str.bytes()</code> // <code>[224, 164, 168, 224, 164, 174, 224, 164, 184, 224, 165, 141, 224, 164, 164, 224, 165, 135]</code></li>
<li>æ ‡é‡å€¼ <code>str.chars()</code> //<code>['à¤¨', 'à¤®', 'à¤¸', 'à¥', 'à¤¤', 'à¥‡']</code></li>
<li>å­—å½¢ç°‡ // <code>["à¤¨", "à¤®", "à¤¸à¥", "à¤¤à¥‡"]</code></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/12321605-9b090629b2e86dfb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="origin_img_v2_f862efd1-d827-4812-a3f8-9b3e4cd40chu.jpg"></p>
<p><code>ä½ å¥½</code>ä¸¤ä¸ªæ±‰å­—å¯¹åº”çš„<code>Unicode</code>ç¼–ç å¦‚ä¸‹ï¼Œä¸€å…±å ç”¨<code>6</code>ä¸ªå­—èŠ‚ã€‚</p>
<pre><code>11100100 10111101 10100000 // ä½ 
11100101 10100101 10111101 // å¥½
</code></pre>
<p>å…ˆçœ‹ä¸‹<code>Golang</code>çš„å­—ç¬¦ä¸²</p>
<pre><code>str := "ä½ å¥½"
for idx, v := range str {
    //idx = 0 , value = ä½ 
    //idx = 3 , value = å¥½
    fmt.Printf("idx = %d , value = %c\n", idx, v)
}

runeData := []rune(str) // rune int32
for i, rData := range runeData {
    //idx = 0 , rData = 20320, utf8.RuneLen(rData) = 3, binary code = 100111101100000 , str = ä½ 
    //idx = 1 , rData = 22909, utf8.RuneLen(rData) = 3, binary code = 101100101111101 , str = å¥½
    fmt.Printf("idx = %d , rData = %d, utf8.RuneLen(rData) = %d, binary code = %b , str = %s \n",
        i, rData, utf8.RuneLen(rData), rData, string(rData))
}

char1 := str[:3]
char2 := str[:2]
fmt.Printf("char1 = %s, chat2 = %s \n", char1, char2) //char1 = ä½ , chat2 = ï¿½
</code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/golang/go/blob/release-branch.go1.18/src/cmd/compile/internal/walk/range.go#L220">åœ¨ç¼–è¯‘å™¨æºç é‡Œé¢for-range å¤„ç†æ–¹å¼</a>ã€<a target="_blank" rel="noopener" href="https://github.com/golang/go/blob/release-branch.go1.18/src/runtime/utf8.go#L60">decoderune</a> </p>
<pre><code>let mut hello = String::from("ä½ ");
hello.push_str("å¥½");
println!("len = {}", hello.len()); // len = 6
for c in hello.chars() {
    // ä½ 
    // å¥½
    println!("{}", c);
}

for c in hello.bytes(){
    // 228
    // 189
    // 160
    // 229
    // 165
    // 189
    println!("{}", c);
}


// éœ€è¦æŒ‰å­—ç¬¦è¾¹ç•Œåˆ‡å‰²ï¼Œä¸ç„¶å°±ä¼šææ…Œ 
let h1 = &amp;hello[0..2]; // 'byte index 2 is not a char boundary; it is inside 'ä½ ' (bytes 0..3) of `ä½ å¥½`'
let h2 = &amp;hello[..3]; 
println!("h2 = {}", h2) // h2 = ä½ 
</code></pre>
<p><strong>å…¶ä»–ç”¨æ³•</strong></p>
<pre><code>let s1 = String::from("Hello, ");
let s2 = String::from("world!");
let s3 = s1 + &amp;s2; // æ³¨æ„ s1 è¢«ç§»åŠ¨äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨

let s1 = String::from("tic");
let s2 = String::from("tac");
let s3 = String::from("toe");

let s = s1 + "-" + &amp;s2 + "-" + &amp;s3;

let s1 = String::from("tic");
let s2 = String::from("tac");
let s3 = String::from("toe");

let s = format!("{}-{}-{}", s1, s2, s3);
</code></pre>
<h2 id="8-3-å“ˆå¸Œ-map-å‚¨å­˜é”®å€¼å¯¹"><a href="#8-3-å“ˆå¸Œ-map-å‚¨å­˜é”®å€¼å¯¹" class="headerlink" title="8.3 å“ˆå¸Œ map å‚¨å­˜é”®å€¼å¯¹"></a>8.3 å“ˆå¸Œ map å‚¨å­˜é”®å€¼å¯¹</h2><ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>HashMap</code>ä½¿ç”¨åŠ å¯†åŠŸèƒ½å¼ºå¤§çš„<code>Hash</code>å‡½æ•°ï¼Œå¯ä»¥æŠµæŠ—æ‹’ç»æœåŠ¡ï¼ˆ<code>DoS</code>ï¼‰ã€‚<ul>
<li>ä¸æ˜¯å¯ç”¨çš„æœ€å¿«çš„<code>Hash</code>ç®—æ³•</li>
<li>ä½†å…·æœ‰æ›´å¥½å®‰å…¨æ€§ </li>
</ul>
</li>
<li>å¯ä»¥æŒ‡å®šä¸åŒçš„<code>hasher</code>æ¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå‡½æ•°<ul>
<li><code>hasher</code> æ˜¯å®ç°<code>BuildHasher trail</code>çš„ç±»å‹</li>
</ul>
</li>
</ul>
<p>Demo</p>
<pre><code>//ç¤ºä¾‹ 8-20ï¼šæ–°å»ºä¸€ä¸ªå“ˆå¸Œ map å¹¶æ’å…¥ä¸€äº›é”®å€¼å¯¹
use std::collections::HashMap;
let mut scores = HashMap::new();
scores.insert(String::from("Blue"), 10);
scores.insert(String::from("Yellow"), 50);
    
// ç¤ºä¾‹ 8-21ï¼šç”¨é˜Ÿä¼åˆ—è¡¨å’Œåˆ†æ•°åˆ—è¡¨åˆ›å»ºå“ˆå¸Œ map
use std::collections::HashMap;
let teams  = vec![String::from("Blue"), String::from("Yellow")];
let initial_scores = vec![10, 50];
// ä¸¤ä¸ªæ•°ç»„zipæˆä¸€ä¸ªmap
let scores: HashMap&lt;_, _&gt; = teams.iter().zip(initial_scores.iter()).collect();

// ç¤ºä¾‹ 8-22ï¼šå±•ç¤ºä¸€æ—¦é”®å€¼å¯¹è¢«æ’å…¥åå°±ä¸ºå“ˆå¸Œ map æ‰€æ‹¥æœ‰
use std::collections::HashMap;
let field_name = String::from("Favorite color");
let field_value = String::from("Blue");
let mut map = HashMap::new();
map.insert(field_name, field_value);
// è¿™é‡Œ field_name å’Œ field_value ä¸å†æœ‰æ•ˆï¼Œ

// ç¤ºä¾‹ 8-23ï¼šè®¿é—®å“ˆå¸Œ map ä¸­å‚¨å­˜çš„è“é˜Ÿåˆ†æ•°
use std::collections::HashMap;
let mut scores = HashMap::new();
scores.insert(String::from("Blue"), 10);
scores.insert(String::from("Yellow"), 50);
let team_name = String::from("Blue");
let score = scores.get(&amp;team_name);

for (key, value) in &amp;scores {
    println!("{}: {}", key, value);
}

scores.insert(String::from("Blue"), 10);
scores.insert(String::from("Blue"), 25);

// æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼, å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°æŸä¸ªå•è¯ï¼Œå°±æ’å…¥å€¼ 0ã€‚
use std::collections::HashMap;
let text = "hello world wonderful world";
let mut map = HashMap::new();
for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count += 1;
}
</code></pre>
<h1 id="ä¹ã€é”™è¯¯å¤„ç†"><a href="#ä¹ã€é”™è¯¯å¤„ç†" class="headerlink" title="ä¹ã€é”™è¯¯å¤„ç†"></a>ä¹ã€é”™è¯¯å¤„ç†</h1><h2 id="9-1-panic-ä¸ä¸å¯æ¢å¤çš„é”™è¯¯"><a href="#9-1-panic-ä¸ä¸å¯æ¢å¤çš„é”™è¯¯" class="headerlink" title="9.1 panic! ä¸ä¸å¯æ¢å¤çš„é”™è¯¯"></a>9.1 panic! ä¸ä¸å¯æ¢å¤çš„é”™è¯¯</h2><ul>
<li><code>Rust</code>çš„å¯é æ€§ï¼šé”™è¯¯å¤„ç†<ul>
<li>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼šåœ¨ç¼–è¯‘æ—¶æç¤ºé”™è¯¯ï¼Œå¹¶å¤„ç†</li>
</ul>
</li>
<li>é”™è¯¯çš„åˆ†ç±»ï¼š<ul>
<li>å¯ä»¥æ¢å¤ï¼Œä¾‹å¦‚æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œå¯ä»¥å†è¯•å°è¯•ã€‚</li>
<li>ä¸å¯æ¢å¤çš„ï¼Œ<code>bug</code>ï¼Œä¾‹å¦‚è®¿é—®ç´¢å¼•è¶…å‡ºè¿”å›ã€‚</li>
</ul>
</li>
<li><code>Rust</code> æ²¡æœ‰ç±»ä¼¼å¼‚å¸¸çš„æœºåˆ¶<ul>
<li>å¯ä»¥æ¢å¤çš„é”™è¯¯ï¼š<code>Result&lt;T,E&gt;</code></li>
<li>ä¸å¯æ¢å¤ï¼š<code>panic!</code> å®</li>
</ul>
</li>
</ul>
<blockquote>
<p>å½“å‡ºç° panic æ—¶ï¼Œç¨‹åºé»˜è®¤ä¼šå¼€å§‹ å±•å¼€ï¼ˆunwindingï¼‰ï¼Œè¿™æ„å‘³ç€ Rust ä¼šå›æº¯æ ˆå¹¶æ¸…ç†å®ƒé‡åˆ°çš„æ¯ä¸€ä¸ªå‡½æ•°çš„æ•°æ®ï¼Œä¸è¿‡è¿™ä¸ªå›æº¯å¹¶æ¸…ç†çš„è¿‡ç¨‹æœ‰å¾ˆå¤šå·¥ä½œã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ç›´æ¥ ç»ˆæ­¢ï¼ˆabortï¼‰ï¼Œè¿™ä¼šä¸æ¸…ç†æ•°æ®å°±é€€å‡ºç¨‹åºã€‚é‚£ä¹ˆç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜éœ€è¦ç”±æ“ä½œç³»ç»Ÿæ¥æ¸…ç†ã€‚å¦‚æœä½ éœ€è¦é¡¹ç›®çš„æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶è¶Šå°è¶Šå¥½ï¼Œpanic æ—¶é€šè¿‡åœ¨ Cargo.toml çš„ [profile] éƒ¨åˆ†å¢åŠ  panic = â€˜abortâ€™ï¼Œå¯ä»¥ç”±å±•å¼€åˆ‡æ¢ä¸ºç»ˆæ­¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦åœ¨releaseæ¨¡å¼ä¸­ panic æ—¶ç›´æ¥ç»ˆæ­¢ï¼š</p>
</blockquote>
<pre><code>[profile.release]
panic = 'abort'
</code></pre>
<p>è®¾ç½®ç¯å¢ƒå˜é‡<code>RUST_BACKTRACE=full</code> å¯ä»¥æ‰“å°å›æº¯ä¿¡æ¯</p>
<h2 id="9-2-Result-ä¸å¯æ¢å¤çš„é”™è¯¯"><a href="#9-2-Result-ä¸å¯æ¢å¤çš„é”™è¯¯" class="headerlink" title="9.2 Result ä¸å¯æ¢å¤çš„é”™è¯¯"></a>9.2 Result ä¸å¯æ¢å¤çš„é”™è¯¯</h2><pre><code>enum Result&lt;T, E&gt; {
    Ok(T),
    Err(E),
}

use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let f = File::open("hello.txt");

    let f = match f {
        Ok(file) =&gt; file,
        Err(error) =&gt; match error.kind() {
            ErrorKind::NotFound =&gt; match File::create("hello.txt") {
                Ok(fc) =&gt; fc,
                Err(e) =&gt; panic!("Problem creating the file: {:?}", e),
            },
            other_error =&gt; panic!("Problem opening the file: {:?}", other_error),
        },
    };
}


fn main() {
    let f = File::open("hello.txt").unwrap_or_else(|error| {
        if error.kind() == ErrorKind::NotFound {
            File::create("hello.txt").unwrap_or_else(|error| {
                panic!("Problem creating the file: {:?}", error);
            })
        } else {
            panic!("Problem opening the file: {:?}", error);
        }
    });
}
</code></pre>
<p><strong>å¤±è´¥æ—¶ panic çš„ç®€å†™ï¼šunwrap å’Œ expect</strong></p>
<pre><code>let f = File::open("hello.txt").unwrap(); // å¤±è´¥çš„æ—¶å€™ï¼Œpanic
let f = File::open("hello.txt").expect("Failed to open hello.txt");// å¤±è´¥çš„æ—¶å€™ï¼Œpanic("Failed to open hello.txt")
</code></pre>
<p><strong>ä¼ æ’­é”™è¯¯(è¿”å›é”™è¯¯)</strong></p>
<pre><code>use std::io;
use std::io::Read;
use std::fs::File;

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let f = File::open("hello.txt");

    let mut f = match f {
        Ok(file) =&gt; file,
        Err(e) =&gt; return Err(e),
    };

    let mut s = String::new();

    match f.read_to_string(&amp;mut s) {
        Ok(_) =&gt; Ok(s),
        Err(e) =&gt; Err(e),
    } // è¿™é‡Œé¢æ²¡æœ‰â€œï¼›â€ è¡¨ç¤ºå½“æ—¶æ˜¯ä¼šè¿”å›å€¼ã€‚
}
</code></pre>
<p><strong>ä¼ æ’­é”™è¯¯çš„ç®€å†™ï¼š? è¿ç®—ç¬¦</strong></p>
<pre><code>use std::io;
use std::io::Read;
use std::fs::File;

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let mut f = File::open("hello.txt")?; // â€œ?â€è¡¨ç¤ºï¼Œå¦‚æœå‡ºé”™ï¼Œå°±ç›´æ¥è¿”å›Errï¼Œ
    let mut s = String::new();
    f.read_to_string(&amp;mut s)?;
    Ok(s)
}

// ç®€å†™ä¸€
let mut s = String::new();
File::open("hello.txt")?.read_to_string(&amp;mut s)?;
Ok(s)

// ç®€å†™äºŒ
use std::io;
use std::fs;    
fs::read_to_string("hello.txt")
</code></pre>
<p><strong>? è¿ç®—ç¬¦å¯è¢«ç”¨äºè¿”å› Result çš„å‡½æ•°</strong></p>
<pre><code>use std::error::Error;
use std::fs::File;

fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let f = File::open("hello.txt")?;

    Ok(())
}
</code></pre>
<h2 id="9-3-ä½¿ç”¨-panic-è¿˜æ˜¯ä¸ç”¨-panic"><a href="#9-3-ä½¿ç”¨-panic-è¿˜æ˜¯ä¸ç”¨-panic" class="headerlink" title="9.3 ä½¿ç”¨ panic! è¿˜æ˜¯ä¸ç”¨ panic!"></a>9.3 ä½¿ç”¨ panic! è¿˜æ˜¯ä¸ç”¨ panic!</h2><ul>
<li><p>ç¤ºä¾‹ã€ä»£ç åŸå‹å’Œæµ‹è¯•éƒ½éå¸¸é€‚åˆ panic</p>
</li>
<li><p>å½“æˆ‘ä»¬æ¯”ç¼–è¯‘å™¨çŸ¥é“æ›´å¤šçš„æƒ…å†µ</p>
<pre><code>  let home: IpAddr = "127.0.0.1".parse().unwrap();
</code></pre>
</li>
<li><p>é”™è¯¯å¤„ç†æŒ‡å¯¼åŸåˆ™</p>
<ul>
<li>æœ‰å®³çŠ¶æ€æ˜¯æŒ‡ä¸€äº›æ„å¤–çš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯é¢„æœŸå¯èƒ½å¶å°”å‘ç”Ÿçš„äº‹æƒ…ï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥é”™è¯¯æ ¼å¼çš„æ•°æ®ã€‚</li>
<li>åœ¨æ­¤ä¹‹åçš„ä»£ç éœ€è¦æ‘†è„±è¿™ç§æœ‰å®³çŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸€æ­¥éƒ½æ£€æŸ¥è¿™ä¸ªé—®é¢˜ã€‚</li>
<li>åœ¨ä½¿ç”¨çš„ç±»å‹ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªå¥½çš„æ–¹å¼æ¥ç¼–ç è¿™äº›ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<h1 id="åã€æ³›å‹ã€trait-å’Œç”Ÿå‘½å‘¨æœŸ"><a href="#åã€æ³›å‹ã€trait-å’Œç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="åã€æ³›å‹ã€trait å’Œç”Ÿå‘½å‘¨æœŸ"></a>åã€æ³›å‹ã€trait å’Œç”Ÿå‘½å‘¨æœŸ</h1><h2 id="10-1-æ³›å‹æ•°æ®ç±»å‹"><a href="#10-1-æ³›å‹æ•°æ®ç±»å‹" class="headerlink" title="10.1 æ³›å‹æ•°æ®ç±»å‹"></a>10.1 æ³›å‹æ•°æ®ç±»å‹</h2><p><strong>å‡½æ•°å®šä¹‰ä¸­çš„æ³›å‹</strong></p>
<pre><code>fn largest&lt;T&gt;(list: &amp;[T]) -&gt; T {
    let mut largest = list[0];

    for &amp;item in list.iter() {
        if item &gt; largest { // binary operation `&gt;` cannot be applied to type `T`
            largest = item; 
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&amp;number_list);
    println!("The largest number is {}", result);

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&amp;char_list);
    println!("The largest char is {}", result);
}
</code></pre>
<p><strong>ç»“æ„ä½“å®šä¹‰ä¸­çš„æ³›å‹</strong></p>
<pre><code>struct Point&lt;T&gt; {
    x: T,
    y: T,
}

fn main() {
    let integer = Point { x: 5, y: 10 };
    let float = Point { x: 1.0, y: 4.0 };
    let wont_work = Point { x: 5, y: 4.0 }; // æŠ¥é”™ expected integer, found
}

enum Result&lt;T, E&gt; {
    Ok(T),
    Err(E),
}

enum Option&lt;T&gt; {
    Some(T),
    None,
}
</code></pre>
<p><strong>æšä¸¾å®šä¹‰ä¸­çš„æ³›å‹</strong></p>
<ul>
<li>ä¸º<code>struct</code>æˆ–<code>enum</code>å®ç°æ–¹æ³•çš„æ—¶å€™ï¼Œå¯åœ¨å®šä¹‰ä¸­ä½¿ç”¨æ³›å‹</li>
<li>æ³¨æ„ï¼š<ul>
<li>æŠŠ<code>T</code>æ”¾åœ¨<code>impl</code>å…³é”®å­—åï¼Œè¡¨ç¤ºåœ¨ç±»å‹<code>T</code>ä¸Šå®ç°æ–¹æ³•<ul>
<li>ä¾‹å¦‚ï¼š<code>impl&lt;T&gt; Point&lt;T&gt;</code> </li>
</ul>
</li>
<li>åªé’ˆå¯¹å…·ä½“ç±»å‹å®ç°æ–¹æ³•ï¼ˆå…¶ä½™ç±»å‹æ²¡å®ç°æ–¹æ³•ï¼‰ï¼š<ul>
<li>ä¾‹å¦‚ï¼š<code>impl Point&lt;f32&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li><code>struct</code> é‡Œçš„æ³›å‹ç±»å‹å‚æ•°å¯ä»¥å’Œæ–¹æ³•çš„æ³›å‹ç±»å‹å‚æ•°ä¸åŒ</li>
</ul>
<p>Demo</p>
<pre><code>struct Point&lt;T&gt; {
    x: T,
    y: T,
}

impl&lt;T&gt; Point&lt;T&gt; {
    fn x(&amp;self) -&gt; &amp;T {
        &amp;self.x
    }
}

fn main() {
    let p = Point { x: 5, y: 10 };

    println!("p.x = {}", p.x());
}

struct Point&lt;T, U&gt; {
    x: T,
    y: U,
}

impl&lt;T, U&gt; Point&lt;T, U&gt; {
    fn mixup&lt;V, W&gt;(self, other: Point&lt;V, W&gt;) -&gt; Point&lt;T, W&gt; {
        Point {
            x: self.x,
            y: other.y,
        }
    }
}

fn main() {
    let p1 = Point { x: 5, y: 10.4 };
    let p2 = Point { x: "Hello", y: 'c'};

    let p3 = p1.mixup(p2);

    println!("p3.x = {}, p3.y = {}", p3.x, p3.y);
}
</code></pre>
<h2 id="10-2-traitï¼šå®šä¹‰å…±äº«çš„è¡Œä¸º"><a href="#10-2-traitï¼šå®šä¹‰å…±äº«çš„è¡Œä¸º" class="headerlink" title="10.2 traitï¼šå®šä¹‰å…±äº«çš„è¡Œä¸º"></a>10.2 traitï¼šå®šä¹‰å…±äº«çš„è¡Œä¸º</h2><ul>
<li><code>Trait</code> å‘Šè¯‰ <code>Rust</code> ç¼–è¯‘ï¼šæŸç§ç±»å‹å…·æœ‰å“ªäº›å¹¶ä¸”è€Œå·²ä¸å…¶ä»–ç±»å‹å…±äº«çš„åŠŸèƒ½</li>
<li> <code>Trait</code>ï¼šæŠ½è±¡çš„å®šä¹‰å…±äº«è¡Œä¸º</li>
<li> <code>Trait bounds</code>ï¼ˆçº¦æŸï¼‰ï¼šæ³›å‹ç±»å‹å‚æ•°æŒ‡å®šä¸ºå®ç°äº†ç‰¹ç‚¹è¡Œä¸ºçš„ç±»å‹ã€‚</li>
<li> <code>Trait</code>ä¸å…¶ä»–è¯­è¨€çš„æ¥å£ï¼ˆ<code>interface</code>ï¼‰ç±»ä¼¼ï¼Œä½†æ˜¯æœ‰äº›åŒºåˆ«</li>
</ul>
<p>Demo</p>
<pre><code>pub trait Summary {
    fn summarize(&amp;self) -&gt; String;
    // ä¹Ÿå¯ä»¥æœ‰é»˜è®¤å®ç°
    fn summarize(&amp;self) -&gt; String {
    String::from("(Read more...)")
}

pub struct Tweet {
    pub username: String,
    pub content: String,
    pub reply: bool,
    pub retweet: bool,
}

impl Summary for Tweet {
    fn summarize(&amp;self) -&gt; String {
        format!("{}: {}", self.username, self.content)
    }
}

// Trait Bound è¯­æ³•
pub fn notify&lt;T: Summary&gt;(item: T) {
    println!("Breaking news! {}", item.summarize());
}
pub fn notify(item1: impl Summary, item2: impl Summary) {
pub fn notify&lt;T: Summary&gt;(item1: T, item2: T) {
// é€šè¿‡ + æŒ‡å®šå¤šä¸ª trait bound
pub fn notify(item: impl Summary + Display) {
// é€šè¿‡ where ç®€åŒ– trait bound
fn some_function&lt;T: Display + Clone, U: Clone + Debug&gt;(t: T, u: U) -&gt; i32 {
fn some_function&lt;T, U&gt;(t: T, u: U) -&gt; i32
    where T: Display + Clone,
          U: Clone + Debug

// è¿”å›å®ç°äº† trait çš„ç±»å‹
fn returns_summarizable() -&gt; impl Summary {
    Tweet {
        username: String::from("horse_ebooks"),
        content: String::from("of course, as you probably already know, people"),
        reply: false,
        retweet: false,
    }
}

// è¿™æ®µä»£ç çš„è¿”å›å€¼ç±»å‹æŒ‡å®šä¸ºè¿”å› impl Summaryï¼Œä½†æ˜¯è¿”å›äº† NewsArticle æˆ– Tweet å°±è¡Œä¸é€šï¼š
fn returns_summarizable(switch: bool) -&gt; impl Summary {// æŠ¥é”™
    if switch {
        NewsArticle {
            headline: String::from("Penguins win the Stanley Cup Championship!"),
            location: String::from("Pittsburgh, PA, USA"),
            author: String::from("Iceburgh"),
            content: String::from("The Pittsburgh Penguins once again are the best
            hockey team in the NHL."),
        }
    } else {
        Tweet {
            username: String::from("horse_ebooks"),
            content: String::from("of course, as you probably already know, people"),
            reply: false,
            retweet: false,
        }
    }
}


// ç¤ºä¾‹ 10-15ï¼šä¸€ä¸ªå¯ä»¥ç”¨äºä»»ä½•å®ç°äº† PartialOrd å’Œ Copy trait çš„æ³›å‹çš„ largest å‡½æ•°
fn largest&lt;T: PartialOrd + Copy&gt;(list: &amp;[T]) -&gt; T {
    let mut largest = list[0].Clone();

    for item in list.iter() {
        if item &gt; &amp;largest {
            largest = item.clone();
        }
    }

    largest
}

fn largest2&lt;T: PartialOrd + Clone&gt;(list: &amp;[T]) -&gt; T {
    let mut largest = list[0];

    for &amp;item in list.iter() {
        if item &gt; largest {
            largest = item;
        }
    }

    largest
}

fn largest3&lt;T: PartialOrd + Clone&gt;(list: &amp;[T]) -&gt; &amp;T {
    let mut largest = &amp;list[0];

    for &amp;item in list.iter() {
        if item &gt; &amp;largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&amp;number_list);
    println!("The largest number is {}", result);

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&amp;char_list);
    println!("The largest char is {}", result);
}

// ä½¿ç”¨ trait bound æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•
struct Pair&lt;T&gt; {
    x: T,
    y: T,
}

impl&lt;T&gt; Pair&lt;T&gt; {
    fn new(x: T, y: T) -&gt; Self {
        Self {
            x,
            y,
        }
    }
}

impl&lt;T: Display + PartialOrd&gt; Pair&lt;T&gt; {
    fn cmp_display(&amp;self) {
        if self.x &gt;= self.y {
            println!("The largest member is x = {}", self.x);
        } else {
            println!("The largest member is y = {}", self.y);
        }
    }
}

let p = Pair {
    x: 1,
    y: 2,
};
p.cmp_display();

let p1 = Pair {
    x: vec![1, 2, 3],
    y: vec![1, 2, 3],
};
p1.cmp_display(); // æŠ¥é”™

3.to_string() //
//     impl Summary for Tweet {
// impl&lt;T: fmt::Display + ?Sized&gt; ToString for T {
pub trait ToString {
    fn to_string(&amp;self) -&gt; String;
}
</code></pre>
<h2 id="10-3-ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨æœ‰æ•ˆæ€§"><a href="#10-3-ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨æœ‰æ•ˆæ€§" class="headerlink" title="10.3 ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨æœ‰æ•ˆæ€§"></a>10.3 ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨æœ‰æ•ˆæ€§</h2><ul>
<li><code>Rust</code>çš„æ¯ä¸ªå¼•ç”¨éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼šå¼•ç”¨ä¿æŒæœ‰æ•ˆçš„ä½œç”¨åŸŸã€‚</li>
<li>å¤§å¤šæ•°æƒ…å†µï¼šç”Ÿå‘½å‘¨æœŸæ˜¯éšå¼çš„ã€å¯è¢«æ¨æ–­çš„ã€‚</li>
<li>å½“å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼ç›¸å…³äº’ç›¸å…³è”æ—¶ï¼šæ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚</li>
</ul>
<p><strong>å€Ÿç”¨æ£€æµ‹å™¨ Borrow Checker</strong></p>
<ul>
<li><code>Rust</code> ç¼–è¯‘å™¨çš„å€Ÿç”¨æ£€æŸ¥å™¨ï¼šæ¯”è¾ƒä½œç”¨åŸŸæ¥åˆ¤æ–­æ‰€æœ‰å€Ÿç”¨æ˜¯å¦åˆæ³•ã€‚</li>
</ul>
<p>Demo </p>
<pre><code>{
    let r;
    {
        let x = 5;
        r = &amp;x; // æŠ¥é”™ï¼Œ does not live long enough
    }

    println!("r: {}", r);
}

fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str { //  æŠ¥é”™ï¼Œexpected lifetime parameter
    if x.len() &gt; y.len() {
        x
    } else {
        y
    }
}
</code></pre>
<p><strong>ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•</strong></p>
<pre><code>&amp;i32        // å¼•ç”¨
&amp;'a i32     // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
&amp;'a mut i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨

fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
    if x.len() &gt; y.len() {
        x
    } else {
        y
    }
}

fn main() {
    let string1 = String::from("long string is long");
    let result;
    {
        let string2 = String::from("xyz");
        result = longest(string1.as_str(), string2.as_str()); // `string2` does not live long enough
    }
    println!("The longest string is {}", result);
}


fn longest&lt;'a&gt;(x: &amp;str, y: &amp;str) -&gt; &amp;'a str {
    let result = String::from("really long string");
    result.as_str() //  `result` does not live long enough
}
</code></pre>
<p><strong>ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨</strong></p>
<pre><code>struct ImportantExcerpt&lt;'a&gt; {
    part: &amp;'a str,
}

fn main() {
    let novel = String::from("Call me Ishmael. Some years ago...");
    let first_sentence = novel.split('.')
        .next()
        .expect("Could not find a '.'");
    let i = ImportantExcerpt { part: first_sentence };
}
</code></pre>
<p><strong>ç”Ÿå‘½å‘¨æœŸçœç•¥ï¼ˆLifetime Elisionï¼‰</strong></p>
<ul>
<li>æ¯ä¸ªå¼•ç”¨éƒ½æœ‰ç”Ÿå‘½å‘¨æœŸ</li>
<li>éœ€è¦ä¸ºä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°æˆ–è€… <code>Struct</code> æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°</li>
</ul>
<p><strong>ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™</strong></p>
<ul>
<li><p>åœ¨<code>Rust</code>å¼•ç”¨åˆ†æä¸­æ‰€ç¼–å…¥çš„æ¨¡å¼æˆä¸º<code>ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼ˆlifetime elision rulesï¼‰</code></p>
<ul>
<li>è¿™äº›è§„åˆ™æ— éœ€å¼€å‘è€…æ¥éµå¾ª</li>
<li>ä»–ä»¬æ˜¯ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œç”±ç¼–è¯‘å™¨æ¥è€ƒè™‘</li>
<li>å¦‚æœä½ çš„ä»£ç ç¬¦åˆè¿™äº›æƒ…å†µï¼Œé‚£ä¹ˆå°±æ— éœ€æ˜¾ç¤ºæ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ </li>
</ul>
</li>
<li><p>ç”Ÿå‘½å‘¨æœŸè§„åˆ™ä¸ä¼šæä¾›å®Œæ•´çš„æ¨åŠ¨</p>
<ul>
<li>å¦‚æœåº”ç”¨è§„åˆ™åï¼Œå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä»ç„¶æ¨¡ç³Šä¸æ¸… -&gt; ç¼–è¯‘é”™è¯¯</li>
<li>è§£å†³æ–¹æ³•ï¼šæ·»åŠ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼Œè¡¨æ˜å¼•ç”¨é—´çš„äº’ç›¸å…³ç³»</li>
</ul>
</li>
</ul>
<p>å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º <code>è¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼ˆinput lifetimesï¼‰</code>ï¼Œè€Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º <code>è¾“å‡ºç”Ÿå‘½å‘¨æœŸï¼ˆoutput lifetimes</code>ï¼‰ã€‚</p>
<p>ç”Ÿå‘½å‘¨æœŸçš„çœç•¥çš„ä¸‰ä¸ªè§„åˆ™</p>
<ul>
<li>å»ºè®®å…¶ä½¿ç”¨<code>3</code>ä¸ªè§„åˆ™åœ¨æ²¡æœ‰æ˜¾ç¤ºæ ‡æ³¨ç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µä¸‹ï¼Œæ¥ç¡®å®šå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ<ul>
<li>è§„åˆ™<code>1</code>åº”ç”¨äºè¾“å…¥ç”Ÿå‘½å‘¨æœŸ</li>
<li>è§„åˆ™<code>2</code>ã€<code>3</code>åº”ç”¨äºè¾“å‡ºç”Ÿå‘½å‘¨æœŸ</li>
<li>å¦‚æœç¼–è¯‘å™¨åº”ç”¨å®Œ<code>3</code>ä¸ªè§„åˆ™ä¹‹åï¼Œä»ç„¶æ— æ³•ç¡®å®šç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨ -&gt; æŠ¥é”™</li>
<li>è¿™äº›è§„åˆ™é€‚ç”¨äº <code>fn</code>å®šä¹‰å’Œ<code>impl</code>å—</li>
</ul>
</li>
<li>è§„åˆ™ä¸€ï¼šæ¯ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>è§„åˆ™äºŒï¼šæ¯ä¸ªåªæœ‰<code>1</code>ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸè¢«ä»˜ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚</li>
<li>è§„åˆ™ä¸‰ï¼šå¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯<code>&amp;self</code>æˆ–è€…æ˜¯<code>&amp;mut self</code>ï¼ˆæ˜¯æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆ<code>self</code>çš„ç”Ÿå‘½å‘¨æœŸä¼šä»˜ç»™æ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚</li>
</ul>
<p><strong>é™æ€ç”Ÿå‘½å‘¨æœŸ</strong></p>
<pre><code>let s: &amp;'static str = "I have a static lifetime.";
</code></pre>
<p><strong>ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait bounds å’Œç”Ÿå‘½å‘¨æœŸ</strong></p>
<pre><code>use std::fmt::Display;

fn longest_with_an_announcement&lt;'a, T&gt;(x: &amp;'a str, y: &amp;'a str, ann: T) -&gt; &amp;'a str
    where T: Display
{
    println!("Announcement! {}", ann);
    if x.len() &gt; y.len() {
        x
    } else {
        y
    }
}
</code></pre>
<h1 id="åäºŒã€ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#åäºŒã€ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="åäºŒã€ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•"></a>åäºŒã€ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•</h1><h2 id="12-1-å¦‚ä½•ç¼–å†™æµ‹è¯•"><a href="#12-1-å¦‚ä½•ç¼–å†™æµ‹è¯•" class="headerlink" title="12.1 å¦‚ä½•ç¼–å†™æµ‹è¯•"></a>12.1 å¦‚ä½•ç¼–å†™æµ‹è¯•</h2><p><strong>è§£å‰–æµ‹è¯•å‡½æ•°</strong></p>
<ul>
<li>æµ‹è¯•å‡½æ•°éœ€è¦ä½¿ç”¨<code>test</code>å±æ€§ï¼ˆ<code>attribute</code>ï¼‰è¿›è¡Œæ ‡æ³¨<ul>
<li><code>Attribute</code>å°±æ˜¯ä¸€æ®µ<code>Rust</code>ä»£ç çš„å…ƒæ•°æ®</li>
<li>åœ¨å‡½æ•°ä¸ŠåŠ <code>#[test]</code> ,å°±å¯ä»¥æŠŠå‡½æ•°å˜æˆæµ‹è¯•å‡½æ•°ã€‚</li>
</ul>
</li>
<li>ä½¿ç”¨ <code>cargo test</code> å‘½ä»¤è¿è¡Œæ‰€æœ‰æµ‹è¯•å‡½æ•°<ul>
<li><code>Rust</code> ä¼šæ„å»ºä¸€ä¸ª<code>Test Runner</code>å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>å®ƒä¼šè¿è¡Œæ ‡æ³¨äº†<code>test</code>çš„å‡½æ•°ï¼Œå¹¶æŠ¥å‘Šå…¶è¿è¡Œæ˜¯å¦æˆåŠŸ</li>
</ul>
</li>
<li>å½“ä½¿ç”¨ <code>cargo</code> åˆ›å»º<code>library</code>é¡¹ç›®çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>test module</code>ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª<code>test</code>å‡½æ•°<ul>
<li>ä½ å¯ä»¥æ·»åŠ ä»»æ„æ•°é‡çš„<code>test module</code>æˆ–è€…å‡½æ•° </li>
</ul>
</li>
</ul>
<p>demo</p>
<pre><code>#[cfg(test)] // è¡¨ç¤ºæ˜¯æµ‹è¯•æ¨¡å—
mod tests {
    #[test] // è¡¨ç¤ºæ˜¯æµ‹è¯•å‡½æ•°
    #[should_panic(expected = "Guess value must be less than or equal to 100")]
    fn it_works() -&gt; Result&lt;(), String&gt; {
        assert_eq!(2 + 2, 4);
        assert!(true);
        assert!(
            result.contains("Carol"),
            "Greeting did not contain name, value was `{}`", result
        );

    }
}
</code></pre>
<p><strong>å°† Result&lt;T, E&gt; ç”¨äºæµ‹è¯•</strong></p>
<pre><code>#[cfg(test)]
mod tests {
    #[test]
    fn it_works() -&gt; Result&lt;(), String&gt; { // è¿”å› Result
        if 2 + 2 == 4 {
            Ok(())
        } else {
            Err(String::from("two plus two does not equal four"))
        }
    }
}
</code></pre>
<h2 id="11-2-æ§åˆ¶æµ‹è¯•å¦‚ä½•è¿è¡Œ"><a href="#11-2-æ§åˆ¶æµ‹è¯•å¦‚ä½•è¿è¡Œ" class="headerlink" title="11.2 æ§åˆ¶æµ‹è¯•å¦‚ä½•è¿è¡Œ"></a>11.2 æ§åˆ¶æµ‹è¯•å¦‚ä½•è¿è¡Œ</h2><pre><code>// è¿™é‡Œå°†æµ‹è¯•çº¿ç¨‹è®¾ç½®ä¸º 1ï¼Œå‘Šè¯‰ç¨‹åºä¸è¦ä½¿ç”¨ä»»ä½•å¹¶è¡Œæœºåˆ¶
$ cargo test -- --test-threads=1
// å¦‚æœä½ å¸Œæœ›ä¹Ÿèƒ½çœ‹åˆ°é€šè¿‡çš„æµ‹è¯•ä¸­æ‰“å°çš„å€¼ï¼Œæˆªè·è¾“å‡ºçš„è¡Œä¸ºå¯ä»¥é€šè¿‡ --nocapture å‚æ•°æ¥ç¦ç”¨ï¼š
$ cargo test -- --nocapture
$ cargo test -- --show-output
$ cargo test one_hundred
$ cargo test add // test tests::add_two_and_two, test tests::add_three_and_two

#[test]
#[ignore] // æ ‡æ³¨ä»¥åï¼Œcargo test ä¸ä¼šè¿è¡Œ
fn expensive_test() {
    // éœ€è¦è¿è¡Œä¸€ä¸ªå°æ—¶çš„ä»£ç 
}

$ cargo test -- --ignored // å¯ä»¥å•ç‹¬è¿è¡Œè¢«æ ‡è®°ä¸º ignored
</code></pre>
<h2 id="11-3-æµ‹è¯•çš„ç»„ç»‡ç»“æ„"><a href="#11-3-æµ‹è¯•çš„ç»„ç»‡ç»“æ„" class="headerlink" title="11.3 æµ‹è¯•çš„ç»„ç»‡ç»“æ„"></a>11.3 æµ‹è¯•çš„ç»„ç»‡ç»“æ„</h2><p><code>#[cfg(test)]</code>æ ‡æ³¨</p>
<ul>
<li><code>tests</code>æ¨¡å—ä¸Šçš„<code>#[cfg(test)]</code>æ ‡æ³¨ï¼š<ul>
<li>åªæœ‰è¿è¡Œ<code>cargo test</code> æ‰ä¼šç¼–è¯‘å’Œè¿è¡Œä»£ç </li>
<li>è¿è¡Œ <code>cargo build</code>åˆ™ä¸ä¼š</li>
</ul>
</li>
<li>é›†æˆæµ‹è¯•åœ¨ä¸åŒçš„ç›®å½•ï¼Œå®ƒä¸éœ€è¦ <code>#[cfg(test)]</code>æ ‡æ³¨</li>
<li><code>cfg:configration(é…ç½®)</code><ul>
<li>å‘Šè¯‰<code>Rust</code>ä¸‹é¢çš„æ¡ç›®åªæœ‰åœ¨æŒ‡å®šçš„é…ç½®é€‰é¡¹ä¸‹æ‰ä¼šè¢«åŒ…å«</li>
<li>é…ç½®é€‰é¡¹<code>test</code>ï¼šç”±<code>Rust</code>æä¾›ï¼Œç”¨æ¥ç¼–è¯‘å’Œè¿è¡Œæµ‹è¯•ã€‚<ul>
<li>åªæœ‰ <code>cargo test</code> æ‰ä¼šç¼–è¯‘ä»£ç ï¼ŒåŒ…æ‹¬æ¨¡å—ä¸­çš„<code>helper</code>å‡½æ•°å’Œ<code>#[test]</code>æ ‡æ³¨çš„å‡½æ•°</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>å•å…ƒæµ‹è¯•</strong></p>
<pre><code>#[cfg(test)] // è¡¨ç¤ºåªä¼šåœ¨è¿è¡Œ cargo test æ‰ä¼šç¼–è¯‘æ‰§è¡Œä¸‹é¢å‡½æ•°
mod tests {
    #[test]
    fn it_works() {
        assert_eq!(2 + 2, 4);
    }
}
</code></pre>
<p><strong>é›†æˆæµ‹è¯•</strong></p>
<ul>
<li><p>åˆ›å»ºé›†æˆæµ‹è¯•ï¼š<code>tests</code>ç›®å½•</p>
</li>
<li><p><code>tests</code>ç›®å½•ä¸‹çš„æ¯ä¸ªæµ‹è¯•æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„<code>crate</code></p>
<ul>
<li>éœ€è¦å°†è¢«æµ‹è¯•åº“å¯¼å…¥</li>
</ul>
</li>
<li><p>æ— éœ€æ ‡æ³¨<code>#[cfg(test)]</code>,<code>tests</code>ç›®å½•è¢«ç‰¹æ®Šå¯¹å¾…</p>
<p>  cargo test å‡½æ•°å<br>  cargo test â€“test æ–‡ä»¶å</p>
</li>
</ul>
<p>æ–‡ä»¶å: <code>tests/integration_test.rs</code></p>
<pre><code>use adder;

#[test]
fn it_adds_two() {
    assert_eq!(4, adder::add_two(2));
}
</code></pre>
<h1 id="åäºŒã€ä¸€ä¸ª-I-O-é¡¹ç›®ï¼šæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº"><a href="#åäºŒã€ä¸€ä¸ª-I-O-é¡¹ç›®ï¼šæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº" class="headerlink" title="åäºŒã€ä¸€ä¸ª I/O é¡¹ç›®ï¼šæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº"></a>åäºŒã€ä¸€ä¸ª I/O é¡¹ç›®ï¼šæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº</h1><p>src/main.rs </p>
<pre><code>use std::env;
use std::process;

use minigrep::Config;

fn main() {
    let config = Config::new(env::args()).unwrap_or_else(|err| {
        println!("Problem parsing arguments: {}", err);
        process::exit(1);
    });

    if let Err(err) = minigrep::run(config) {
        eprintln!("Application error: {}", err);
        process::exit(1);
    };
}
</code></pre>
<p>src/lib.rs </p>
<pre><code>use std::error::Error;
use std::{env, fs};

pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(config.filename)?;

    let results: Vec&lt;&amp;str&gt; = if config.case_sensitive {
        search(&amp;config.query, &amp;contents)
    } else {
        search_case_insensitive(&amp;config.query, &amp;contents)
    };

    for line in results {
        println!("{}", line)
    }

    Ok(())
}

fn search&lt;'a&gt;(key: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    contents.lines().filter(|line| line.contains(key)).collect()
}

fn search_case_insensitive&lt;'a&gt;(key: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    let key = key.to_lowercase();
    contents
        .lines()
        .filter(|line| line.to_lowercase().contains(&amp;key))
        .collect()
}

pub struct Config {
    pub query: String,
    pub filename: String,
    pub case_sensitive: bool,
}

impl Config {
    pub fn new(mut args: env::Args) -&gt; Result&lt;Config, &amp;'static str&gt; {
        args.next();

        let query = match args.next() {
            Some(arg) =&gt; arg,
            None =&gt; return Err("Didn't get a query string"),
        };

        let filename = match args.next() {
            Some(arg) =&gt; arg,
            None =&gt; return Err("Didn't get a filename"),
        };

        let case_sensitive = std::env::var("CASE_INSENSITIVE").is_err();
        Ok(Config {
            query,
            filename,
            case_sensitive: case_sensitive,
        })
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn case_sensitive() {
        let query = "duct";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.
Duct tape.";
        assert_eq!(vec!["safe, fast, productive."], search(query, contents))
    }

    #[test]
    fn case_insensitive() {
        let query = "rUsT";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.
Trust me.";
        assert_eq!(
            vec!["Rust:", "Trust me."],
            search_case_insensitive(query, contents)
        )
    }
}
</code></pre>
<h1 id="åä¸‰ã€Rust-ä¸­çš„å‡½æ•°å¼è¯­è¨€åŠŸèƒ½ï¼šè¿­ä»£å™¨ä¸é—­åŒ…"><a href="#åä¸‰ã€Rust-ä¸­çš„å‡½æ•°å¼è¯­è¨€åŠŸèƒ½ï¼šè¿­ä»£å™¨ä¸é—­åŒ…" class="headerlink" title="åä¸‰ã€Rust ä¸­çš„å‡½æ•°å¼è¯­è¨€åŠŸèƒ½ï¼šè¿­ä»£å™¨ä¸é—­åŒ…"></a>åä¸‰ã€Rust ä¸­çš„å‡½æ•°å¼è¯­è¨€åŠŸèƒ½ï¼šè¿­ä»£å™¨ä¸é—­åŒ…</h1><h2 id="13-1-é—­åŒ…ï¼šå¯ä»¥æ•è·å…¶ç¯å¢ƒçš„åŒ¿åå‡½æ•°"><a href="#13-1-é—­åŒ…ï¼šå¯ä»¥æ•è·å…¶ç¯å¢ƒçš„åŒ¿åå‡½æ•°" class="headerlink" title="13.1 é—­åŒ…ï¼šå¯ä»¥æ•è·å…¶ç¯å¢ƒçš„åŒ¿åå‡½æ•°"></a>13.1 é—­åŒ…ï¼šå¯ä»¥æ•è·å…¶ç¯å¢ƒçš„åŒ¿åå‡½æ•°</h2><p>Demo</p>
<pre><code>fn  add_one_v1   (x: u32) -&gt; u32 { x + 1 }
let add_one_v2 = |x: u32| -&gt; u32 { x + 1 };
let add_one_v3 = |x|             { x + 1 };
let add_one_v4 = |x|               x + 1  ;

let example_closure = |x| x;
let s = example_closure(String::from("hello"));
let n = example_closure(5); // æŠ¥é”™

let expensive_closure = |num| {
    println!("calculating slowly...");
    thread::sleep(Duration::from_secs(2));
    num
};
</code></pre>
<p>ä½¿ç”¨å¸¦æœ‰æ³›å‹å’Œ<code> Fn trait</code> çš„é—­åŒ…</p>
<pre><code>struct Cacher&lt;T&gt;
    where T: Fn(u32) -&gt; u32
{
    calculation: T,
    value: Option&lt;u32&gt;,
}

impl&lt;T&gt; Cacher&lt;T&gt;
    where T: Fn(u32) -&gt; u32
{
    fn new(calculation: T) -&gt; Cacher&lt;T&gt; {
        Cacher {
            calculation,
            value: None,
        }
    }

    fn value(&amp;mut self, arg: u32) -&gt; u32 {
        match self.value {
            Some(v) =&gt; v,
            None =&gt; {
                let v = (self.calculation)(arg);
                self.value = Some(v);
                v
            },
        }
    }
}

let mut c = Cacher::new(|a| a);

let v1 = c.value(1);
let v2 = c.value(2);

assert_eq!(v2, 2);
</code></pre>
<p><strong>é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ</strong></p>
<p>åˆ›å»ºé—­åŒ…æ—¶ï¼Œé€šè¿‡é—­åŒ…å¯¹ç¯å¢ƒå€¼çš„ä½¿ç”¨ï¼Œ<code>Rust</code>æ¨æ–­å‡ºå…·ä½“ä½¿ç”¨å“ªä¸ª<code>trait</code>ï¼š</p>
<ul>
<li>æ‰€æœ‰é—­åŒ…éƒ½å®ç°äº†<code>FnOnce</code></li>
<li>æ²¡æœ‰ç§»åŠ¨æ•è·å˜é‡çš„å®ç°äº†<code>FnMut</code>ï¼Œï¼ˆé‚£äº›å¹¶æ²¡æœ‰ç§»åŠ¨è¢«æ•è·å˜é‡çš„æ‰€æœ‰æƒåˆ°é—­åŒ…å†…çš„é—­åŒ…ä¹Ÿå®ç°äº† <code>FnMut</code> ï¼‰</li>
<li>æ— éœ€å¯å˜è®¿é—®æ•è·å˜é‡çš„é—­åŒ…å®ç°äº†<code>Fn</code>ï¼ˆä¸éœ€è¦å¯¹è¢«æ•è·çš„å˜é‡è¿›è¡Œå¯å˜è®¿é—®çš„é—­åŒ…åˆ™ä¹Ÿå®ç°äº† <code>Fn</code>ï¼‰</li>
</ul>
<p>é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼ï¼šä¸å‡½æ•°è·å¾—å‚æ•°ä¸‰ç§æ–¹å¼ä¸€æ ·ï¼š</p>
<ol>
<li>å–å¾—æ‰€æœ‰æƒï¼š<code>FnOnce</code>,æ¶ˆè´¹ä»å‘¨å›´ä½œç”¨åŸŸæ•è·çš„å˜é‡ï¼Œé—­åŒ…å‘¨å›´çš„ä½œç”¨åŸŸè¢«ç§°ä¸ºå…¶ ç¯å¢ƒï¼Œ<code>environment</code>ã€‚ä¸ºäº†æ¶ˆè´¹æ•è·åˆ°çš„å˜é‡ï¼Œé—­åŒ…å¿…é¡»è·å–å…¶æ‰€æœ‰æƒå¹¶åœ¨å®šä¹‰é—­åŒ…æ—¶å°†å…¶ç§»åŠ¨è¿›é—­åŒ…ã€‚å…¶åç§°çš„ <code>Once</code> éƒ¨åˆ†ä»£è¡¨äº†é—­åŒ…ä¸èƒ½å¤šæ¬¡è·å–ç›¸åŒå˜é‡çš„æ‰€æœ‰æƒçš„äº‹å®ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚ï¼ˆæ‰€æœ‰é—­åŒ…éƒ½å®ç°äº†<code>FnOnce</code>ï¼‰</li>
<li>å¯å˜å€Ÿç”¨ï¼š<code>FnMut</code>ï¼Œè·å–å¯å˜çš„å€Ÿç”¨å€¼æ‰€ä»¥å¯ä»¥æ”¹å˜å…¶ç¯å¢ƒã€‚ï¼ˆæ²¡æœ‰ç§»åŠ¨æ•è·å˜é‡çš„å®ç°äº†<code>FnMut</code>ï¼‰</li>
<li>ä¸å¯å˜å€Ÿç”¨ï¼š<code>Fn</code>ï¼Œä»å…¶ç¯å¢ƒè·å–ä¸å¯å˜çš„å€Ÿç”¨å€¼ ã€‚ ï¼ˆæ— éœ€å¯å˜è®¿é—®æ•è·å˜é‡çš„é—­åŒ…å®ç°äº†<code>Fn</code>ï¼‰</li>
</ol>
<p>Demo</p>
<pre><code>let x = 4;
fn equal_to_x(z: i32) -&gt; bool { z == x } // can't capture dynamic environment in a fn item; use the || { ...} closure form instead
// Fn trait
// equal_to_x é—­åŒ…ä¸å¯å˜çš„å€Ÿç”¨äº† xï¼ˆæ‰€ä»¥ equal_to_x å…·æœ‰ Fn traitï¼‰
let equal_to_x = |z| z == x; 
let y = 4;
assert!(equal_to_x(y));

    
// x è¢«ç§»åŠ¨è¿›äº†é—­åŒ…ï¼Œå› ä¸ºé—­åŒ…ä½¿ç”¨ move å…³é”®å­—å®šä¹‰ã€‚æ¥ç€é—­åŒ…è·å–äº† x çš„æ‰€æœ‰æƒï¼ŒåŒæ—¶ main å°±ä¸å†å…è®¸åœ¨ println! è¯­å¥ä¸­ä½¿ç”¨ x äº†ã€‚å»æ‰ println! å³å¯ä¿®å¤é—®é¢˜ã€‚
let x = vec![1, 2, 3];
let equal_to_x = move |z| z == x;
println!("can't use x here: {:?}", x); // æŠ¥é”™ã€‚value borrowed here after move
let y = vec![1, 2, 3];
println!("equal_to_x(y) = {}",equal_to_x(y));
</code></pre>
<h2 id="13-2-ä½¿ç”¨è¿­ä»£å™¨å¤„ç†å…ƒç´ åºåˆ—"><a href="#13-2-ä½¿ç”¨è¿­ä»£å™¨å¤„ç†å…ƒç´ åºåˆ—" class="headerlink" title="13.2 ä½¿ç”¨è¿­ä»£å™¨å¤„ç†å…ƒç´ åºåˆ—"></a>13.2 ä½¿ç”¨è¿­ä»£å™¨å¤„ç†å…ƒç´ åºåˆ—</h2><p>å‡ ä¸ªè¿­ä»£æ–¹æ³•ï¼š</p>
<ul>
<li><code>iter</code>ï¼šåœ¨ä¸å¯å˜å¼•ç”¨ä¸Šåˆ›å»ºè¿­ä»£å™¨</li>
<li><code>into_iter</code>ï¼šåˆ›å»ºçš„è¿­ä»£å™¨ä¼šè·å¾—æ‰€æœ‰æƒ</li>
<li><code>iter_mut</code>ï¼šè¿­ä»£å¯å˜çš„å¼•ç”¨</li>
</ul>
<p>Demo</p>
<pre><code>let v1 = vec![1, 2, 3];
let v1_iter = v1.iter();
for val in v1_iter {
    println!("Got: {}", val);
}

let v1 = vec![1, 2, 3];
let mut v1_iter = v1.iter();
assert_eq!(v1_iter.next(), Some(&amp;1));
assert_eq!(v1_iter.next(), Some(&amp;2));
assert_eq!(v1_iter.next(), Some(&amp;3));
assert_eq!(v1_iter.next(), None);

let total: i32 = v1_iter.sum();

 // äº§ç”Ÿå…¶ä»–è¿­ä»£å™¨çš„æ–¹æ³•
let v1: Vec&lt;i32&gt; = vec![1, 2, 3];
let v2: Vec&lt;_&gt; = v1.iter().map(|x| x + 1).collect();
assert_eq!(v2, vec![2, 3, 4]);
</code></pre>
<p><strong>å®ç° Iterator trait æ¥åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨</strong></p>
<pre><code>struct Counter {
    count: u32,
}

impl Counter {
    fn new() -&gt; Counter {
        Counter { count: 0 }
    }
}

impl Iterator for Counter {
    type Item = u32;

    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
        self.count += 1;

        if self.count &lt; 6 {
            Some(self.count)
        } else {
            None
        }
    }
}

let mut counter = Counter::new();

assert_eq!(counter.next(), Some(1));
assert_eq!(counter.next(), Some(2));
assert_eq!(counter.next(), Some(3));
assert_eq!(counter.next(), Some(4));
assert_eq!(counter.next(), Some(5));
assert_eq!(counter.next(), None);


fn using_other_iterator_trait_methods() {
    let sum: u32 = Counter::new()
        .zip(Counter::new().skip(1))
        .map(|(a, b)| a * b)
        .filter(|x| x % 3 == 0)
        .sum();
    assert_eq!(18, sum);
}
</code></pre>
<h2 id="13-3-æ€§èƒ½å¯¹æ¯”ï¼šå¾ªç¯-VS-è¿­ä»£å™¨"><a href="#13-3-æ€§èƒ½å¯¹æ¯”ï¼šå¾ªç¯-VS-è¿­ä»£å™¨" class="headerlink" title="13.3 æ€§èƒ½å¯¹æ¯”ï¼šå¾ªç¯ VS è¿­ä»£å™¨"></a>13.3 æ€§èƒ½å¯¹æ¯”ï¼šå¾ªç¯ VS è¿­ä»£å™¨</h2><pre><code>test bench_search_for  ... bench:  19,620,300 ns/iter (+/- 915,700)
test bench_search_iter ... bench:  19,234,900 ns/iter (+/- 657,200)
</code></pre>
<p>ç»“æœè¿­ä»£å™¨ç‰ˆæœ¬è¿˜è¦ç¨å¾®å¿«ä¸€ç‚¹ï¼è¿™é‡Œæˆ‘ä»¬å°†ä¸ä¼šæŸ¥çœ‹æ€§èƒ½æµ‹è¯•çš„ä»£ç ï¼Œæˆ‘ä»¬çš„ç›®çš„å¹¶ä¸æ˜¯ä¸ºäº†è¯æ˜ä»–ä»¬æ˜¯å®Œå…¨ç­‰åŒçš„ï¼Œè€Œæ˜¯å¾—å‡ºä¸€ä¸ªæ€æ ·æ¯”è¾ƒè¿™ä¸¤ç§å®ç°æ–¹å¼æ€§èƒ½çš„åŸºæœ¬æ€è·¯ã€‚</p>
<p>å¯¹äºä¸€ä¸ªæ›´å…¨é¢çš„æ€§èƒ½æµ‹è¯•ï¼Œå°†ä¼šæ£€æŸ¥ä¸åŒé•¿åº¦çš„æ–‡æœ¬ã€ä¸åŒçš„æœç´¢å•è¯ã€ä¸åŒé•¿åº¦çš„å•è¯å’Œæ‰€æœ‰å…¶ä»–çš„å¯å˜æƒ…å†µã€‚è¿™é‡Œæ‰€è¦è¡¨è¾¾çš„æ˜¯ï¼šè¿­ä»£å™¨ï¼Œä½œä¸ºä¸€ä¸ªé«˜çº§çš„æŠ½è±¡ï¼Œè¢«ç¼–è¯‘æˆäº†ä¸æ‰‹å†™çš„åº•å±‚ä»£ç å¤§ä½“ä¸€è‡´æ€§èƒ½ä»£ç ã€‚è¿­ä»£å™¨æ˜¯ <code>Rust</code> çš„ é›¶æˆæœ¬æŠ½è±¡ï¼ˆ<code>zero-cost abstractions</code>ï¼‰ä¹‹ä¸€ï¼Œå®ƒæ„å‘³ç€æŠ½è±¡å¹¶ä¸ä¼šå¼•å…¥è¿è¡Œæ—¶å¼€é”€ï¼Œå®ƒä¸æœ¬è´¾å°¼Â·æ–¯ç‰¹åŠ³æ–¯ç‰¹å¢æ™®ï¼ˆ<code>C++</code> çš„è®¾è®¡å’Œå®ç°è€…ï¼‰åœ¨ â€œ<code>Foundations of C++</code>â€ï¼ˆ<code>2012</code>ï¼‰ ä¸­æ‰€å®šä¹‰çš„ é›¶å¼€é”€ï¼ˆ<code>zero-overhead</code>ï¼‰å¦‚å‡ºä¸€è¾™ï¼š</p>
<pre><code>In general, C++ implementations obey the zero-overhead principle: What you donâ€™t use, you donâ€™t pay for. And further: What you do use, you couldnâ€™t hand code any better.
Bjarne Stroustrup "Foundations of C++"

ä»æ•´ä½“æ¥è¯´ï¼ŒC++ çš„å®ç°éµå¾ªäº†é›¶å¼€é”€åŸåˆ™ï¼šä½ ä¸éœ€è¦çš„ï¼Œæ— éœ€ä¸ºä»–ä»¬ä¹°å•ã€‚æ›´æœ‰ç”šè€…çš„æ˜¯ï¼šä½ éœ€è¦çš„æ—¶å€™ï¼Œä¹Ÿä¸å¯èƒ½æ‰¾åˆ°å…¶ä»–æ›´å¥½çš„ä»£ç äº†ã€‚
æœ¬è´¾å°¼Â·æ–¯ç‰¹åŠ³æ–¯ç‰¹å¢æ™® "Foundations of C++"
</code></pre>
<h1 id="åå››ã€Cargo-å’Œ-Crates-io"><a href="#åå››ã€Cargo-å’Œ-Crates-io" class="headerlink" title="åå››ã€Cargo å’Œ Crates.io"></a>åå››ã€Cargo å’Œ Crates.io</h1><p>é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º</p>
<pre><code>$ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
$ cargo build --release
    Finished release [optimized] target(s) in 0.0 secs


[profile.dev]
opt-level = 0

[profile.release]
opt-level = 3


// add_one å‡½æ•°çš„æ–‡æ¡£æ³¨é‡Šï¼š

/// Adds one to the number given.
///
/// # Examples
///
/// ```
/// let arg = 5;
/// let answer = my_crate::add_one(arg);
///
/// assert_eq!(6, answer);
/// ```
pub fn add_one(x: i32) -&gt; i32 {
    x + 1
}


cargo doc
cargo doc --open

// my_crate crate æ•´ä½“çš„æ–‡æ¡£çš„æ³¨é‡Š
//! # My Crate
//!
//! `my_crate` is a collection of utilities to make performing certain
//! calculations more convenient.



// é‡æ–°å¯¼å‡º

use art::kinds::PrimaryColor;
use art::utils::mix;

fn main() {
    let red = PrimaryColor::Red;
    let yellow = PrimaryColor::Yellow;
    mix(red, yellow);
}


pub use self::kinds::PrimaryColor;
pub use self::kinds::SecondaryColor;
pub use self::utils::mix;


use art::PrimaryColor;
use art::mix;

fn main() {
    // --snip--
}

// åˆ›å»º Crates.io è´¦å·
$ cargo login abcdefghijklmnopqrstuvwxyz012345

[package]
name = "guessing_game"
version = "0.1.0"
authors = ["Your Name &lt;you@example.com&gt;"]
edition = "2018"
description = "A fun game where you guess what number the computer has chosen."
license = "MIT OR Apache-2.0"

cargo publish

// ä¸ºäº†æ’¤å›ä¸€ä¸ª crateï¼Œè¿è¡Œ cargo yank å¹¶æŒ‡å®šå¸Œæœ›æ’¤å›çš„ç‰ˆæœ¬ï¼š

$ cargo yank --vers 1.0.1
$ cargo yank --vers 1.0.1 --undo


// å·¥ä½œç©ºé—´

[workspace]

members = [
    "adder",
    "add-one",
]

cargo new add-one --lib


$ cargo install ripgrep

// Cargo çš„è®¾è®¡ä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡æ–°çš„å­å‘½ä»¤æ¥å¯¹ Cargo è¿›è¡Œæ‰©å±•ï¼Œè€Œæ— éœ€ä¿®æ”¹ Cargo æœ¬èº«ã€‚å¦‚æœ $PATH ä¸­æœ‰ç±»ä¼¼ cargo-something çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±å¯ä»¥é€šè¿‡ cargo something æ¥åƒ Cargo å­å‘½ä»¤ä¸€æ ·è¿è¡Œå®ƒã€‚åƒè¿™æ ·çš„è‡ªå®šä¹‰å‘½ä»¤ä¹Ÿå¯ä»¥è¿è¡Œ cargo --list æ¥å±•ç¤ºå‡ºæ¥ã€‚èƒ½å¤Ÿé€šè¿‡ cargo install å‘ Cargo å®‰è£…æ‰©å±•å¹¶å¯ä»¥å¦‚å†…å»º Cargo å·¥å…·é‚£æ ·è¿è¡Œä»–ä»¬æ˜¯ Cargo è®¾è®¡ä¸Šçš„ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„ä¼˜ç‚¹ï¼
</code></pre>
<h1 id="åäº”ã€æ™ºèƒ½æŒ‡é’ˆ"><a href="#åäº”ã€æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="åäº”ã€æ™ºèƒ½æŒ‡é’ˆ"></a>åäº”ã€æ™ºèƒ½æŒ‡é’ˆ</h1><ul>
<li>æŒ‡é’ˆï¼šä¸€ä¸ªå˜é‡åœ¨å†…å­˜ä¸­åŒ…å«çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼ˆæŒ‡å‘å…¶ä»–æ•°æ®ï¼‰</li>
<li><code>Rust</code> ä¸­æœ€å¸¸è§çš„æŒ‡é’ˆå°±æ˜¯â€œå¼•ç”¨â€ </li>
<li>â€œå¼•ç”¨â€ï¼š<ul>
<li>ä½¿ç”¨<code>&amp;</code>     </li>
<li>å€Ÿç”¨å®ƒæŒ‡å‘çš„å€¼</li>
<li>æ²¡æœ‰å…¶ä½™å¼€é”€</li>
<li>æœ€å¸¸è§çš„æŒ‡é’ˆç±»å‹</li>
</ul>
</li>
</ul>
<p>æ™ºèƒ½æŒ‡é’ˆï¼š</p>
<ul>
<li>è¡Œä¸ºå’ŒæŒ‡é’ˆç›¸ä¼¼ã€‚ </li>
<li>æœ‰é¢å¤–çš„å…ƒæ•°æ®å’ŒåŠŸèƒ½ã€‚</li>
</ul>
<p>å¼•ç”¨è®¡æ•°ï¼ˆ<code>reference counting</code>ï¼‰æ™ºèƒ½æŒ‡é’ˆç±»å‹</p>
<ul>
<li>é€šè¿‡è®°å½•æ‰€æœ‰è€…çš„æ•°é‡ï¼Œä½¿ä¸€ä»½æ•°æ®è¢«å¤šä¸ªæ‰€æœ‰è€…åŒäº‹æŒæœ‰</li>
<li>å¹¶ä¸”åœ¨æ²¡æœ‰ä»»ä½•ä½¿ç”¨è€…æ—¶ï¼Œè‡ªåŠ¨æ¸…ç†æ•°æ®ã€‚ </li>
</ul>
<p>å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„ä¸åŒï¼šå¼•ç”¨åªæ˜¯å€Ÿç”¨æ•°æ®ï¼Œæ™ºèƒ½æŒ‡é’ˆæ˜¯æ‹¥æœ‰æ•°æ®ã€‚</p>
<ul>
<li><code>String</code>å’Œ<code>Vec&lt;T&gt;</code></li>
<li>éƒ½æ‹¥æœ‰ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼Œä¸”å…è®¸ç”¨æˆ·å¯¹å…¶æ“ä½œ</li>
</ul>
<p>æ™ºèƒ½æŒ‡é’ˆçš„å®ç°</p>
<ul>
<li>æ™ºèƒ½æŒ‡é’ˆé€šå¸¸ä½¿ç”¨<code>struct</code>å®ç°ï¼Œå¹¶ä¸”å®ç°äº†ï¼š<ul>
<li><code>Deref</code> å’Œ <code>Drop</code>è¿™ä¸¤ä¸ª<code>trait</code> </li>
</ul>
</li>
<li><code>Deref trait</code>ï¼šå…è®¸åªèƒ½æŒ‡é’ˆ<code>struct</code>çš„å®ä¾‹åƒå¼•ç”¨ä¸€æ ·ä½¿ç”¨</li>
<li><code>Drop trait</code>ï¼šå…è®¸ä½ è‡ªå®šä¹‰å½“æ™ºèƒ½æŒ‡é’ˆå®ä¾‹èµ°å‡ºä½œç”¨åŸŸæ—¶çš„ä»£ç </li>
</ul>
<p>æ™ºèƒ½æŒ‡é’ˆ</p>
<ul>
<li><code>Box&lt;T&gt;</code>ï¼Œç”¨äºåœ¨å †ä¸Šåˆ†é…å€¼</li>
<li><code>Rc&lt;T&gt;</code>ï¼Œä¸€ä¸ªå¼•ç”¨è®¡æ•°ç±»å‹ï¼Œå…¶æ•°æ®å¯ä»¥æœ‰å¤šä¸ªæ‰€æœ‰è€…</li>
<li><code>Ref&lt;T&gt;</code> å’Œ <code>RefMut&lt;T&gt;</code>ï¼Œé€šè¿‡ <code>RefCell&lt;T&gt;</code> è®¿é—®ï¼ˆ <code>RefCell&lt;T&gt;</code>æ˜¯ä¸€ä¸ªåœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æ‰§è¡Œå€Ÿç”¨è§„åˆ™çš„ç±»å‹ï¼‰</li>
</ul>
<h2 id="15-1-ä½¿ç”¨-Box-æŒ‡å‘å †ä¸Šçš„æ•°æ®"><a href="#15-1-ä½¿ç”¨-Box-æŒ‡å‘å †ä¸Šçš„æ•°æ®" class="headerlink" title="15.1 ä½¿ç”¨ Box æŒ‡å‘å †ä¸Šçš„æ•°æ®"></a>15.1 ä½¿ç”¨ Box<t> æŒ‡å‘å †ä¸Šçš„æ•°æ®</t></h2><p>æœ€ç®€å•ç›´æ¥çš„æ™ºèƒ½æŒ‡é’ˆæ˜¯ <code>box</code>ï¼Œå…¶ç±»å‹æ˜¯ <code>Box&lt;T&gt;</code>ã€‚é™¤äº†æ•°æ®è¢«å‚¨å­˜åœ¨å †ä¸Šè€Œä¸æ˜¯æ ˆä¸Šä¹‹å¤–ï¼Œ<code>box</code>æ²¡æœ‰æ€§èƒ½æŸå¤±ã€‚ä¸è¿‡ä¹Ÿæ²¡æœ‰å¾ˆå¤šé¢å¤–çš„åŠŸèƒ½ã€‚å®ƒä»¬å¤šç”¨äºå¦‚ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>å½“æœ‰ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„ç±»å‹ï¼Œè€Œåˆæƒ³è¦åœ¨éœ€è¦ç¡®åˆ‡å¤§å°çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹å€¼çš„æ—¶å€™</li>
<li>å½“æœ‰å¤§é‡æ•°æ®å¹¶å¸Œæœ›åœ¨ç¡®ä¿æ•°æ®ä¸è¢«æ‹·è´çš„æƒ…å†µä¸‹è½¬ç§»æ‰€æœ‰æƒçš„æ—¶å€™</li>
<li>å½“å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªå€¼å¹¶åªå…³å¿ƒå®ƒçš„ç±»å‹æ˜¯å¦å®ç°äº†ç‰¹å®š <code>trait</code> è€Œä¸æ˜¯å…¶å…·ä½“ç±»å‹çš„æ—¶å€™</li>
</ul>
<p><code>Box&lt;T&gt;</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œ<code>Rust</code>çŸ¥é“å®ƒéœ€è¦å¤šå°‘ç©ºé—´ï¼Œå› ä¸ºï¼šæŒ‡é’ˆçš„å¤§å°æ˜¯å›ºå®šçš„ã€‚</p>
<p><code>Box&lt;T&gt;</code>ï¼š</p>
<ul>
<li>åªææä¾›äº†â€œé—´æ¥â€å­˜å‚¨å’Œ<code>heap</code>å†…å­˜åˆ†é…çš„åŠŸèƒ½ã€‚</li>
<li>æ²¡æœ‰å…¶ä»–é¢å¤–åŠŸèƒ½</li>
<li>æ²¡æœ‰æ€§èƒ½å¼€é”€</li>
<li>é€‚ç”¨äºéœ€è¦â€œé—´æ¥â€å­˜å‚¨çš„åœºæ™¯ï¼Œä¾‹å¦‚<code>Cons List</code></li>
<li>å®ç°äº†<code>Deref trait</code>å’Œ<code>Drop trait</code></li>
</ul>
<p>Demo</p>
<pre><code>ä½¿ç”¨ Box&lt;T&gt; åœ¨å †ä¸Šå‚¨å­˜æ•°æ®
fn main() {
    let b = Box::new(5);
    println!("b = {}", b);
}

Box å…è®¸åˆ›å»ºé€’å½’ç±»å‹
use crate::List::{Cons, Nil};

enum List { // åµŒå¥—
    Cons(i32, List),
    Nil,
}

fn main() {
    let list = Cons(1, Cons(2, Cons(3, Nil))); // æŠ¥é”™ï¼Œè¯´é€’å½’ç±»å‹æœ‰æ— é™å¤§å°ã€‚
    println!(list)
}


enum List {
    Cons(i32, Box&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};

fn main() {
    let list = Cons(1,
        Box::new(Cons(2,
            Box::new(Cons(3,
                Box::new(Nil))))));
}
</code></pre>
<h2 id="15-2-é€šè¿‡-Deref-trait-å°†æ™ºèƒ½æŒ‡é’ˆå½“ä½œå¸¸è§„å¼•ç”¨å¤„ç†"><a href="#15-2-é€šè¿‡-Deref-trait-å°†æ™ºèƒ½æŒ‡é’ˆå½“ä½œå¸¸è§„å¼•ç”¨å¤„ç†" class="headerlink" title="15.2 é€šè¿‡ Deref trait å°†æ™ºèƒ½æŒ‡é’ˆå½“ä½œå¸¸è§„å¼•ç”¨å¤„ç†"></a>15.2 é€šè¿‡ Deref trait å°†æ™ºèƒ½æŒ‡é’ˆå½“ä½œå¸¸è§„å¼•ç”¨å¤„ç†</h2><ul>
<li>å®ç°<code>Deref Trait</code> ä½¿æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è§£å¼•ç”¨è¿ç®—æ³•<code>*</code>çš„è¡Œä¸ºã€‚</li>
<li>é€šè¿‡å®ç°<code>Deref</code>ï¼Œæ™ºèƒ½æŒ‡é’ˆå¯ä»¥åƒå¸¸è§„å¼•ç”¨ä¸€æ ·æ¥å¤„ç†ã€‚</li>
</ul>
<p>Demo</p>
<pre><code>fn main() {
    let x = 5;
    let y = Box::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
}


struct MyBox&lt;T&gt;(T);// æ³›å‹çš„å…ƒç»„ç»“æ„ä½“

impl&lt;T&gt; MyBox&lt;T&gt; {
    fn new(x: T) -&gt; MyBox&lt;T&gt; {
        MyBox(x)
    }
}


use std::ops::Deref;


impl&lt;T&gt; Deref for MyBox&lt;T&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;T {
        &amp;self.0
    }
}

fn main() {
    let x = 5;
    let y = MyBox::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
}

// *(y.deref())

let m = MyBox::new(String::from("Rust"));
//  &amp;m &amp;MyBox&lt;String&gt;
// deref &amp;Striing
// deref &amp;str

hello(&amp;m);
hello(&amp;(*m)[..]);

fn hello(name: &amp;str) {
    println!("Hello, {}!", name);
}
</code></pre>
<p><strong>è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢å¦‚ä½•ä¸å¯å˜æ€§äº¤äº’</strong></p>
<p><code>Rust</code> åœ¨å‘ç°ç±»å‹å’Œ <code>trait</code> å®ç°æ»¡è¶³ä¸‰ç§æƒ…å†µæ—¶ä¼šè¿›è¡Œè§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢ï¼š</p>
<ul>
<li>å½“ <code>T: Deref&lt;Target=U&gt; </code>æ—¶ä» <code>&amp;T</code> åˆ° <code>&amp;U</code>ã€‚</li>
<li>å½“ <code>T: DerefMut&lt;Target=U&gt;</code> æ—¶ä» <code>&amp;mut T</code> åˆ° <code>&amp;mut U</code>ã€‚</li>
<li>å½“ <code>T: Deref&lt;Target=U&gt;</code> æ—¶ä» <code>&amp;mut T</code> åˆ° <code>&amp;U</code>ã€‚</li>
</ul>
<p><strong>å‡½æ•°å’Œæ–¹æ³•çš„éšç§è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref Coercionï¼‰</strong></p>
<ul>
<li>éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆ<code>Deref Coercion</code>ï¼‰ï¼š<ul>
<li><code>Deref Coercion</code> å¯ä»¥å§<code>T</code>çš„å¼•ç”¨è½¬åŒ–ä¸º<code>T</code>ç»è¿‡<code>Deref</code>æ“ä½œåç”Ÿæˆçš„å¼•ç”¨</li>
</ul>
</li>
<li>å½“æŠŠæŸç±»å‹çš„å¼•ç”¨ä¼ é€’ç»™å‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä½†å®ƒçš„ç±»å‹ä¸å®šä¹‰çš„å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼š<ul>
<li><code>Deref Coercion</code>å°±è‡ªåŠ¨å‘ç”Ÿ</li>
<li>ç¼–è¯‘å™¨ä¼šå¯¹<code>deref</code>è¿›è¡Œä¸€ç³»åˆ—è°ƒç”¨ï¼Œæ¥æŠŠå®ƒè½¬ä¸ºæ‰€éœ€çš„å‚æ•°ç±»å‹<ul>
<li>åœ¨ç¼–è¯‘æ—¶å€™å®Œæˆï¼Œæ²¡æœ‰é¢å¤–æ€§èƒ½å¼€é”€ </li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="15-3-ä½¿ç”¨-Drop-Trait-è¿è¡Œæ¸…ç†ä»£ç "><a href="#15-3-ä½¿ç”¨-Drop-Trait-è¿è¡Œæ¸…ç†ä»£ç " class="headerlink" title="15.3. ä½¿ç”¨ Drop Trait è¿è¡Œæ¸…ç†ä»£ç "></a>15.3. ä½¿ç”¨ Drop Trait è¿è¡Œæ¸…ç†ä»£ç </h2><pre><code>struct CustomSmartPointer {
    data: String,
}

impl Drop for CustomSmartPointer {
    fn drop(&amp;mut self) {
        println!("Dropping CustomSmartPointer with data `{}`!", self.data);
    }
}

fn main() {
    let c = CustomSmartPointer { data: String::from("my stuff") };
    let d = CustomSmartPointer { data: String::from("other stuff") };
    println!("CustomSmartPointers created.");
   
   // è¾“å‡º 
   CustomSmartPointers created.
    Dropping CustomSmartPointer with data `other stuff`!
    Dropping CustomSmartPointer with data `my stuff`!

}

// é€šè¿‡ std::mem::drop ææ—©ä¸¢å¼ƒå€¼

fn main() {
let c = CustomSmartPointer { data: String::from("some data") };
println!("CustomSmartPointer created.");
drop(c);
println!("CustomSmartPointer dropped before the end of main.");

CustomSmartPointer created.
Dropping CustomSmartPointer with data `some data`!
CustomSmartPointer dropped before the end of main.
</code></pre>
<h2 id="15-4-Rc-å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ"><a href="#15-4-Rc-å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="15.4 Rc å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ"></a>15.4 Rc<t> å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ</t></h2><p>æœ‰æ—¶å€™ï¼Œä¸€ä¸ªå€¼ä¼šæœ‰å¤šä¸ªæ‰€æœ‰è€…(è¿™ç§åœºæ™¯<code>Box&lt;T&gt;</code>ä¸æ”¯æŒ)ï¼Œæ¯”å¦‚åŒå‘é“¾è¡¨ã€‚ä¸ºäº†æ”¯æŒå¤šé‡æ‰€æœ‰æƒï¼š<code>Rc&lt;T&gt;</code>:</p>
<ul>
<li><code>reference counting</code> å¼•ç”¨è®¡æ•°</li>
<li>è¿½è¸ªæ‰€æœ‰å€¼çš„å¼•ç”¨</li>
<li><code>0</code> ä¸ªå¼•ç”¨çš„æ—¶å€™ï¼Œè¯¥å€¼ä¼šè¢«æ¸…ç†æ‰</li>
<li>éœ€è¦åœ¨<code>heap</code>ä¸Šåˆ†é…æ•°æ®ï¼Œè¿™äº›æ•°æ®è¢«ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†è¯»å†™ï¼ˆåªè¯»ï¼‰ï¼Œä½†åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå“ªä¸ªéƒ¨åˆ†æœ€åä½¿ç”¨å®Œè¿™äº›æ•°æ®ã€‚</li>
<li><code>Rc&lt;T&gt;</code> åªèƒ½ç”¨äºå•çº¿ç¨‹åœºæ™¯</li>
<li><code>Rc::clone(&amp;a)</code> å‡½æ•°ï¼šå¢åŠ å¼•ç”¨è®¡æ•°</li>
<li><code>Rc::strong(&amp;a)ã€Rc::weak(&amp;a)</code> è·å¾—å¼•ç”¨è®¡æ•°</li>
<li><code>Rc&lt;T&gt;</code>ï¼Œé€šè¿‡ä¸å¯å˜å¼•ç”¨ï¼Œä½ å¯ä»¥åœ¨ç¨‹åºä¸åŒéƒ¨åˆ†ä¹‹é—´å…±äº«åªè¯»æ•°æ®</li>
</ul>
<p>Demo</p>
<pre><code>enum List {
    Cons(i32, Rc&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};
use std::rc::Rc;

fn main() {
    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));
    let b = Cons(3, Rc::clone(&amp;a));
    let c = Cons(4, Rc::clone(&amp;a));
}

let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));
println!("count after creating a = {}", Rc::strong_count(&amp;a));
let b = Cons(3, Rc::clone(&amp;a));
println!("count after creating b = {}", Rc::strong_count(&amp;a));
{
    let c = Cons(4, Rc::clone(&amp;a));
    println!("count after creating c = {}", Rc::strong_count(&amp;a));
}
println!("count after c goes out of scope = {}", Rc::strong_count(&amp;a));

// è¾“å‡º
count after creating a = 1
count after creating b = 2
count after creating c = 3
count after c goes out of scope = 2
</code></pre>
<h2 id="15-5-RefCell-å’Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼"><a href="#15-5-RefCell-å’Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼" class="headerlink" title="15.5 RefCell å’Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼"></a>15.5 RefCell<t> å’Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼</t></h2><p>å†…éƒ¨å¯å˜æ€§ï¼ˆ<code>Interior mutability</code>ï¼‰æ˜¯ <code>Rust</code> ä¸­çš„ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä½ å³ä½¿åœ¨æœ‰ä¸å¯å˜å¼•ç”¨æ—¶ä¹Ÿå¯ä»¥æ”¹å˜æ•°æ®ï¼Œè¿™é€šå¸¸æ˜¯å€Ÿç”¨è§„åˆ™æ‰€ä¸å…è®¸çš„ã€‚ä¸ºäº†æ”¹å˜æ•°æ®ï¼Œè¯¥æ¨¡å¼åœ¨æ•°æ®ç»“æ„ä¸­ä½¿ç”¨ <code>unsafe</code> ä»£ç æ¥æ¨¡ç³Š <code>Rust</code> é€šå¸¸çš„å¯å˜æ€§å’Œå€Ÿç”¨è§„åˆ™ã€‚</p>
<p>å€Ÿç”¨è§„åˆ™ï¼šåœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´ä½ ï¼Œä½ è¦ä¹ˆåªèƒ½æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆåªèƒ½æ‹¥æœ‰ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨ã€‚</p>
<p><code>RefCell&lt;T&gt;</code> ä¸ <code>Box&lt;T&gt;</code> åŒºåˆ«</p>
<ul>
<li><code>Box&lt;T&gt;</code>ç¼–è¯‘é˜¶æ®µå¼ºåˆ¶ä»£ç éµå®ˆå€Ÿç”¨è§„åˆ™ï¼Œå¦åˆ™å°±ç¼–è¯‘æŠ¥é”™ã€‚ ç¼–è¯‘é˜¶æ®µçš„ç‰¹ç‚¹ï¼šå°½æ—©æš´éœ²é—®é¢˜ã€æ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å¼€é”€ã€å¯¹å¤§å¤šæ•°åœºæ™¯æ˜¯æœ€ä½³é€‰æ‹©ã€æ˜¯<code>Rust</code>é»˜è®¤è¡Œä¸º</li>
<li><code>RefCell&lt;T&gt;</code>åªä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹å€Ÿç”¨è§„åˆ™ï¼Œå¦åˆ™å°±<code>panic</code>ã€‚è¿è¡Œé˜¶æ®µç‰¹ç‚¹ï¼šé—®é¢˜å¯èƒ½å‘ç”Ÿåœ¨ç”Ÿæˆç¯å¢ƒã€å› å€Ÿç”¨è®¡æ•°äº§ç”Ÿè®¸äº›æ€§èƒ½æŸå¤±ã€å®ç°æŸäº›ç‰¹å®šçš„å†…å­˜å®‰å…¨åœºæ™¯ï¼ˆä¸å˜ç¯å¢ƒä¸­ä¿®æ”¹è‡ªèº«æ•°æ®ï¼‰</li>
</ul>
<p>ä½¿ç”¨<code>RefCell&lt;T&gt;</code>åœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯</p>
<ul>
<li><code>borrow</code>æ–¹æ³•<ul>
<li>è¿”å›æ™ºèƒ½æŒ‡é’ˆ<code>Ref&lt;T&gt;</code>ï¼Œå®ƒå®ç°äº† <code>Deref</code> </li>
</ul>
</li>
<li><code>borrow_mut</code> æ–¹æ³•<ul>
<li>è¿”å›æ™ºèƒ½æŒ‡é’ˆ<code>RefCell&lt;T&gt;</code>ï¼Œå®ƒå®ç°äº†<code>Deref</code> </li>
</ul>
</li>
</ul>
<p>Demo</p>
<pre><code>fn main() {
    let x = 5;
    let y = &amp;mut x; // æŠ¥é”™
}


#[derive(Debug)]
enum List {
    Cons(Rc&lt;RefCell&lt;i32&gt;&gt;, Rc&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};
use std::rc::Rc;
use std::cell::RefCell;

fn main() {
    let value = Rc::new(RefCell::new(5));

    let a = Rc::new(Cons(Rc::clone(&amp;value), Rc::new(Nil)));

    let b = Cons(Rc::new(RefCell::new(6)), Rc::clone(&amp;a));
    let c = Cons(Rc::new(RefCell::new(10)), Rc::clone(&amp;a));

    *value.borrow_mut() += 10;

    println!("a after = {:?}", a);
    println!("b after = {:?}", b);
    println!("c after = {:?}", c);
}
</code></pre>
<h2 id="15-6-å¼•ç”¨å¾ªç¯ä¸å†…å­˜æ³„æ¼"><a href="#15-6-å¼•ç”¨å¾ªç¯ä¸å†…å­˜æ³„æ¼" class="headerlink" title="15.6 å¼•ç”¨å¾ªç¯ä¸å†…å­˜æ³„æ¼"></a>15.6 å¼•ç”¨å¾ªç¯ä¸å†…å­˜æ³„æ¼</h2><p>å¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´çš„å†…å­˜æ³„éœ²</p>
<pre><code>fn main() {
    let a = Rc::new(Cons(5, RefCell::new(Rc::new(Nil))));

    println!("a initial rc count = {}", Rc::strong_count(&amp;a));
    println!("a next item = {:?}", a.tail());

    let b = Rc::new(Cons(10, RefCell::new(Rc::clone(&amp;a))));

    println!("a rc count after b creation = {}", Rc::strong_count(&amp;a));
    println!("b initial rc count = {}", Rc::strong_count(&amp;b));
    println!("b next item = {:?}", b.tail());

    if let Some(link) = a.tail() {
        *link.borrow_mut() = Rc::clone(&amp;b);
    }

    println!("b rc count after changing a = {}", Rc::strong_count(&amp;b));
    println!("a rc count after changing a = {}", Rc::strong_count(&amp;a));

    // Uncomment the next line to see that we have a cycle;
    // it will overflow the stack
    // println!("a next item = {:?}", a.tail());
}
</code></pre>
<p>ä½¿ç”¨weak</p>
<pre><code>use std::rc::{Rc, Weak};
use std::cell::RefCell;

#[derive(Debug)]
struct Node {
    value: i32,
    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,
    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
}


fn main() {
    let leaf = Rc::new(Node {
        value: 3,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![]),
    });

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());

    let branch = Rc::new(Node {
        value: 5,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
    });

    *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
}
</code></pre>
<p><strong>å¯è§†åŒ– strong_count å’Œ weak_count çš„æ”¹å˜</strong></p>
<pre><code>fn main() {
    let leaf = Rc::new(Node {
        value: 3,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![]),
    });

    println!(
        "leaf strong = {}, weak = {}",
        Rc::strong_count(&amp;leaf),
        Rc::weak_count(&amp;leaf),
    );

    {
        let branch = Rc::new(Node {
            value: 5,
            parent: RefCell::new(Weak::new()),
            children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
        });

        *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);

        println!(
            "branch strong = {}, weak = {}",
            Rc::strong_count(&amp;branch),
            Rc::weak_count(&amp;branch),
        );

        println!(
            "leaf strong = {}, weak = {}",
            Rc::strong_count(&amp;leaf),
            Rc::weak_count(&amp;leaf),
        );
    }

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
    println!(
        "leaf strong = {}, weak = {}",
        Rc::strong_count(&amp;leaf),
        Rc::weak_count(&amp;leaf),
    );
}

leaf strong = 1, weak = 0
branch strong = 1, weak = 1
leaf strong = 2, weak = 0
leaf parent = None
leaf strong = 1, weak = 0
</code></pre>
<h1 id="åå…­ã€æ— ç•å¹¶å‘"><a href="#åå…­ã€æ— ç•å¹¶å‘" class="headerlink" title="åå…­ã€æ— ç•å¹¶å‘"></a>åå…­ã€æ— ç•å¹¶å‘</h1><h2 id="16-1-ä½¿ç”¨çº¿ç¨‹åŒä¸€æ—¶é—´è¿è¡Œä»£ç "><a href="#16-1-ä½¿ç”¨çº¿ç¨‹åŒä¸€æ—¶é—´è¿è¡Œä»£ç " class="headerlink" title="16.1. ä½¿ç”¨çº¿ç¨‹åŒä¸€æ—¶é—´è¿è¡Œä»£ç "></a>16.1. ä½¿ç”¨çº¿ç¨‹åŒä¸€æ—¶é—´è¿è¡Œä»£ç </h2><p><strong>ä½¿ç”¨ spawn åˆ›å»ºæ–°çº¿ç¨‹</strong></p>
<pre><code>use std::thread;
use std::time::Duration;

fn main() {
    let handle = thread::spawn(|| {
        for i in 1..10 {
            println!("hi number {} from the spawned thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..5 {
        println!("hi number {} from the main thread!", i);
        thread::sleep(Duration::from_millis(1));
    }

    handle.join().unwrap();
}
</code></pre>
<p><strong>çº¿ç¨‹ä¸ move é—­åŒ…</strong></p>
<pre><code>use std::thread;

fn main() {
    let v = vec![1, 2, 3];

    let handle = thread::spawn( move || {
        println!("Here's a vector: {:?}", v);
    });

    drop(v); // oh no!
    handle.join().unwrap();
}
</code></pre>
<h2 id="16-2-ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨çº¿ç¨‹é—´é€šä¿¡"><a href="#16-2-ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="16.2. ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨çº¿ç¨‹é—´é€šä¿¡"></a>16.2. ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨çº¿ç¨‹é—´é€šä¿¡</h2><p><strong>é€šé“ä¸æ‰€æœ‰æƒè½¬ç§»</strong></p>
<pre><code>use std::thread;
use std::sync::mpsc;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap(); // è¿™é‡Œä¼šå‘ç”Ÿæ‰€æœ‰æƒå˜æ›´
        // println!("val is {}", val); // value borrowed here after move
    });

    let received = rx.recv().unwrap();
    println!("Got: {}", received);
}
</code></pre>
<p><strong>å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…</strong></p>
<pre><code>fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("thread"),
        ];

        for val in vals {
            tx.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    for received in rx {
        println!("Got: {}", received);
    }
}
</code></pre>
<p><strong>é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…</strong></p>
<pre><code>let (tx, rx) = mpsc::channel();

let tx1 = tx.clone();
thread::spawn(move || {
    let vals = vec![
        String::from("hi"),
        String::from("from"),
        String::from("the"),
        String::from("thread"),
    ];

    for val in vals {
        tx1.send(val).unwrap();
        thread::sleep(Duration::from_secs(1));
    }
});

thread::spawn(move || {
    let vals = vec![
        String::from("more"),
        String::from("messages"),
        String::from("for"),
        String::from("you"),
    ];

    for val in vals {
        tx.send(val).unwrap();
        thread::sleep(Duration::from_secs(1));
    }
});

for received in rx {
    println!("Got: {}", received);
}
</code></pre>
<h2 id="16-3-å…±äº«çŠ¶æ€å¹¶å‘-Lock"><a href="#16-3-å…±äº«çŠ¶æ€å¹¶å‘-Lock" class="headerlink" title="16.3. å…±äº«çŠ¶æ€å¹¶å‘ Lock"></a>16.3. å…±äº«çŠ¶æ€å¹¶å‘ Lock</h2><pre><code>use std::sync::Mutex;

fn main() {
    let m = Mutex::new(5);

    {
        let mut num = m.lock().unwrap();
        *num = 6;
    }

    println!("m = {:?}", m);
}
</code></pre>
<p><strong>åœ¨çº¿ç¨‹é—´å…±äº« Mutex<t></t></strong></p>
<pre><code>use std::sync::{Mutex, Arc};
use std::thread;

fn main() {
    let counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];

    for _ in 0..10 {
        let counter = Arc::clone(&amp;counter);
        let handle = thread::spawn(move || {
            let mut num = counter.lock().unwrap();

            *num += 1;
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!("Result: {}", *counter.lock().unwrap());
}
</code></pre>
<h2 id="16-4-ä½¿ç”¨Sync-ä¸-Send-Trait-çš„å¯æ‰©å±•å¹¶å‘"><a href="#16-4-ä½¿ç”¨Sync-ä¸-Send-Trait-çš„å¯æ‰©å±•å¹¶å‘" class="headerlink" title="16.4. ä½¿ç”¨Sync ä¸ Send Trait çš„å¯æ‰©å±•å¹¶å‘"></a>16.4. ä½¿ç”¨Sync ä¸ Send Trait çš„å¯æ‰©å±•å¹¶å‘</h2><p>ç„¶è€Œæœ‰ä¸¤ä¸ªå¹¶å‘æ¦‚å¿µæ˜¯å†…åµŒäºè¯­è¨€ä¸­çš„ï¼š<code>std::marker</code> ä¸­çš„ <code>Sync</code> å’Œ <code>Send trait</code>ã€‚</p>
<p><strong>é€šè¿‡ Send å…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ</strong></p>
<ul>
<li>å®ç°<code>Send trait</code> çš„ç±»å‹å¯åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ</li>
<li><code>Rust</code>ä¸­å‡ ä¹æ‰€æœ‰çš„ç±»å‹éƒ½å®ç°äº†<code>Send</code><ul>
<li>ä½† <code>Rc&lt;T&gt;</code> æ²¡æœ‰å®ç° <code>Send</code>ï¼Œå®ƒåªç”¨äºå•çº¿ç¨‹æƒ…æ™¯</li>
</ul>
</li>
<li>ä»»ä½•å®Œå…¨ç”± <code>Send</code> ç±»å‹ç»„æˆçš„ç±»å‹ä¹Ÿæ ‡è®°ä¸º<code>Send</code> </li>
<li>é™¤äº†åŸå§‹æŒ‡é’ˆä¹‹å¤–ï¼Œå‡ ä¹æ‰€æœ‰çš„åŸºç¡€ç±»å‹éƒ½æ˜¯<code>Send</code></li>
</ul>
<p><strong>Sync å…è®¸å¤šçº¿ç¨‹è®¿é—®</strong></p>
<ul>
<li>å®ç°<code>Sync</code>çš„ç±»å‹å¯ä»¥å®‰å…¨çš„è¢«å¤šä¸ªçº¿ç¨‹å¼•ç”¨</li>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼šå¦‚æœ<code>T</code> æ˜¯<code>Sync</code>ï¼Œé‚£ä¹ˆ<code>&amp;T</code>å°±æ˜¯<code>Send</code><ul>
<li>å¼•ç”¨å¯ä»¥è¢«å®‰å…¨çš„é€å¾€å¦å¤–ä¸€ä¸ªçº¿ç¨‹</li>
</ul>
</li>
<li>åŸºç¡€ç±»å‹éƒ½æ˜¯<code>Sync</code>  </li>
<li>å®Œå…¨ç”±<code>Sync</code>ç±»å‹ç»„æˆçš„ç±»å‹ä¹Ÿæ˜¯<code>Sync</code><ul>
<li>ä½† <code>Rc&lt;T&gt;</code>ä¸æ˜¯<code>Sync</code>çš„ </li>
<li><code>RefCell&lt;T&gt;</code> å’Œ <code>Cell&lt;T&gt;</code> å®¶æ—ä¹Ÿä¸æ˜¯<code>Sync</code>çš„</li>
<li>è€Œ<code>Mutex&lt;T&gt;</code>æ˜¯<code>Sync</code>çš„ </li>
</ul>
</li>
</ul>
<p><strong>æ‰‹åŠ¨å®ç° Send å’Œ Sync æ˜¯ä¸å®‰å…¨çš„</strong></p>
<p>é€šå¸¸å¹¶ä¸éœ€è¦æ‰‹åŠ¨å®ç° <code>Send</code> å’Œ <code>Sync trait</code>ï¼Œå› ä¸ºç”± <code>Send</code> å’Œ <code>Sync</code> çš„ç±»å‹ç»„æˆçš„ç±»å‹ï¼Œè‡ªåŠ¨å°±æ˜¯ <code>Send</code> å’Œ <code>Sync</code> çš„ã€‚å› ä¸ºä»–ä»¬æ˜¯æ ‡è®° <code>trait</code>ï¼Œç”šè‡³éƒ½ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ã€‚ä»–ä»¬åªæ˜¯ç”¨æ¥åŠ å¼ºå¹¶å‘ç›¸å…³çš„ä¸å¯å˜æ€§çš„ã€‚</p>
<h1 id="åä¸ƒã€-Rust-çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ç‰¹æ€§"><a href="#åä¸ƒã€-Rust-çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ç‰¹æ€§" class="headerlink" title="åä¸ƒã€ Rust çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ç‰¹æ€§"></a>åä¸ƒã€ Rust çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ç‰¹æ€§</h1><p><strong>Trait å¯¹è±¡æ‰§è¡Œçš„æ˜¯åŠ¨æ€æ´¾å‘</strong></p>
<ul>
<li>å°†<code>trait</code>çº¦æŸä½œç”¨äºæ³›å‹æ—¶ï¼Œ<code>Rust</code>ç¼–è¯‘å™¨ä¼šæ‰§è¡Œå•æ€åŒ–ï¼š<ul>
<li>ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬ç”¨æ¥æ›¿æ¢æ³›å‹ç±»å‹å‚æ•°çš„æ¯ä¸€ä¸ªå…·ä½“ç±»å‹ç”Ÿæˆå¯¹åº”çš„å‡½æ•°å’Œæ–¹æ³•çš„éæ³›å‹å®ç°ã€‚</li>
</ul>
</li>
<li>é€šè¿‡å•æ€åŒ–ç”Ÿæˆçš„ä»£ç ä¼šæ‰§è¡Œé™æ€æ´¾å‘ï¼ˆ<code>static dispatch</code>ï¼‰ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç¡®å®šè°ƒç”¨çš„å…·ä½“æ–¹æ³•</li>
<li>åŠ¨æ€æ´¾å‘ï¼ˆ<code>dynamic dispatch</code>ï¼‰ï¼š<ul>
<li>æ— æ³•åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç¡®å®šä½ è°ƒç”¨çš„ç©¶ç«Ÿæ˜¯å“ªä¸€ç§æ–¹æ³•</li>
<li>ç¼–è¯‘å™¨ä¼šäº§ç”Ÿé¢å¤–çš„ä»£ç ä»¥ä¾¿åœ¨è¿è¡Œæ—¶æ‰¾å‡ºå¸Œæœ›è°ƒç”¨çš„æ–¹æ³•</li>
</ul>
</li>
<li>ä½¿ç”¨<code>trait</code>å¯¹è±¡ï¼Œä¼šæ‰§è¡ŒåŠ¨æ€æ´¾å‘ï¼š<ul>
<li>äº§ç”Ÿè¿è¡Œæ—¶å¼€é”€</li>
<li>é˜»æ­¢ç¼–è¯‘å™¨å†…è”æ–¹æ³•ä»£ç ï¼Œä½¿å¾—éƒ¨åˆ†ä¼˜åŒ–æ“ä½œæ— æ³•è¿›è¡Œ   </li>
</ul>
</li>
</ul>
<p>Demo</p>
<pre><code>pub trait Draw {
    fn draw(&amp;self);
}

pub struct Screen {
    pub components: Vec&lt;Box&lt;dyn Draw&gt;&gt;, // Box&lt;dyn Draw&gt; å®ç°åŠ¨æ€æ´¾å‘
    // pub components: Vec&lt;T&gt;, // ç”¨æ³›å‹çš„è¯ï¼ŒVecç±»å‹åªèƒ½æ˜¯ä¸€ç§

}


impl Screen {
    pub fn run(&amp;self) {
        for component in self.components.iter() {
            component.draw();
        }
    }
}



use gui::{Screen, Button};

fn main() {
    let screen = Screen {
        components: vec![
            Box::new(SelectBox {
                width: 75,
                height: 10,
                options: vec![
                    String::from("Yes"),
                    String::from("Maybe"),
                    String::from("No")
                ],
            }),
            Box::new(Button {
                width: 50,
                height: 10,
                label: String::from("OK"),
            }),
        ],
    };

    screen.run();
}
</code></pre>
<p><strong>Trait å¯¹è±¡å¿…é¡»ä¿éšœå¯¹è±¡å®‰å…¨</strong></p>
<ul>
<li>åªèƒ½æŠŠæ»¡è¶³å¯¹è±¡å®‰å…¨ï¼ˆ<code>object-safe</code>ï¼‰çš„<code>trait</code>è½¬åŒ–ä¸º<code>trait</code>å¯¹è±¡</li>
<li><code>Rust</code>é‡‡ç”¨ä¸€ç³»åˆ—è§„åˆ™æ¥åˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦å®‰å…¨ï¼Œåªéœ€è®°ä½ä¸¤æ¡ï¼š<ul>
<li>æ–¹æ³•çš„è¿”å›ç±»å‹ä¸æ˜¯<code>Self</code> </li>
<li>æ–¹æ³•ä¸­ä¸åŒ…å«ä»»ä½•æ³›å‹ç±»å‹å‚æ•°</li>
</ul>
</li>
</ul>
<p>Demo</p>
<pre><code>pub trait Clone {
    fn clone(&amp;self) -&gt; Self;
}

pub struct Screen {
    pub components: Vec&lt;Box&lt;dyn Clone&gt;&gt;, //  the trait `std::clone::Clone` cannot be made into an object
}
</code></pre>
<p>å®Œæ•´ Demo</p>
<pre><code>fn main() {
    let mut post = Post::new();

    post.add_text("I ate a salad for lunch today");

    let post = post.request_review();

    let post = post.approve();

    assert_eq!("I ate a salad for lunch today", post.content());
}

pub struct Post {
    content: String,
}

pub struct DraftPost {
    content: String,
}

impl Post {
    // æ­¤æ—¶è¿”å›DraftPostç±»å‹ï¼Œä¹Ÿå°±æ— æ³•è°ƒç”¨contentï¼Œæ²¡æœ‰Postå¯¹è±¡
    pub fn new() -&gt; DraftPost {
        DraftPost {
            content: String::new(),
        }
    }

    pub fn content(&amp;self) -&gt; &amp;str {
        &amp;self.content
    }
}

impl DraftPost {
    pub fn add_text(&amp;mut self, text: &amp;str) {
        self.content.push_str(text);
    }
    // æ‰§è¡ŒååŸæ¥çš„DraftPostå¯¹è±¡å°±é‡Šæ”¾äº†ï¼Œå› ä¸ºå…¥å‚æ˜¯self
    pub fn request_review(self) -&gt; PendingReviewPost {
        PendingReviewPost {
            content: self.content,
        }
    }
}

pub struct PendingReviewPost {
    content: String,
}

// åŒæ ·æ²¡æœ‰contentæ–¹æ³•
impl PendingReviewPost {
    pub fn approve(self) -&gt; Post {
        Post {
            content: self.content,
        }
    }
}
</code></pre>
<h1 id="åå…«ã€æ¨¡å¼åŒ¹é…"><a href="#åå…«ã€æ¨¡å¼åŒ¹é…" class="headerlink" title="åå…«ã€æ¨¡å¼åŒ¹é…"></a>åå…«ã€æ¨¡å¼åŒ¹é…</h1><p>æ¨¡å¼æœ‰ä¸¤ç§å½¢å¼ï¼š<code>refutable</code>ï¼ˆå¯åé©³çš„ï¼‰å’Œ <code>irrefutable</code>ï¼ˆä¸å¯åé©³çš„ï¼‰ã€‚èƒ½åŒ¹é…ä»»ä½•ä¼ é€’çš„å¯èƒ½å€¼çš„æ¨¡å¼è¢«ç§°ä¸ºæ˜¯ ä¸å¯åé©³çš„ï¼ˆ<code>irrefutable</code>ï¼‰ã€‚ä¸€ä¸ªä¾‹å­å°±æ˜¯ <code>let x = 5</code>; è¯­å¥ä¸­çš„ <code>x</code>ï¼Œå› ä¸º <code>x</code> å¯ä»¥åŒ¹é…ä»»ä½•å€¼æ‰€ä»¥ä¸å¯èƒ½ä¼šå¤±è´¥ã€‚å¯¹æŸäº›å¯èƒ½çš„å€¼è¿›è¡ŒåŒ¹é…ä¼šå¤±è´¥çš„æ¨¡å¼è¢«ç§°ä¸ºæ˜¯ å¯åé©³çš„ï¼ˆ<code>refutable</code>ï¼‰ã€‚ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ä¾¿æ˜¯ <code>if let Some(x) = a_value</code> è¡¨è¾¾å¼ä¸­çš„ <code>Some(x)ï¼›</code>å¦‚æœå˜é‡ <code>a_value</code> ä¸­çš„å€¼æ˜¯ <code>None</code> è€Œä¸æ˜¯ <code>Some</code>ï¼Œé‚£ä¹ˆ <code>Some(x)</code> æ¨¡å¼ä¸èƒ½åŒ¹é…ã€‚</p>
<p><strong>å‡½æ•°å‚æ•°ã€ let è¯­å¥å’Œ for å¾ªç¯åªèƒ½æ¥å—ä¸å¯åé©³çš„æ¨¡å¼</strong></p>
<p>Demo</p>
<pre><code>let mut stack = Vec::new();

stack.push(1);
stack.push(2);
stack.push(3);

while let Some(top) = stack.pop() {
    println!("{}", top);
}

let v = vec!['a', 'b', 'c'];

for (index, value) in v.iter().enumerate() {
    println!("{} is at index {}", value, index);
}

fn print_coordinates(&amp;(x, y): &amp;(i32, i32)) {
    println!("Current location: ({}, {})", x, y);
}

fn main() {
    let point = (3, 5);
    print_coordinates(&amp;point);
}

if let Some(x) = some_option_value {
    println!("{}", x);
}

// åŒ¹é…å‘½åå˜é‡
fn main() {
    let x = Some(5);
    let y = 10;

    match x {
        Some(50) =&gt; println!("Got 50"),
        Some(y) =&gt; println!("Matched, y = {:?}", y),
        _ =&gt; println!("Default case, x = {:?}", x),
    }

    println!("at the end: x = {:?}, y = {:?}", x, y);
}

// å¤šä¸ªæ¨¡å¼
let x = 1;

match x {
    1 | 2 =&gt; println!("one or two"),
    3 =&gt; println!("three"),
    _ =&gt; println!("anything"),
}

let x = 5;

match x {
    1..=5 =&gt; println!("one through five"),
    _ =&gt; println!("something else"),
}

let x = 'c';

match x {
    'a'..='j' =&gt; println!("early ASCII letter"),
    'k'..='z' =&gt; println!("late ASCII letter"),
    _ =&gt; println!("something else"),
}


// è§£æ„ç»“æ„ä½“
fn main() {
    let p = Point { x: 0, y: 7 };

    match p {
        Point { x, y: 0 } =&gt; println!("On the x axis at {}", x),
        Point { x: 0, y } =&gt; println!("On the y axis at {}", y),
        Point { x, y } =&gt; println!("On neither axis: ({}, {})", x, y),
    }
}

// è§£æ„æšä¸¾
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

fn main() {
    let msg = Message::ChangeColor(0, 160, 255);

    match msg {
        Message::Quit =&gt; {
            println!("The Quit variant has no data to destructure.")
        }
        Message::Move { x, y } =&gt; {
            println!(
                "Move in the x direction {} and in the y direction {}",
                x,
                y
            );
        }
        Message::Write(text) =&gt; println!("Text message: {}", text),
        Message::ChangeColor(r, g, b) =&gt; {
            println!(
                "Change the color to red {}, green {}, and blue {}",
                r,
                g,
                b
            )
        }
    }
}

// ç”¨ .. å¿½ç•¥å‰©ä½™å€¼
fn main() {
    let numbers = (2, 4, 8, 16, 32);

    match numbers {
        (first, .., last) =&gt; {
            println!("Some numbers: {}, {}", first, last);
        },
    }
}

// åŒ¹é…å®ˆå«æä¾›çš„é¢å¤–æ¡ä»¶
let num = Some(4);

match num {
    Some(x) if x &lt; 5 =&gt; println!("less than five: {}", x),
    Some(x) =&gt; println!("{}", x),
    None =&gt; (),
}

let x = 4;
let y = false;

match x {
    4 | 5 | 6 if y =&gt; println!("yes"),
    _ =&gt; println!("no"),
}

// @ ç»‘å®š
enum Message {
    Hello { id: i32 },
}

let msg = Message::Hello { id: 5 };

match msg {
    Message::Hello { id: id_variable @ 3..=7 } =&gt; {
        println!("Found an id in range: {}", id_variable)
    },
    Message::Hello { id: 10..=12 } =&gt; {
        println!("Found an id in another range")
    },
    Message::Hello { id } =&gt; {
        println!("Found some other id: {}", id)
    },
}
</code></pre>
<h1 id="åä¹ã€é«˜çº§ç‰¹å¾"><a href="#åä¹ã€é«˜çº§ç‰¹å¾" class="headerlink" title="åä¹ã€é«˜çº§ç‰¹å¾"></a>åä¹ã€é«˜çº§ç‰¹å¾</h1><h2 id="19-1-unsafe-Rust"><a href="#19-1-unsafe-Rust" class="headerlink" title="19.1 unsafe Rust"></a>19.1 unsafe Rust</h2><p>ç›®å‰ä¸ºæ­¢è®¨è®ºè¿‡çš„ä»£ç éƒ½æœ‰ <code>Rust</code> åœ¨ç¼–è¯‘æ—¶ä¼šå¼ºåˆ¶æ‰§è¡Œçš„å†…å­˜å®‰å…¨ä¿è¯ã€‚ç„¶è€Œï¼Œ<code>Rust</code> è¿˜éšè—æœ‰ç¬¬äºŒç§è¯­è¨€ï¼Œå®ƒä¸ä¼šå¼ºåˆ¶æ‰§è¡Œè¿™ç±»å†…å­˜å®‰å…¨ä¿è¯ï¼šè¿™è¢«ç§°ä¸º ä¸å®‰å…¨ <code>Rust</code>ï¼ˆ<code>unsafe Rust</code>ï¼‰ã€‚å®ƒä¸å¸¸è§„ <code>Rust</code> ä»£ç æ— å¼‚ï¼Œä½†æ˜¯ä¼šæä¾›é¢å¤–çš„è¶…èƒ½åŠ›ã€‚</p>
<p><strong>unsafe Rustå­˜åœ¨çš„åŸå› ï¼š</strong></p>
<ul>
<li>é™æ€åˆ†ææ˜¯ä¿å®ˆçš„ã€‚<ul>
<li>ä½¿ç”¨<code>unsafe Rust</code>ï¼šæˆ‘çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¹¶æ‰¿æ‹…ç›¸åº”é£é™©</li>
</ul>
</li>
<li>è®¡ç®—æœºç¡¬ä»¶æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ï¼Œ<code>Rust</code>éœ€è¦èƒ½å¤Ÿè¿›è¡Œåº•å±‚ç³»ç»Ÿç¼–ç¨‹</li>
</ul>
<p><strong>unsafe Rustçš„è¶…èƒ½åŠ›ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨<code>unsafe</code> å…³é”®å­—æ¥åˆ‡æ¢åˆ°<code>unsafe Rust</code>ï¼Œå¼€å¯ä¸€ä¸ªå¿«ï¼Œé‡Œé¢æ”¾ç€<code>unsafe</code>ä»£ç </li>
<li><code>unsafe Rust</code>é‡Œå¯ä»¥æ‰§è¡Œçš„å››ä¸ªåŠ¨ä½œï¼ˆ<code>unsafe</code>è¶…èƒ½åŠ›ï¼‰ï¼š<ul>
<li>è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ</li>
<li>è°ƒç”¨<code>unsafe</code>å‡½æ•°æˆ–æ–¹æ³•</li>
<li>è®¿é—®æˆ–ä¿®æ”¹å¯å˜çš„é™æ€å˜é‡</li>
<li>å®ç°<code>unsafe trait</code> </li>
</ul>
</li>
<li>æ³¨æ„ï¼š<ul>
<li><code>unsafe</code> å¹¶æ²¡æœ‰å…³é—­å€Ÿç”¨æ£€æµ‹æˆ–è€…åœç”¨å…¶å®ƒå®‰å…¨æ£€æŸ¥</li>
<li>ä»»ä½•å†…å­˜å®‰å…¨ç›¸å…³çš„é”™è¯¯å¿…é¡»åœç•™åœ¨<code>unsafe</code>å¿«é‡Œ</li>
<li>å°½å¯èƒ½çš„éš”ç¦»<code>unsafe</code>ä»£ç ï¼Œæœ€å¥½å°è£…åœ¨å®‰å…¨çš„æŠ½è±¡é‡Œï¼Œæä¾›å®‰å…¨çš„<code>API</code></li>
</ul>
</li>
</ul>
<p><strong>è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ</strong></p>
<ul>
<li>åŸå§‹æŒ‡é’ˆ<ul>
<li>å¯å˜çš„ï¼š*mut T</li>
<li>ä¸å¯å˜çš„ï¼š*const Tã€‚æ„å‘³ç€æŒ‡é’ˆåœ¨è§£å¼•ç”¨åï¼Œä¸èƒ½ç›´æ¥å¯¹å…¶è¿›è¡Œèµ‹å€¼</li>
<li>æ³¨æ„ï¼šè¿™é‡Œçš„<code>*</code>ä¸æ˜¯è§£å¼•ç”¨ç¬¦å·ï¼Œå®ƒæ˜¯ç±»å‹åçš„ä¸€éƒ¨åˆ†ã€‚</li>
</ul>
</li>
<li>ä¸å¼•ç”¨ä¸åŒï¼ŒåŸå§‹æŒ‡é’ˆï¼š<ul>
<li>å…è®¸é€šè¿‡åŒäº‹å…·æœ‰ä¸å¯å˜å’Œå¯å˜çš„æŒ‡é’ˆæˆ–å¤šä¸ªæŒ‡å‘åŒä¸€ä½ç½®çš„å¯å˜æŒ‡é’ˆæ¥å¿½ç•¥å€Ÿç”¨è§„åˆ™ã€‚ </li>
<li>æ— æ³•ä¿è¯èƒ½æŒ‡å‘åˆç†çš„å†…å­˜</li>
<li>å…è®¸ä¸º<code>null</code></li>
<li>ä¸å®ç°ä»»ä½•è‡ªåŠ¨æ¸…ç†</li>
</ul>
</li>
<li>æ”¾å¼ƒä¿è¯å®‰å…¨ï¼Œæ¢å–æ›´å¥½çš„æ€§èƒ½/ä¸å…¶ä»–è¯­è¨€æˆ–è€…ç¡¬ä»¶æ¥å£çš„èƒ½åŠ›</li>
<li>ä¸ºä»€ä¹ˆè¦ç”¨åŸå§‹æŒ‡é’ˆï¼Ÿ<ul>
<li>ä¸<code>C</code>è¯­éŸ³è¿›è¡Œæ¥å£</li>
<li>æ„å»ºå€Ÿç”¨æ£€æŸ¥å™¨æ— æ³•ç†è§£çš„å®‰å…¨æŠ½è±¡  </li>
</ul>
</li>
</ul>
<p>Demo</p>
<pre><code>let mut num = 5;

let r1 = &amp;num as *const i32;
let r2 = &amp;mut num as *mut i32;
let address = 0x012345usize;
let r = address as *const i32;

unsafe {
    println!("r1 is: {}", *r1);
    println!("r2 is: {}", *r2);
    println!("r is: {}", *r); // panic
} 

// ç¤ºä¾‹ 19-6 å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ unsafe å—ï¼Œè£¸æŒ‡é’ˆå’Œä¸€äº›ä¸å®‰å…¨å‡½æ•°è°ƒç”¨æ¥å®ç° split_at_mutï¼š
use std::slice;

fn split_at_mut(slice: &amp;mut [i32], mid: usize) -&gt; (&amp;mut [i32], &amp;mut [i32]) {
    let len = slice.len();
    let ptr = slice.as_mut_ptr();

    assert!(mid &lt;= len);


  // (&amp;mut slice[..mid], &amp;mut slice[mid..]) 
  // cannot borrow `*slice` as mutable more than once at a time

    unsafe {
        (slice::from_raw_parts_mut(ptr, mid),
         slice::from_raw_parts_mut(ptr.add(mid), len - mid))
    }
}
</code></pre>
<p><strong>ä½¿ç”¨ extern å‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç </strong></p>
<ul>
<li><code>extern</code>å…³é”®å­—ï¼šç®€åŒ–åˆ›å»ºå’Œä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£ï¼ˆ<code>FFI</code>ï¼‰çš„è¿‡ç¨‹</li>
<li>å¤–éƒ¨å‡½æ•°æ¥å£ï¼ˆ<code>FFI</code>ï¼Œ<code>Foreign Function Interface</code>ï¼‰ï¼šå®ƒè¿è¡Œä¸€ç§ç¼–ç¨‹è¯­è¨€å®šä¹‰å‡½æ•°ï¼Œå¹¶è®©å…¶å®ƒç¼–ç¨‹è¯­è¨€èƒ½è°ƒç”¨è¿™äº›å‡½æ•°</li>
<li>åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆ<code>ABI</code>ï¼Œ<code>Application Binary Interface</code>ï¼‰å®šä¹‰å‡½æ•°åœ¨æ±‡ç¼–å±‚é¢çš„è°ƒç”¨æ–¹å¼</li>
<li><code>C</code>çš„<code>ABI</code>æ˜¯æœ€å¸¸è§çš„<code>ABI</code>ï¼Œå®ƒéµå¾ª<code>C</code>è¯­éŸ³çš„<code>ABI</code></li>
</ul>
<p>Demo</p>
<pre><code>extern "C" {
    fn abs(input: i32) -&gt; i32;
}

fn main() {
    unsafe {
        println!("Absolute value of -3 according to C: {}", abs(-3));
    }
}

// ä»å…¶å®ƒè¯­è¨€è°ƒç”¨ Rust å‡½æ•°
#[no_mangle]
pub extern "C" fn call_from_c() {
    println!("Just called a Rust function from C!");
}
</code></pre>
<p><strong>è®¿é—®æˆ–ä¿®æ”¹å¯å˜é™æ€å˜é‡</strong></p>
<p>é™æ€å˜é‡</p>
<ul>
<li>å‘½åè§„èŒƒ: <code>SNAKE_CASE</code></li>
<li>å¿…é¡»æ ‡æ³¨ç±»å‹</li>
<li>é™æ€å˜é‡åªèƒ½å­˜å‚¨<code>'static</code>ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œæ— éœ€æ˜¾ç¤ºæ ‡æ³¨</li>
<li>è®¿é—®ä¸å¯å˜é™æ€å˜é‡æ˜¯å®‰å…¨çš„</li>
</ul>
<p>å¸¸é‡å’Œä¸å¯å˜é™æ€å˜é‡åŒºåˆ«ï¼š</p>
<ul>
<li>é™æ€å˜é‡ï¼šæœ‰å›ºå®šçš„å†…å­˜åœ°å€ï¼Œä½¿ç”¨å®ƒçš„å€¼æ€»ä¼šè®¿é—®åŒæ ·çš„æ•°æ®</li>
<li>å¸¸é‡ï¼šå…è®¸ä½¿ç”¨å®ƒä»¬çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶</li>
<li>é™æ€å¸¸é‡ï¼šå¯ä»¥æ˜¯å¯å˜çš„ï¼Œè®¿é—®å’Œä¿®æ”¹é™æ€å¯å˜å˜é‡æ˜¯ä¸å®‰å…¨<code>unsafe</code>çš„ã€‚</li>
</ul>
<p>Demo</p>
<pre><code>// è¯»å–æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜é™æ€å˜é‡æ˜¯ä¸å®‰å…¨çš„
static mut COUNTER: u32 = 0;

fn add_to_count(inc: u32) {
    unsafe {
        COUNTER += inc;
    }
}

fn main() {
    add_to_count(3);

    unsafe {
        println!("COUNTER: {}", COUNTER);
    }
}
</code></pre>
<p><strong>å®ç°ä¸å®‰å…¨ trait</strong></p>
<p><code>unsafe</code> çš„å¦ä¸€ä¸ªæ“ä½œç”¨ä¾‹æ˜¯å®ç°ä¸å®‰å…¨ <code>trait</code>ã€‚å½“ <code>trait</code> ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ–¹æ³•ä¸­åŒ…å«ç¼–è¯‘å™¨æ— æ³•éªŒè¯çš„ä¸å˜å¼ï¼ˆ<code>invariant</code>ï¼‰æ—¶ <code>trait</code> æ˜¯ä¸å®‰å…¨çš„ã€‚å¯ä»¥åœ¨ <code>trait</code> ä¹‹å‰å¢åŠ  <code>unsafe</code> å…³é”®å­—å°† <code>trait</code> å£°æ˜ä¸º <code>unsafe</code>ï¼ŒåŒæ—¶ <code>trait</code> çš„å®ç°ä¹Ÿå¿…é¡»æ ‡è®°ä¸º <code>unsafe</code>.</p>
<pre><code>unsafe trait Foo {
    // methods go here
}

unsafe impl Foo for i32 {
    // method implementations go here
}
</code></pre>
<h2 id="19-2-é«˜çº§-trait"><a href="#19-2-é«˜çº§-trait" class="headerlink" title="19.2. é«˜çº§ trait"></a>19.2. é«˜çº§ trait</h2><p><strong>å…³è”ç±»å‹åœ¨ trait å®šä¹‰ä¸­æŒ‡å®šå ä½ç¬¦ç±»å‹</strong></p>
<p>é€šè¿‡å…³è”ç±»å‹ï¼Œåˆ™æ— éœ€æ ‡æ³¨ç±»å‹ï¼Œå› ä¸ºä¸èƒ½å¤šæ¬¡å®ç°è¿™ä¸ª <code>trait</code>ã€‚å¯¹äºç¤ºä¾‹ä½¿ç”¨å…³è”ç±»å‹çš„å®šä¹‰ï¼Œæˆ‘ä»¬åªèƒ½é€‰æ‹©ä¸€æ¬¡ <code>Item</code> ä¼šæ˜¯ä»€ä¹ˆç±»å‹ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ä¸ª <code>impl Iterator for Counter</code>ã€‚å½“è°ƒç”¨ <code>Counter</code> çš„ <code>next</code> æ—¶ä¸å¿…æ¯æ¬¡æŒ‡å®šæˆ‘ä»¬éœ€è¦ <code>u32</code> å€¼çš„è¿­ä»£å™¨ã€‚</p>
<pre><code>pub trait Iterator {
    type Item;

    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;
}

impl Iterator for Counter {
    type Item = u32;

    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {}    
}
</code></pre>
<p><strong>é»˜è®¤æ³›å‹ç±»å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½</strong></p>
<pre><code>use std::ops::Add;

#[derive(Debug, PartialEq)]
struct Point {
    x: i32,
    y: i32,
}

impl Add for Point {
    type Output = Point;

    fn add(self, other: Point) -&gt; Point {
        Point {
            x: self.x + other.x,
            y: self.y + other.y,
        }
    }
}

fn main() {
    assert_eq!(Point { x: 1, y: 0 } + Point { x: 2, y: 3 },
               Point { x: 3, y: 3 });
}
</code></pre>
<p>è¿™é‡Œé»˜è®¤æ³›å‹ç±»å‹ä½äº <code>Add trait</code> ä¸­ã€‚è¿™é‡Œæ˜¯å…¶å®šä¹‰ï¼š</p>
<pre><code>trait Add&lt;RHS=Self&gt; {
    type Output;

    fn add(self, rhs: RHS) -&gt; Self::Output;
}
</code></pre>
<p>è¿™çœ‹æ¥åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªæ–¹æ³•å’Œä¸€ä¸ªå…³è”ç±»å‹çš„ <code>trait</code>ã€‚æ¯”è¾ƒé™Œç”Ÿçš„éƒ¨åˆ†æ˜¯å°–æ‹¬å·ä¸­çš„ <code>RHS=Self</code>ï¼šè¿™ä¸ªè¯­æ³•å«åšé»˜è®¤ç±»å‹å‚æ•°ï¼ˆ<code>default type parameters</code>ï¼‰ã€‚<code>RHS</code> æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹å‚æ•°ï¼ˆâ€œ<code>right hand side</code>â€ çš„ç¼©å†™ï¼‰ï¼Œå®ƒç”¨äºå®šä¹‰ <code>add</code> æ–¹æ³•ä¸­çš„ <code>rhs</code> å‚æ•°ã€‚å¦‚æœå®ç° <code>Add trait</code> æ—¶ä¸æŒ‡å®š <code>RHS</code> çš„å…·ä½“ç±»å‹ï¼Œ<code>RHS</code> çš„ç±»å‹å°†æ˜¯é»˜è®¤çš„ <code>Self</code> ç±»å‹ï¼Œä¹Ÿå°±æ˜¯åœ¨å…¶ä¸Šå®ç° <code>Add</code> çš„ç±»å‹ã€‚</p>
<pre><code>// åœ¨ Millimeters ä¸Šå®ç° Addï¼Œä»¥ä¾¿èƒ½å¤Ÿå°† Millimeters ä¸ Meters ç›¸åŠ 
// æˆ‘ä»¬æŒ‡å®š impl Add&lt;Meters&gt; æ¥è®¾å®š RHS ç±»å‹å‚æ•°çš„å€¼è€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„ Selfã€‚

use std::ops::Add;

struct Millimeters(u32);
struct Meters(u32);

impl Add&lt;Meters&gt; for Millimeters {
    type Output = Millimeters;

    fn add(self, other: Meters) -&gt; Millimeters {
        Millimeters(self.0 + (other.0 * 1000))
    }
}
</code></pre>
<p><strong>å®Œå…¨é™å®šè¯­æ³•ä¸æ¶ˆæ­§ä¹‰ï¼šè°ƒç”¨ç›¸åŒåç§°çš„æ–¹æ³•</strong></p>
<pre><code>trait Pilot {
    fn fly(&amp;self);
}

trait Wizard {
    fn fly(&amp;self);
}

struct Human;

impl Pilot for Human {
    fn fly(&amp;self) {
        println!("This is your captain speaking.");
    }
}

impl Wizard for Human {
    fn fly(&amp;self) {
        println!("Up!");
    }
}

impl Human {
    fn fly(&amp;self) {
        println!("*waving arms furiously*");
    }
}

fn main() {
    let person = Human;
    Pilot::fly(&amp;person);
    Wizard::fly(&amp;person);
    person.fly(); // waving arms furiously
}


trait Animal {
    fn baby_name() -&gt; String;
}

struct Dog;

impl Dog {
    fn baby_name() -&gt; String {
        String::from("Spot")
    }
}

impl Animal for Dog {
    fn baby_name() -&gt; String {
        String::from("puppy")
    }
}

fn main() {
    println!("A baby dog is called a {}", &lt;Dog as Animal&gt;::baby_name());
}
</code></pre>
<p><strong>çˆ¶ trait ç”¨äºåœ¨å¦ä¸€ä¸ª trait ä¸­ä½¿ç”¨æŸ trait çš„åŠŸèƒ½</strong></p>
<p>åœ¨ <code>outline_print</code> çš„å®ç°ä¸­ï¼Œå› ä¸ºå¸Œæœ›èƒ½å¤Ÿä½¿ç”¨ <code>Display trait</code> çš„åŠŸèƒ½ï¼Œåˆ™éœ€è¦è¯´æ˜ <code>OutlinePrint</code> åªèƒ½ç”¨äºåŒæ—¶ä¹Ÿå®ç°äº† <code>Display</code> å¹¶æä¾›äº† <code>OutlinePrint</code> éœ€è¦çš„åŠŸèƒ½çš„ç±»å‹ã€‚</p>
<pre><code>use std::fmt;

trait OutlinePrint: fmt::Display {
    fn outline_print(&amp;self) {
        let output = self.to_string();
        let len = output.len();
        println!("{}", "*".repeat(len + 4));
        println!("*{}*", " ".repeat(len + 2));
        println!("* {} *", output);
        println!("*{}*", " ".repeat(len + 2));
        println!("{}", "*".repeat(len + 4));
    }
}
</code></pre>
<p><strong>newtype æ¨¡å¼ç”¨ä»¥åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨ trait</strong></p>
<pre><code>use std::fmt;

struct Wrapper(Vec&lt;String&gt;);

impl fmt::Display for Wrapper {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        write!(f, "[{}]", self.0.join(", "))
    }
}

fn main() {
    let w = Wrapper(vec![String::from("hello"), String::from("world")]);
    println!("w = {}", w);
}
</code></pre>
<h2 id="19-3-é«˜çº§ç±»å‹"><a href="#19-3-é«˜çº§ç±»å‹" class="headerlink" title="19.3. é«˜çº§ç±»å‹"></a>19.3. é«˜çº§ç±»å‹</h2><p><strong>ç±»å‹åˆ«åç”¨æ¥åˆ›å»ºç±»å‹åŒä¹‰è¯</strong></p>
<pre><code>type Kilometers = i32;

let x: i32 = 5;
let y: Kilometers = 5;

println!("x + y = {}", x + y);

type Thunk = Box&lt;dyn Fn() + Send + 'static&gt;;

let f: Thunk = Box::new(|| println!("hi"));

fn takes_long_type(f: Thunk) {
    // --snip--
}

fn returns_long_type() -&gt; Thunk {
    // --snip--
}

fn takes_long_type(f: Box&lt;dyn Fn() + Send + 'static&gt;) {
    // --snip--
}

fn returns_long_type() -&gt; Box&lt;dyn Fn() + Send + 'static&gt; {
    // --snip--

type Result&lt;T&gt; = std::result::Result&lt;T, std::io::Error&gt;;
</code></pre>
<p><strong>ä»ä¸è¿”å›çš„ never type</strong></p>
<pre><code>fn bar() -&gt; ! {//æŠ¥é”™ ï¼Œ è¿”å›çš„æ˜¯â€œï¼ˆï¼‰â€ä¸æ˜¯â€œï¼â€
   
}

let guess: u32 = match guess.trim().parse() {
    Ok(num) =&gt; num,
    Err(_) =&gt; continue, // è¿™ä¸ªè¿”å›çš„å°±æ˜¯ "!"
};

impl&lt;T&gt; Option&lt;T&gt; {
    pub fn unwrap(self) -&gt; T {
        match self {
            Some(val) =&gt; val,
            None =&gt; panic!("called `Option::unwrap()` on a `None` value"),// è¿™ä¸ªè¿”å›çš„å°±æ˜¯ "!"
        }
    }
}

print!("forever ");

loop {
    print!("and ever ");
}// è¿™ä¸ªè¿”å›çš„å°±æ˜¯ "!"
</code></pre>
<p><strong>åŠ¨æ€å¤§å°ç±»å‹å’Œ Sized trait</strong></p>
<p>å› ä¸º <code>Rust</code> éœ€è¦çŸ¥é“ä¾‹å¦‚åº”è¯¥ä¸ºç‰¹å®šç±»å‹çš„å€¼åˆ†é…å¤šå°‘ç©ºé—´è¿™æ ·çš„ä¿¡æ¯å…¶ç±»å‹ç³»ç»Ÿçš„ä¸€ä¸ªç‰¹å®šçš„è§’è½å¯èƒ½ä»¤äººè¿·æƒ‘ï¼šè¿™å°±æ˜¯ åŠ¨æ€å¤§å°ç±»å‹ï¼ˆ<code>dynamically sized types</code>ï¼‰çš„æ¦‚å¿µã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸º <code>DST</code> æˆ– <code>unsized types</code>ï¼Œè¿™äº›ç±»å‹å…è®¸æˆ‘ä»¬å¤„ç†åªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“å¤§å°çš„ç±»å‹ã€‚</p>
<p>ä¸ºäº†å¤„ç† <code>DST</code>ï¼Œ<code>Rust</code> æœ‰ä¸€ä¸ªç‰¹å®šçš„ <code>trait</code> æ¥ç¡®å®šä¸€ä¸ªç±»å‹çš„å¤§å°æ˜¯å¦åœ¨ç¼–è¯‘æ—¶å¯çŸ¥ï¼šè¿™å°±æ˜¯ <code>Sized trait</code>ã€‚è¿™ä¸ª <code>trait</code> è‡ªåŠ¨ä¸ºç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å¤§å°çš„ç±»å‹å®ç°ã€‚å¦å¤–ï¼Œ<code>Rust</code> éšå¼çš„ä¸ºæ¯ä¸€ä¸ªæ³›å‹å‡½æ•°å¢åŠ äº† <code>Sized bound</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå¦‚ä¸‹æ³›å‹å‡½æ•°å®šä¹‰ï¼š</p>
<pre><code>fn generic&lt;T&gt;(t: T) {
    // --snip--
}
</code></pre>
<p>å®é™…ä¸Šè¢«å½“ä½œå¦‚ä¸‹å¤„ç†ï¼š</p>
<pre><code>fn generic&lt;T: Sized&gt;(t: T) {
    // --snip--
}
</code></pre>
<p>æ³›å‹å‡½æ•°é»˜è®¤åªèƒ½ç”¨äºåœ¨ç¼–è¯‘æ—¶å·²çŸ¥å¤§å°çš„ç±»å‹ã€‚ç„¶è€Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ç‰¹æ®Šè¯­æ³•æ¥æ”¾å®½è¿™ä¸ªé™åˆ¶ï¼š</p>
<pre><code>fn generic&lt;T: ?Sized&gt;(t: &amp;T) {
    // --snip--
}
</code></pre>
<p><code>?Sized trait bound</code> ä¸ <code>Sized</code> ç›¸å¯¹ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥è¯»ä½œ <code>T å¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯ Sized çš„</code>ã€‚è¿™ä¸ªè¯­æ³•åªèƒ½ç”¨äº <code>Sized</code> ï¼Œè€Œä¸èƒ½ç”¨äºå…¶ä»– <code>trait</code>ã€‚</p>
<h2 id="19-4-é«˜çº§å‡½æ•°ä¸é—­åŒ…"><a href="#19-4-é«˜çº§å‡½æ•°ä¸é—­åŒ…" class="headerlink" title="19.4. é«˜çº§å‡½æ•°ä¸é—­åŒ…"></a>19.4. é«˜çº§å‡½æ•°ä¸é—­åŒ…</h2><p><strong>å‡½æ•°æŒ‡é’ˆ</strong></p>
<pre><code>fn add_one(x: i32) -&gt; i32 {
    x + 1
}

fn do_twice(f: fn(i32) -&gt; i32, arg: i32) -&gt; i32 {
    f(arg) + f(arg)
}

fn main() {
    let answer = do_twice(add_one, 5);

    println!("The answer is: {}", answer);
}

let list_of_numbers = vec![1, 2, 3];
let list_of_strings: Vec&lt;String&gt; = list_of_numbers
    .iter()
    .map(ToString::to_string) //     .map(|i| i.to_string())
    .collect();
</code></pre>
<p><strong>è¿”å›é—­åŒ…</strong></p>
<pre><code>fn returns_closure() -&gt; Box&lt;dyn Fn(i32) -&gt; i32&gt; {
    Box::new(|x| x + 1)
}
</code></pre>
<h2 id="19-5-å®"><a href="#19-5-å®" class="headerlink" title="19.5. å®"></a>19.5. å®</h2><p><strong>ä½¿ç”¨ macro_rules! çš„å£°æ˜å®ç”¨äºé€šç”¨å…ƒç¼–ç¨‹</strong></p>
<pre><code>let v: Vec&lt;u32&gt; = vec![1, 2, 3];

#[macro_export]
macro_rules! vec {
    ( $( $x:expr ),* ) =&gt; {
        {
            let mut temp_vec = Vec::new();
            $(
                temp_vec.push($x);
            )*
            temp_vec
        }
    };
}

// ç­‰åŒä¸‹é¢ä»£ç 
let mut temp_vec = Vec::new();
temp_vec.push(1);
temp_vec.push(2);
temp_vec.push(3);
temp_vec
</code></pre>
<p>åé¢ä½¿ç”¨è£…é¥°å™¨æ¨¡å—ç»™å‡½æ•°æ·»åŠ ä»£ç çš„å®ä¾‹å°±ä¸æ·»åŠ äº†ã€‚</p>
<h1 id="äºŒåã€æœ€åçš„é¡¹ç›®-æ„å»ºå¤šçº¿ç¨‹-Web-æœåŠ¡å™¨"><a href="#äºŒåã€æœ€åçš„é¡¹ç›®-æ„å»ºå¤šçº¿ç¨‹-Web-æœåŠ¡å™¨" class="headerlink" title="äºŒåã€æœ€åçš„é¡¹ç›®: æ„å»ºå¤šçº¿ç¨‹ Web æœåŠ¡å™¨"></a>äºŒåã€æœ€åçš„é¡¹ç›®: æ„å»ºå¤šçº¿ç¨‹ Web æœåŠ¡å™¨</h1><p>ç•¥</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/02/19/hello-rust-async/" title="ã€ŠHello Rust Asyncã€‹"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: ã€ŠHello Rust Asyncã€‹</span></a><a class="button is-default" href="/2023/01/21/annual-summary/" title="å¹´åº¦æ€»ç»“"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: å¹´åº¦æ€»ç»“</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="fanlv/blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/fanlv"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com/fanlvlgh"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> Ryo 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p class="is-flex is-justify-content-center"><a title="å¤‡æ¡ˆå·ï¼šé„‚ICPå¤‡2022016224å·-2" target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">å¤‡æ¡ˆå·ï¼šé„‚ICPå¤‡2022016224å·-2 &nbsp;</a></p></div><div><span>åšå­¦ä¹‹ï¼Œå®¡é—®ä¹‹ï¼Œæ…æ€ä¹‹ï¼Œæ˜è¾¨ä¹‹ï¼Œç¬ƒè¡Œä¹‹</span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>